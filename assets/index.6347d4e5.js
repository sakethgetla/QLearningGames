const hs=function(){const w=document.createElement("link").relList;if(w&&w.supports&&w.supports("modulepreload"))return;for(const S of document.querySelectorAll('link[rel="modulepreload"]'))L(S);new MutationObserver(S=>{for(const q of S)if(q.type==="childList")for(const k of q.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&L(k)}).observe(document,{childList:!0,subtree:!0});function g(S){const q={};return S.integrity&&(q.integrity=S.integrity),S.referrerpolicy&&(q.referrerPolicy=S.referrerpolicy),S.crossorigin==="use-credentials"?q.credentials="include":S.crossorigin==="anonymous"?q.credentials="omit":q.credentials="same-origin",q}function L(S){if(S.ep)return;S.ep=!0;const q=g(S);fetch(S.href,q)}};hs();const $t={};function ls(B){$t.context=B}let gi=wi;const He={},se=1,de=2,Bi={owned:null,cleanups:null,context:null,owner:null};var vt=null;let ge=null,ce=null,Bt=null,Ct=null,Xe=0;function _s(B,w){const g=vt,L=B.length===0?Bi:{owned:null,cleanups:null,context:null,owner:w||g};vt=L;try{return Ke(()=>B(()=>Ge(L)),!0)}finally{vt=g}}function Ae(B,w,g){const L=Vi(B,w,!1,se);$e(L)}function us(B,w,g){gi=As;const L=Vi(B,w,!1,se);L.user=!0,Ct?Ct.push(L):$e(L)}function ps(B){if(ce)return B();let w;const g=ce=[];try{w=B()}finally{ce=null}return Ke(()=>{for(let L=0;L<g.length;L+=1){const S=g[L];if(S.pending!==He){const q=S.pending;S.pending=He,bi(S,q)}}},!1),w}function je(B){let w;return w=B(),w}function vs(B){us(()=>je(B))}function ys(B){return vt===null||(vt.cleanups===null?vt.cleanups=[B]:vt.cleanups.push(B)),B}function bi(B,w,g){if(ce)return B.pending===He&&ce.push(B),B.pending=w,w;if(B.comparator&&B.comparator(B.value,w))return w;let L=!1;return B.value=w,B.observers&&B.observers.length&&Ke(()=>{for(let S=0;S<B.observers.length;S+=1){const q=B.observers[S];L&&ge.disposed.has(q),(L&&!q.tState||!L&&!q.state)&&(q.pure?Bt.push(q):Ct.push(q),q.observers&&Ci(q)),L||(q.state=se)}if(Bt.length>1e6)throw Bt=[],new Error},!1),w}function $e(B){if(!B.fn)return;Ge(B);const w=vt,g=Xe;vt=B,fs(B,B.value,g),vt=w}function fs(B,w,g){let L;try{L=B.fn(w)}catch(S){Mi(S)}(!B.updatedAt||B.updatedAt<=g)&&(B.observers&&B.observers.length?bi(B,L):B.value=L,B.updatedAt=g)}function Vi(B,w,g,L=se,S){const q={fn:B,state:L,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:w,owner:vt,context:null,pure:g};return vt===null||vt!==Bi&&(vt.owned?vt.owned.push(q):vt.owned=[q]),q}function he(B){const w=ge;if(B.state===0||w)return;if(B.state===de||w)return Ue(B);if(B.suspense&&je(B.suspense.inFallback))return B.suspense.effects.push(B);const g=[B];for(;(B=B.owner)&&(!B.updatedAt||B.updatedAt<Xe);)(B.state||w)&&g.push(B);for(let L=g.length-1;L>=0;L--)if(B=g[L],B.state===se||w)$e(B);else if(B.state===de||w){const S=Bt;Bt=null,Ue(B,g[0]),Bt=S}}function Ke(B,w){if(Bt)return B();let g=!1;w||(Bt=[]),Ct?g=!0:Ct=[],Xe++;try{const L=B();return ds(g),L}catch(L){Mi(L)}finally{Bt=null,g||(Ct=null)}}function ds(B){Bt&&(wi(Bt),Bt=null),!B&&(Ct.length?ps(()=>{gi(Ct),Ct=null}):Ct=null)}function wi(B){for(let w=0;w<B.length;w++)he(B[w])}function As(B){let w,g=0;for(w=0;w<B.length;w++){const S=B[w];S.user?B[g++]=S:he(S)}$t.context&&ls();const L=B.length;for(w=0;w<g;w++)he(B[w]);for(w=L;w<B.length;w++)he(B[w])}function Ue(B,w){const g=ge;B.state=0;for(let L=0;L<B.sources.length;L+=1){const S=B.sources[L];S.sources&&(S.state===se||g?S!==w&&he(S):(S.state===de||g)&&Ue(S,w))}}function Ci(B){const w=ge;for(let g=0;g<B.observers.length;g+=1){const L=B.observers[g];(!L.state||w)&&(L.state=de,L.pure?Bt.push(L):Ct.push(L),L.observers&&Ci(L))}}function Ge(B){let w;if(B.sources)for(;B.sources.length;){const g=B.sources.pop(),L=B.sourceSlots.pop(),S=g.observers;if(S&&S.length){const q=S.pop(),k=g.observerSlots.pop();L<S.length&&(q.sourceSlots[k]=L,S[L]=q,g.observerSlots[L]=k)}}if(B.owned){for(w=0;w<B.owned.length;w++)Ge(B.owned[w]);B.owned=null}if(B.cleanups){for(w=0;w<B.cleanups.length;w++)B.cleanups[w]();B.cleanups=null}B.state=0,B.context=null}function Mi(B){throw B}function xs(B,w){return je(()=>B(w||{}))}function gs(B,w,g){let L=g.length,S=w.length,q=L,k=0,J=0,rt=w[S-1].nextSibling,ft=null;for(;k<S||J<q;){if(w[k]===g[J]){k++,J++;continue}for(;w[S-1]===g[q-1];)S--,q--;if(S===k){const b=q<L?J?g[J-1].nextSibling:g[q-J]:rt;for(;J<q;)B.insertBefore(g[J++],b)}else if(q===J)for(;k<S;)(!ft||!ft.has(w[k]))&&w[k].remove(),k++;else if(w[k]===g[q-1]&&g[J]===w[S-1]){const b=w[--S].nextSibling;B.insertBefore(g[J++],w[k++].nextSibling),B.insertBefore(g[--q],b),w[S]=g[q]}else{if(!ft){ft=new Map;let r=J;for(;r<q;)ft.set(g[r],r++)}const b=ft.get(w[k]);if(b!=null)if(J<b&&b<q){let r=k,W=1,P;for(;++r<S&&r<q&&!((P=ft.get(w[r]))==null||P!==b+W);)W++;if(W>b-J){const Tt=w[k];for(;J<b;)B.insertBefore(g[J++],Tt)}else B.replaceChild(g[J++],w[k++])}else k++;else w[k++].remove()}}}function Bs(B,w,g){let L;return _s(S=>{L=S,w===document?B():Vs(w,B(),w.firstChild?null:void 0,g)}),()=>{L(),w.textContent=""}}function bs(B,w,g){const L=document.createElement("template");L.innerHTML=B;let S=L.content.firstChild;return g&&(S=S.firstChild),S}function Ai(B,w,g){g==null?B.removeAttribute(w):B.setAttribute(w,g)}function Vs(B,w,g,L){if(g!==void 0&&!L&&(L=[]),typeof w!="function")return xe(B,w,L,g);Ae(S=>xe(B,w(),S,g),L)}function xe(B,w,g,L,S){for($t.context&&!g&&(g=[...B.childNodes]);typeof g=="function";)g=g();if(w===g)return g;const q=typeof w,k=L!==void 0;if(B=k&&g[0]&&g[0].parentNode||B,q==="string"||q==="number"){if($t.context)return g;if(q==="number"&&(w=w.toString()),k){let J=g[0];J&&J.nodeType===3?J.data=w:J=document.createTextNode(w),g=ie(B,g,L,J)}else g!==""&&typeof g=="string"?g=B.firstChild.data=w:g=B.textContent=w}else if(w==null||q==="boolean"){if($t.context)return g;g=ie(B,g,L)}else{if(q==="function")return Ae(()=>{let J=w();for(;typeof J=="function";)J=J();g=xe(B,J,g,L)}),()=>g;if(Array.isArray(w)){const J=[];if(Ze(J,w,S))return Ae(()=>g=xe(B,J,g,L,!0)),()=>g;if($t.context){for(let rt=0;rt<J.length;rt++)if(J[rt].parentNode)return g=J}if(J.length===0){if(g=ie(B,g,L),k)return g}else Array.isArray(g)?g.length===0?xi(B,J,L):gs(B,g,J):(g&&ie(B),xi(B,J));g=J}else if(w instanceof Node){if($t.context&&w.parentNode)return g=k?[w]:w;if(Array.isArray(g)){if(k)return g=ie(B,g,L,w);ie(B,g,null,w)}else g==null||g===""||!B.firstChild?B.appendChild(w):B.replaceChild(w,B.firstChild);g=w}}return g}function Ze(B,w,g){let L=!1;for(let S=0,q=w.length;S<q;S++){let k=w[S],J;if(k instanceof Node)B.push(k);else if(!(k==null||k===!0||k===!1))if(Array.isArray(k))L=Ze(B,k)||L;else if((J=typeof k)=="string")B.push(document.createTextNode(k));else if(J==="function")if(g){for(;typeof k=="function";)k=k();L=Ze(B,Array.isArray(k)?k:[k])||L}else B.push(k),L=!0;else B.push(document.createTextNode(k.toString()))}return L}function xi(B,w,g){for(let L=0,S=w.length;L<S;L++)B.insertBefore(w[L],g)}function ie(B,w,g,L){if(g===void 0)return B.textContent="";const S=L||document.createTextNode("");if(w.length){let q=!1;for(let k=w.length-1;k>=0;k--){const J=w[k];if(S!==J){const rt=J.parentNode===B;!q&&!k?rt?B.replaceChild(S,J):B.insertBefore(S,g):rt&&J.remove()}else q=!0}}else B.insertBefore(S,g);return[S]}var ws=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},st={exports:{}};/**
 * Planck.js v1.0.0-alpha.4
 * @license The MIT license
 * @copyright Copyright (c) 2021 Erin Catto, Ali Shakiba
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */(function(B,w){(function(g,L){L(w)})(ws,function(g){/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var L=function(i,t){return L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,s){e.__proto__=s}||function(e,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o])},L(i,t)};function S(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");L(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var q=function(){return q=Object.assign||function(t){for(var e,s=1,o=arguments.length;s<o;s++){e=arguments[s];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},q.apply(this,arguments)};function k(i,t){(i===null||typeof i>"u")&&(i={});var e=q({},i);for(var s in t)t.hasOwnProperty(s)&&typeof i[s]>"u"&&(e[s]=t[s]);if(typeof Object.getOwnPropertySymbols=="function")for(var o=Object.getOwnPropertySymbols(t),a=0;a<o.length;a++){var n=o[a];t.propertyIsEnumerable(n)&&typeof i[n]>"u"&&(e[n]=t[n])}return e}var J=function(){},rt=function(i,t,e){},ft={assert:rt,debug:J},b=Object.create(Math);b.EPSILON=1e-9,b.isFinite=function(i){return typeof i=="number"&&isFinite(i)&&!isNaN(i)},b.assert=function(i){},b.invSqrt=function(i){return 1/Math.sqrt(i)},b.nextPowerOfTwo=function(i){return i|=i>>1,i|=i>>2,i|=i>>4,i|=i>>8,i|=i>>16,i+1},b.isPowerOfTwo=function(i){return i>0&&(i&i-1)===0},b.mod=function(i,t,e){return typeof t>"u"?(e=1,t=0):typeof e>"u"&&(e=t,t=0),e>t?(i=(i-t)%(e-t),i+(i<0?e:t)):(i=(i-e)%(t-e),i+(i<=0?t:e))},b.clamp=function(i,t,e){return i<t?t:i>e?e:i},b.random=function(i,t){return typeof i>"u"?(t=1,i=0):typeof t>"u"&&(t=i,i=0),i===t?i:Math.random()*(t-i)+i};var r=function(){function i(t,e){if(!(this instanceof i))return new i(t,e);typeof t>"u"?(this.x=0,this.y=0):typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}return i.prototype._serialize=function(){return{x:this.x,y:this.y}},i._deserialize=function(t){var e=Object.create(i.prototype);return e.x=t.x,e.y=t.y,e},i.zero=function(){var t=Object.create(i.prototype);return t.x=0,t.y=0,t},i.neo=function(t,e){var s=Object.create(i.prototype);return s.x=t,s.y=e,s},i.clone=function(t){return i.neo(t.x,t.y)},i.prototype.toString=function(){return JSON.stringify(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:b.isFinite(t.x)&&b.isFinite(t.y)},i.assert=function(t){},i.prototype.clone=function(){return i.clone(this)},i.prototype.setZero=function(){return this.x=0,this.y=0,this},i.prototype.set=function(t,e){return typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this},i.prototype.setNum=function(t,e){return this.x=t,this.y=e,this},i.prototype.setVec2=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.wSet=function(t,e,s,o){return typeof s<"u"||typeof o<"u"?this.setCombine(t,e,s,o):this.setMul(t,e)},i.prototype.setCombine=function(t,e,s,o){var a=t*e.x+s*o.x,n=t*e.y+s*o.y;return this.x=a,this.y=n,this},i.prototype.setMul=function(t,e){var s=t*e.x,o=t*e.y;return this.x=s,this.y=o,this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.prototype.wAdd=function(t,e,s,o){return typeof s<"u"||typeof o<"u"?this.addCombine(t,e,s,o):this.addMul(t,e)},i.prototype.addCombine=function(t,e,s,o){var a=t*e.x+s*o.x,n=t*e.y+s*o.y;return this.x+=a,this.y+=n,this},i.prototype.addMul=function(t,e){var s=t*e.x,o=t*e.y;return this.x+=s,this.y+=o,this},i.prototype.wSub=function(t,e,s,o){return typeof s<"u"||typeof o<"u"?this.subCombine(t,e,s,o):this.subMul(t,e)},i.prototype.subCombine=function(t,e,s,o){var a=t*e.x+s*o.x,n=t*e.y+s*o.y;return this.x-=a,this.y-=n,this},i.prototype.subMul=function(t,e){var s=t*e.x,o=t*e.y;return this.x-=s,this.y-=o,this},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.mul=function(t){return this.x*=t,this.y*=t,this},i.prototype.length=function(){return i.lengthOf(this)},i.prototype.lengthSquared=function(){return i.lengthSquared(this)},i.prototype.normalize=function(){var t=this.length();if(t<b.EPSILON)return 0;var e=1/t;return this.x*=e,this.y*=e,t},i.lengthOf=function(t){return b.sqrt(t.x*t.x+t.y*t.y)},i.lengthSquared=function(t){return t.x*t.x+t.y*t.y},i.distance=function(t,e){var s=t.x-e.x,o=t.y-e.y;return b.sqrt(s*s+o*o)},i.distanceSquared=function(t,e){var s=t.x-e.x,o=t.y-e.y;return s*s+o*o},i.areEqual=function(t,e){return t===e||typeof e=="object"&&e!==null&&t.x===e.x&&t.y===e.y},i.skew=function(t){return i.neo(-t.y,t.x)},i.dot=function(t,e){return t.x*e.x+t.y*e.y},i.cross=function(t,e){return typeof e=="number"?i.neo(e*t.y,-e*t.x):typeof t=="number"?i.neo(-t*e.y,t*e.x):t.x*e.y-t.y*e.x},i.crossVec2Vec2=function(t,e){return t.x*e.y-t.y*e.x},i.crossVec2Num=function(t,e){return i.neo(e*t.y,-e*t.x)},i.crossNumVec2=function(t,e){return i.neo(-t*e.y,t*e.x)},i.addCross=function(t,e,s){if(typeof s=="number")return i.neo(s*e.y+t.x,-s*e.x+t.y);if(typeof e=="number")return i.neo(-e*s.y+t.x,e*s.x+t.y)},i.addCrossVec2Num=function(t,e,s){return i.neo(s*e.y+t.x,-s*e.x+t.y)},i.addCrossNumVec2=function(t,e,s){return i.neo(-e*s.y+t.x,e*s.x+t.y)},i.add=function(t,e){return i.neo(t.x+e.x,t.y+e.y)},i.wAdd=function(t,e,s,o){return typeof s<"u"||typeof o<"u"?i.combine(t,e,s,o):i.mulNumVec2(t,e)},i.combine=function(t,e,s,o){return i.zero().setCombine(t,e,s,o)},i.sub=function(t,e){return i.neo(t.x-e.x,t.y-e.y)},i.mul=function(t,e){if(typeof t=="object")return i.neo(t.x*e,t.y*e);if(typeof e=="object")return i.neo(t*e.x,t*e.y)},i.mulVec2Num=function(t,e){return i.neo(t.x*e,t.y*e)},i.mulNumVec2=function(t,e){return i.neo(t*e.x,t*e.y)},i.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},i.neg=function(t){return i.neo(-t.x,-t.y)},i.abs=function(t){return i.neo(b.abs(t.x),b.abs(t.y))},i.mid=function(t,e){return i.neo((t.x+e.x)*.5,(t.y+e.y)*.5)},i.upper=function(t,e){return i.neo(b.max(t.x,e.x),b.max(t.y,e.y))},i.lower=function(t,e){return i.neo(b.min(t.x,e.x),b.min(t.y,e.y))},i.prototype.clamp=function(t){var e=this.x*this.x+this.y*this.y;if(e>t*t){var s=b.invSqrt(e);this.x*=s*t,this.y*=s*t}return this},i.clamp=function(t,e){return t=i.neo(t.x,t.y),t.clamp(e),t},i.scaleFn=function(t,e){return function(s){return i.neo(s.x*t,s.y*e)}},i.translateFn=function(t,e){return function(s){return i.neo(s.x+t,s.y+e)}},i}(),W=function(){function i(t,e){if(!(this instanceof i))return new i(t,e);this.lowerBound=r.zero(),this.upperBound=r.zero(),typeof t=="object"&&this.lowerBound.setVec2(t),typeof e=="object"?this.upperBound.setVec2(e):typeof t=="object"&&this.upperBound.setVec2(t)}return i.prototype.isValid=function(){return i.isValid(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:r.isValid(t.lowerBound)&&r.isValid(t.upperBound)&&r.sub(t.upperBound,t.lowerBound).lengthSquared()>=0},i.assert=function(t){},i.prototype.getCenter=function(){return r.neo((this.lowerBound.x+this.upperBound.x)*.5,(this.lowerBound.y+this.upperBound.y)*.5)},i.prototype.getExtents=function(){return r.neo((this.upperBound.x-this.lowerBound.x)*.5,(this.upperBound.y-this.lowerBound.y)*.5)},i.prototype.getPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)},i.prototype.combine=function(t,e){e=e||this;var s=t.lowerBound,o=t.upperBound,a=e.lowerBound,n=e.upperBound,m=b.min(s.x,a.x),c=b.min(s.y,a.y),p=b.max(n.x,o.x),_=b.max(n.y,o.y);this.lowerBound.setNum(m,c),this.upperBound.setNum(p,_)},i.prototype.combinePoints=function(t,e){this.lowerBound.setNum(b.min(t.x,e.x),b.min(t.y,e.y)),this.upperBound.setNum(b.max(t.x,e.x),b.max(t.y,e.y))},i.prototype.set=function(t){this.lowerBound.setNum(t.lowerBound.x,t.lowerBound.y),this.upperBound.setNum(t.upperBound.x,t.upperBound.y)},i.prototype.contains=function(t){var e=!0;return e=e&&this.lowerBound.x<=t.lowerBound.x,e=e&&this.lowerBound.y<=t.lowerBound.y,e=e&&t.upperBound.x<=this.upperBound.x,e=e&&t.upperBound.y<=this.upperBound.y,e},i.prototype.extend=function(t){return i.extend(this,t),this},i.extend=function(t,e){t.lowerBound.x-=e,t.lowerBound.y-=e,t.upperBound.x+=e,t.upperBound.y+=e},i.testOverlap=function(t,e){var s=e.lowerBound.x-t.upperBound.x,o=t.lowerBound.x-e.upperBound.x,a=e.lowerBound.y-t.upperBound.y,n=t.lowerBound.y-e.upperBound.y;return!(s>0||a>0||o>0||n>0)},i.areEqual=function(t,e){return r.areEqual(t.lowerBound,e.lowerBound)&&r.areEqual(t.upperBound,e.upperBound)},i.diff=function(t,e){var s=b.max(0,b.min(t.upperBound.x,e.upperBound.x)-b.max(e.lowerBound.x,t.lowerBound.x)),o=b.max(0,b.min(t.upperBound.y,e.upperBound.y)-b.max(e.lowerBound.y,t.lowerBound.y)),a=t.upperBound.x-t.lowerBound.x,n=t.upperBound.y-t.lowerBound.y,m=e.upperBound.x-e.lowerBound.x,c=e.upperBound.y-e.lowerBound.y;return a*n+m*c-s*o},i.prototype.rayCast=function(t,e){for(var s=-1/0,o=1/0,a=e.p1,n=r.sub(e.p2,e.p1),m=r.abs(n),c=r.zero(),p="x";p!==null;p=p==="x"?"y":null)if(m.x<b.EPSILON){if(a[p]<this.lowerBound[p]||this.upperBound[p]<a[p])return!1}else{var _=1/n[p],v=(this.lowerBound[p]-a[p])*_,u=(this.upperBound[p]-a[p])*_,h=-1;if(v>u){var l=v;v=u,u=l,h=1}if(v>s&&(c.setZero(),c[p]=h,s=v),o=b.min(o,u),s>o)return!1}return s<0||e.maxFraction<s?!1:(t.fraction=s,t.normal=c,!0)},i.prototype.toString=function(){return JSON.stringify(this)},i}(),P=function(){function i(){}return Object.defineProperty(i,"linearSlopSquared",{get:function(){return i.linearSlop*i.linearSlop},enumerable:!1,configurable:!0}),Object.defineProperty(i,"polygonRadius",{get:function(){return 2*i.linearSlop},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxTranslationSquared",{get:function(){return i.maxTranslation*i.maxTranslation},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxRotationSquared",{get:function(){return i.maxRotation*i.maxRotation},enumerable:!1,configurable:!0}),Object.defineProperty(i,"linearSleepToleranceSqr",{get:function(){return Math.pow(i.linearSleepTolerance,2)},enumerable:!1,configurable:!0}),Object.defineProperty(i,"angularSleepToleranceSqr",{get:function(){return Math.pow(i.angularSleepTolerance,2)},enumerable:!1,configurable:!0}),i.maxManifoldPoints=2,i.maxPolygonVertices=12,i.aabbExtension=.1,i.aabbMultiplier=2,i.linearSlop=.005,i.angularSlop=2/180*Math.PI,i.maxSubSteps=8,i.maxTOIContacts=32,i.maxTOIIterations=20,i.maxDistnceIterations=20,i.velocityThreshold=1,i.maxLinearCorrection=.2,i.maxAngularCorrection=8/180*Math.PI,i.maxTranslation=2,i.maxRotation=.5*Math.PI,i.baumgarte=.2,i.toiBaugarte=.75,i.timeToSleep=.5,i.linearSleepTolerance=.01,i.angularSleepTolerance=2/180*Math.PI,i}(),Tt=function(){function i(t){this._list=[],this._max=1/0,this._createCount=0,this._outCount=0,this._inCount=0,this._discardCount=0,this._list=[],this._max=t.max||this._max,this._createFn=t.create,this._outFn=t.allocate,this._inFn=t.release,this._discardFn=t.discard}return i.prototype.max=function(t){return typeof t=="number"?(this._max=t,this):this._max},i.prototype.size=function(){return this._list.length},i.prototype.allocate=function(){var t;return this._list.length>0?t=this._list.shift():(this._createCount++,typeof this._createFn=="function"?t=this._createFn():t={}),this._outCount++,typeof this._outFn=="function"&&this._outFn(t),t},i.prototype.release=function(t){this._list.length<this._max?(this._inCount++,typeof this._inFn=="function"&&this._inFn(t),this._list.push(t)):(this._discardCount++,typeof this._discardFn=="function"&&(t=this._discardFn(t)))},i.prototype.toString=function(){return" +"+this._createCount+" >"+this._outCount+" <"+this._inCount+" -"+this._discardCount+" ="+this._list.length+"/"+this._max},i}(),Mt=function(){function i(t){this.aabb=new W,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.id=t}return i.prototype.toString=function(){return this.id+": "+this.userData},i.prototype.isLeaf=function(){return this.child1==null},i}(),re=function(){function i(){this.inputPool=new Tt({create:function(){return{}},release:function(t){}}),this.stackPool=new Tt({create:function(){return[]},release:function(t){t.length=0}}),this.iteratorPool=new Tt({create:function(){return new Be},release:function(t){t.close()}}),this.m_root=null,this.m_nodes={},this.m_lastProxyId=0,this.m_pool=new Tt({create:function(){return new Mt}})}return i.prototype.getUserData=function(t){var e=this.m_nodes[t];return e.userData},i.prototype.getFatAABB=function(t){var e=this.m_nodes[t];return e.aabb},i.prototype.allocateNode=function(){var t=this.m_pool.allocate();return t.id=++this.m_lastProxyId,t.userData=null,t.parent=null,t.child1=null,t.child2=null,t.height=-1,this.m_nodes[t.id]=t,t},i.prototype.freeNode=function(t){this.m_pool.release(t),t.height=-1,delete this.m_nodes[t.id]},i.prototype.createProxy=function(t,e){var s=this.allocateNode();return s.aabb.set(t),W.extend(s.aabb,P.aabbExtension),s.userData=e,s.height=0,this.insertLeaf(s),s.id},i.prototype.destroyProxy=function(t){var e=this.m_nodes[t];this.removeLeaf(e),this.freeNode(e)},i.prototype.moveProxy=function(t,e,s){var o=this.m_nodes[t];return o.aabb.contains(e)?!1:(this.removeLeaf(o),o.aabb.set(e),e=o.aabb,W.extend(e,P.aabbExtension),s.x<0?e.lowerBound.x+=s.x*P.aabbMultiplier:e.upperBound.x+=s.x*P.aabbMultiplier,s.y<0?e.lowerBound.y+=s.y*P.aabbMultiplier:e.upperBound.y+=s.y*P.aabbMultiplier,this.insertLeaf(o),!0)},i.prototype.insertLeaf=function(t){if(this.m_root==null){this.m_root=t,this.m_root.parent=null;return}for(var e=t.aabb,s=this.m_root;!s.isLeaf();){var o=s.child1,a=s.child2,n=s.aabb.getPerimeter(),m=new W;m.combine(s.aabb,e);var c=m.getPerimeter(),p=2*c,_=2*(c-n),v=void 0;if(o.isLeaf()){var u=new W;u.combine(e,o.aabb),v=u.getPerimeter()+_}else{var u=new W;u.combine(e,o.aabb);var h=o.aabb.getPerimeter(),l=u.getPerimeter();v=l-h+_}var y=void 0;if(a.isLeaf()){var u=new W;u.combine(e,a.aabb),y=u.getPerimeter()+_}else{var u=new W;u.combine(e,a.aabb);var h=a.aabb.getPerimeter(),l=u.getPerimeter();y=l-h+_}if(p<v&&p<y)break;v<y?s=o:s=a}var f=s,d=f.parent,A=this.allocateNode();for(A.parent=d,A.userData=null,A.aabb.combine(e,f.aabb),A.height=f.height+1,d!=null?(d.child1===f?d.child1=A:d.child2=A,A.child1=f,A.child2=t,f.parent=A,t.parent=A):(A.child1=f,A.child2=t,f.parent=A,t.parent=A,this.m_root=A),s=t.parent;s!=null;){s=this.balance(s);var o=s.child1,a=s.child2;s.height=1+b.max(o.height,a.height),s.aabb.combine(o.aabb,a.aabb),s=s.parent}},i.prototype.removeLeaf=function(t){if(t===this.m_root){this.m_root=null;return}var e=t.parent,s=e.parent,o;if(e.child1===t?o=e.child2:o=e.child1,s!=null){s.child1===e?s.child1=o:s.child2=o,o.parent=s,this.freeNode(e);for(var a=s;a!=null;){a=this.balance(a);var n=a.child1,m=a.child2;a.aabb.combine(n.aabb,m.aabb),a.height=1+b.max(n.height,m.height),a=a.parent}}else this.m_root=o,o.parent=null,this.freeNode(e)},i.prototype.balance=function(t){var e=t;if(e.isLeaf()||e.height<2)return t;var s=e.child1,o=e.child2,a=o.height-s.height;if(a>1){var n=o.child1,m=o.child2;return o.child1=e,o.parent=e.parent,e.parent=o,o.parent!=null?o.parent.child1===t?o.parent.child1=o:o.parent.child2=o:this.m_root=o,n.height>m.height?(o.child2=n,e.child2=m,m.parent=e,e.aabb.combine(s.aabb,m.aabb),o.aabb.combine(e.aabb,n.aabb),e.height=1+b.max(s.height,m.height),o.height=1+b.max(e.height,n.height)):(o.child2=m,e.child2=n,n.parent=e,e.aabb.combine(s.aabb,n.aabb),o.aabb.combine(e.aabb,m.aabb),e.height=1+b.max(s.height,n.height),o.height=1+b.max(e.height,m.height)),o}if(a<-1){var c=s.child1,p=s.child2;return s.child1=e,s.parent=e.parent,e.parent=s,s.parent!=null?s.parent.child1===e?s.parent.child1=s:s.parent.child2=s:this.m_root=s,c.height>p.height?(s.child2=c,e.child1=p,p.parent=e,e.aabb.combine(o.aabb,p.aabb),s.aabb.combine(e.aabb,c.aabb),e.height=1+b.max(o.height,p.height),s.height=1+b.max(e.height,c.height)):(s.child2=p,e.child1=c,c.parent=e,e.aabb.combine(o.aabb,c.aabb),s.aabb.combine(e.aabb,p.aabb),e.height=1+b.max(o.height,c.height),s.height=1+b.max(e.height,p.height)),s}return e},i.prototype.getHeight=function(){return this.m_root==null?0:this.m_root.height},i.prototype.getAreaRatio=function(){if(this.m_root==null)return 0;for(var t=this.m_root,e=t.aabb.getPerimeter(),s=0,o,a=this.iteratorPool.allocate().preorder(this.m_root);o=a.next();)o.height<0||(s+=o.aabb.getPerimeter());return this.iteratorPool.release(a),s/e},i.prototype.computeHeight=function(t){var e;if(typeof t<"u"?e=this.m_nodes[t]:e=this.m_root,e.isLeaf())return 0;var s=this.computeHeight(e.child1.id),o=this.computeHeight(e.child2.id);return 1+b.max(s,o)},i.prototype.validateStructure=function(t){if(t!=null){this.m_root;var e=t.child1,s=t.child2;t.isLeaf()||(this.validateStructure(e),this.validateStructure(s))}},i.prototype.validateMetrics=function(t){if(t!=null){var e=t.child1,s=t.child2;if(!t.isLeaf()){var o=e.height,a=s.height;1+b.max(o,a);var n=new W;n.combine(e.aabb,s.aabb),this.validateMetrics(e),this.validateMetrics(s)}}},i.prototype.validate=function(){this.validateStructure(this.m_root),this.validateMetrics(this.m_root)},i.prototype.getMaxBalance=function(){for(var t=0,e,s=this.iteratorPool.allocate().preorder(this.m_root);e=s.next();)if(!(e.height<=1)){var o=b.abs(e.child2.height-e.child1.height);t=b.max(t,o)}return this.iteratorPool.release(s),t},i.prototype.rebuildBottomUp=function(){for(var t=[],e=0,s,o=this.iteratorPool.allocate().preorder(this.m_root);s=o.next();)s.height<0||(s.isLeaf()?(s.parent=null,t[e]=s,++e):this.freeNode(s));for(this.iteratorPool.release(o);e>1;){for(var a=1/0,n=-1,m=-1,c=0;c<e;++c)for(var p=t[c].aabb,_=c+1;_<e;++_){var v=t[_].aabb,u=new W;u.combine(p,v);var h=u.getPerimeter();h<a&&(n=c,m=_,a=h)}var l=t[n],y=t[m],f=this.allocateNode();f.child1=l,f.child2=y,f.height=1+b.max(l.height,y.height),f.aabb.combine(l.aabb,y.aabb),f.parent=null,l.parent=f,y.parent=f,t[m]=t[e-1],t[n]=f,--e}this.m_root=t[0],this.validate()},i.prototype.shiftOrigin=function(t){for(var e,s=this.iteratorPool.allocate().preorder(this.m_root);e=s.next();){var o=e.aabb;o.lowerBound.x-=t.x,o.lowerBound.y-=t.y,o.upperBound.x-=t.x,o.upperBound.y-=t.y}this.iteratorPool.release(s)},i.prototype.query=function(t,e){var s=this.stackPool.allocate();for(s.push(this.m_root);s.length>0;){var o=s.pop();if(o!=null&&W.testOverlap(o.aabb,t))if(o.isLeaf()){var a=e(o.id);if(a===!1)return}else s.push(o.child1),s.push(o.child2)}this.stackPool.release(s)},i.prototype.rayCast=function(t,e){var s=t.p1,o=t.p2,a=r.sub(o,s);a.normalize();var n=r.crossNumVec2(1,a),m=r.abs(n),c=t.maxFraction,p=new W,_=r.combine(1-c,s,c,o);p.combinePoints(s,_);var v=this.stackPool.allocate(),u=this.inputPool.allocate();for(v.push(this.m_root);v.length>0;){var h=v.pop();if(h!=null&&W.testOverlap(h.aabb,p)!==!1){var l=h.aabb.getCenter(),y=h.aabb.getExtents(),f=b.abs(r.dot(n,r.sub(s,l)))-r.dot(m,y);if(!(f>0))if(h.isLeaf()){u.p1=r.clone(t.p1),u.p2=r.clone(t.p2),u.maxFraction=c;var d=e(u,h.id);if(d===0)return;d>0&&(c=d,_=r.combine(1-c,s,c,o),p.combinePoints(s,_))}else v.push(h.child1),v.push(h.child2)}}this.stackPool.release(v),this.inputPool.release(u)},i}(),Be=function(){function i(){this.parents=[],this.states=[]}return i.prototype.preorder=function(t){return this.parents.length=0,this.parents.push(t),this.states.length=0,this.states.push(0),this},i.prototype.next=function(){for(;this.parents.length>0;){var t=this.parents.length-1,e=this.parents[t];if(this.states[t]===0)return this.states[t]=1,e;if(this.states[t]===1&&(this.states[t]=2,e.child1))return this.parents.push(e.child1),this.states.push(1),e.child1;if(this.states[t]===2&&(this.states[t]=3,e.child2))return this.parents.push(e.child2),this.states.push(1),e.child2;this.parents.pop(),this.states.pop()}},i.prototype.close=function(){this.parents.length=0},i}(),It=function(){function i(){var t=this;this.m_tree=new re,this.m_proxyCount=0,this.m_moveBuffer=[],this.query=function(e,s){t.m_tree.query(e,s)},this.queryCallback=function(e){if(e===t.m_queryProxyId)return!0;var s=b.min(e,t.m_queryProxyId),o=b.max(e,t.m_queryProxyId),a=t.m_tree.getUserData(s),n=t.m_tree.getUserData(o);return t.m_callback(a,n),!0}}return i.prototype.getUserData=function(t){return this.m_tree.getUserData(t)},i.prototype.testOverlap=function(t,e){var s=this.m_tree.getFatAABB(t),o=this.m_tree.getFatAABB(e);return W.testOverlap(s,o)},i.prototype.getFatAABB=function(t){return this.m_tree.getFatAABB(t)},i.prototype.getProxyCount=function(){return this.m_proxyCount},i.prototype.getTreeHeight=function(){return this.m_tree.getHeight()},i.prototype.getTreeBalance=function(){return this.m_tree.getMaxBalance()},i.prototype.getTreeQuality=function(){return this.m_tree.getAreaRatio()},i.prototype.rayCast=function(t,e){this.m_tree.rayCast(t,e)},i.prototype.shiftOrigin=function(t){this.m_tree.shiftOrigin(t)},i.prototype.createProxy=function(t,e){var s=this.m_tree.createProxy(t,e);return this.m_proxyCount++,this.bufferMove(s),s},i.prototype.destroyProxy=function(t){this.unbufferMove(t),this.m_proxyCount--,this.m_tree.destroyProxy(t)},i.prototype.moveProxy=function(t,e,s){var o=this.m_tree.moveProxy(t,e,s);o&&this.bufferMove(t)},i.prototype.touchProxy=function(t){this.bufferMove(t)},i.prototype.bufferMove=function(t){this.m_moveBuffer.push(t)},i.prototype.unbufferMove=function(t){for(var e=0;e<this.m_moveBuffer.length;++e)this.m_moveBuffer[e]===t&&(this.m_moveBuffer[e]=null)},i.prototype.updatePairs=function(t){for(this.m_callback=t;this.m_moveBuffer.length>0;)if(this.m_queryProxyId=this.m_moveBuffer.pop(),this.m_queryProxyId!==null){var e=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(e,this.queryCallback)}},i}(),V=function(){function i(t){if(!(this instanceof i))return new i(t);typeof t=="number"?this.setAngle(t):typeof t=="object"?this.setRot(t):this.setIdentity()}return i.neo=function(t){var e=Object.create(i.prototype);return e.setAngle(t),e},i.clone=function(t){var e=Object.create(i.prototype);return e.s=t.s,e.c=t.c,e},i.identity=function(){var t=Object.create(i.prototype);return t.s=0,t.c=1,t},i.isValid=function(t){return t===null||typeof t>"u"?!1:b.isFinite(t.s)&&b.isFinite(t.c)},i.assert=function(t){},i.prototype.setIdentity=function(){this.s=0,this.c=1},i.prototype.set=function(t){typeof t=="object"?(this.s=t.s,this.c=t.c):(this.s=b.sin(t),this.c=b.cos(t))},i.prototype.setRot=function(t){this.s=t.s,this.c=t.c},i.prototype.setAngle=function(t){this.s=b.sin(t),this.c=b.cos(t)},i.prototype.getAngle=function(){return b.atan2(this.s,this.c)},i.prototype.getXAxis=function(){return r.neo(this.c,this.s)},i.prototype.getYAxis=function(){return r.neo(-this.s,this.c)},i.mul=function(t,e){if("c"in e&&"s"in e){var s=i.identity();return s.s=t.s*e.c+t.c*e.s,s.c=t.c*e.c-t.s*e.s,s}else if("x"in e&&"y"in e)return r.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},i.mulRot=function(t,e){var s=i.identity();return s.s=t.s*e.c+t.c*e.s,s.c=t.c*e.c-t.s*e.s,s},i.mulVec2=function(t,e){return r.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},i.mulSub=function(t,e,s){var o=t.c*(e.x-s.x)-t.s*(e.y-s.y),a=t.s*(e.x-s.x)+t.c*(e.y-s.y);return r.neo(o,a)},i.mulT=function(t,e){if("c"in e&&"s"in e){var s=i.identity();return s.s=t.c*e.s-t.s*e.c,s.c=t.c*e.c+t.s*e.s,s}else if("x"in e&&"y"in e)return r.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},i.mulTRot=function(t,e){var s=i.identity();return s.s=t.c*e.s-t.s*e.c,s.c=t.c*e.c+t.s*e.s,s},i.mulTVec2=function(t,e){return r.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},i}(),R=function(){function i(t,e){if(!(this instanceof i))return new i(t,e);this.p=r.zero(),this.q=V.identity(),typeof t<"u"&&this.p.setVec2(t),typeof e<"u"&&this.q.setAngle(e)}return i.clone=function(t){var e=Object.create(i.prototype);return e.p=r.clone(t.p),e.q=V.clone(t.q),e},i.neo=function(t,e){var s=Object.create(i.prototype);return s.p=r.clone(t),s.q=V.clone(e),s},i.identity=function(){var t=Object.create(i.prototype);return t.p=r.zero(),t.q=V.identity(),t},i.prototype.setIdentity=function(){this.p.setZero(),this.q.setIdentity()},i.prototype.set=function(t,e){typeof e>"u"?(this.p.set(t.p),this.q.set(t.q)):(this.p.set(t),this.q.set(e))},i.prototype.setNum=function(t,e){this.p.setVec2(t),this.q.setAngle(e)},i.prototype.setTransform=function(t){this.p.setVec2(t.p),this.q.setRot(t.q)},i.isValid=function(t){return t===null||typeof t>"u"?!1:r.isValid(t.p)&&V.isValid(t.q)},i.assert=function(t){},i.mul=function(t,e){if(Array.isArray(e)){for(var s=[],o=0;o<e.length;o++)s[o]=i.mul(t,e[o]);return s}else{if("x"in e&&"y"in e)return i.mulVec2(t,e);if("p"in e&&"q"in e)return i.mulXf(t,e)}},i.mulAll=function(t,e){for(var s=[],o=0;o<e.length;o++)s[o]=i.mul(t,e[o]);return s},i.mulFn=function(t){return function(e){return i.mul(t,e)}},i.mulVec2=function(t,e){var s=t.q.c*e.x-t.q.s*e.y+t.p.x,o=t.q.s*e.x+t.q.c*e.y+t.p.y;return r.neo(s,o)},i.mulXf=function(t,e){var s=i.identity();return s.q=V.mulRot(t.q,e.q),s.p=r.add(V.mulVec2(t.q,e.p),t.p),s},i.mulT=function(t,e){if("x"in e&&"y"in e)return i.mulTVec2(t,e);if("p"in e&&"q"in e)return i.mulTXf(t,e)},i.mulTVec2=function(t,e){var s=e.x-t.p.x,o=e.y-t.p.y,a=t.q.c*s+t.q.s*o,n=-t.q.s*s+t.q.c*o;return r.neo(a,n)},i.mulTXf=function(t,e){var s=i.identity();return s.q.setRot(V.mulTRot(t.q,e.q)),s.p.setVec2(V.mulTVec2(t.q,r.sub(e.p,t.p))),s},i}(),Ut=function(){function i(t,e){this.localCenter=r.zero(),this.c=r.zero(),this.a=0,this.alpha0=0,this.c0=r.zero(),this.a0=0}return i.prototype.setTransform=function(t){var e=R.mulVec2(t,this.localCenter);this.c.setVec2(e),this.c0.setVec2(e),this.a=t.q.getAngle(),this.a0=t.q.getAngle()},i.prototype.setLocalCenter=function(t,e){this.localCenter.setVec2(t);var s=R.mulVec2(e,this.localCenter);this.c.setVec2(s),this.c0.setVec2(s)},i.prototype.getTransform=function(t,e){e===void 0&&(e=0),t.q.setAngle((1-e)*this.a0+e*this.a),t.p.setCombine(1-e,this.c0,e,this.c),t.p.sub(V.mulVec2(t.q,this.localCenter))},i.prototype.advance=function(t){var e=(t-this.alpha0)/(1-this.alpha0);this.c0.setCombine(e,this.c,1-e,this.c0),this.a0=e*this.a+(1-e)*this.a0,this.alpha0=t},i.prototype.forward=function(){this.a0=this.a,this.c0.setVec2(this.c)},i.prototype.normalize=function(){var t=b.mod(this.a0,-b.PI,+b.PI);this.a-=this.a0-t,this.a0=t},i.prototype.clone=function(){var t=new i;return t.localCenter.setVec2(this.localCenter),t.alpha0=this.alpha0,t.a0=this.a0,t.a=this.a,t.c0.setVec2(this.c0),t.c.setVec2(this.c),t},i.prototype.set=function(t){this.localCenter.setVec2(t.localCenter),this.alpha0=t.alpha0,this.a0=t.a0,this.a=t.a,this.c0.setVec2(t.c0),this.c.setVec2(t.c)},i}(),le=function(){function i(){this.v=r.zero(),this.w=0}return i}(),Q=function(){function i(){this.c=r.zero(),this.a=0}return i.prototype.getTransform=function(t,e){return t.q.setAngle(this.a),t.p.setVec2(r.sub(this.c,V.mulVec2(t.q,e))),t},i}(),G=function(){function i(){}return i.prototype._reset=function(){},i.isValid=function(t){return t===null||typeof t>"u"?!1:typeof t.m_type=="string"&&typeof t.m_radius=="number"},i.prototype.getRadius=function(){return this.m_radius},i.prototype.getType=function(){return this.m_type},i}(),lt={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535},ut=function(){function i(t,e){this.aabb=new W,this.fixture=t,this.childIndex=e,this.proxyId}return i}(),St=function(){function i(t,e,s){e.shape?(s=e,e=e.shape):typeof s=="number"&&(s={density:s}),s=k(s,lt),this.m_body=t,this.m_friction=s.friction,this.m_restitution=s.restitution,this.m_density=s.density,this.m_isSensor=s.isSensor,this.m_filterGroupIndex=s.filterGroupIndex,this.m_filterCategoryBits=s.filterCategoryBits,this.m_filterMaskBits=s.filterMaskBits,this.m_shape=e,this.m_next=null,this.m_proxies=[],this.m_proxyCount=0;for(var o=this.m_shape.getChildCount(),a=0;a<o;++a)this.m_proxies[a]=new ut(this,a);this.m_userData=s.userData}return i.prototype._reset=function(){var t=this.getBody(),e=t.m_world.m_broadPhase;this.destroyProxies(e),this.m_shape._reset&&this.m_shape._reset();for(var s=this.m_shape.getChildCount(),o=0;o<s;++o)this.m_proxies[o]=new ut(this,o);this.createProxies(e,t.m_xf),t.resetMassData()},i.prototype._serialize=function(){return{friction:this.m_friction,restitution:this.m_restitution,density:this.m_density,isSensor:this.m_isSensor,filterGroupIndex:this.m_filterGroupIndex,filterCategoryBits:this.m_filterCategoryBits,filterMaskBits:this.m_filterMaskBits,shape:this.m_shape}},i._deserialize=function(t,e,s){var o=s(G,t.shape),a=o&&new i(e,o,t);return a},i.prototype.getType=function(){return this.m_shape.getType()},i.prototype.getShape=function(){return this.m_shape},i.prototype.isSensor=function(){return this.m_isSensor},i.prototype.setSensor=function(t){t!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=t)},i.prototype.getUserData=function(){return this.m_userData},i.prototype.setUserData=function(t){this.m_userData=t},i.prototype.getBody=function(){return this.m_body},i.prototype.getNext=function(){return this.m_next},i.prototype.getDensity=function(){return this.m_density},i.prototype.setDensity=function(t){this.m_density=t},i.prototype.getFriction=function(){return this.m_friction},i.prototype.setFriction=function(t){this.m_friction=t},i.prototype.getRestitution=function(){return this.m_restitution},i.prototype.setRestitution=function(t){this.m_restitution=t},i.prototype.testPoint=function(t){return this.m_shape.testPoint(this.m_body.getTransform(),t)},i.prototype.rayCast=function(t,e,s){return this.m_shape.rayCast(t,e,this.m_body.getTransform(),s)},i.prototype.getMassData=function(t){this.m_shape.computeMass(t,this.m_density)},i.prototype.getAABB=function(t){return this.m_proxies[t].aabb},i.prototype.createProxies=function(t,e){this.m_proxyCount=this.m_shape.getChildCount();for(var s=0;s<this.m_proxyCount;++s){var o=this.m_proxies[s];this.m_shape.computeAABB(o.aabb,e,s),o.proxyId=t.createProxy(o.aabb,o)}},i.prototype.destroyProxies=function(t){for(var e=0;e<this.m_proxyCount;++e){var s=this.m_proxies[e];t.destroyProxy(s.proxyId),s.proxyId=null}this.m_proxyCount=0},i.prototype.synchronize=function(t,e,s){for(var o=0;o<this.m_proxyCount;++o){var a=this.m_proxies[o],n=new W,m=new W;this.m_shape.computeAABB(n,e,a.childIndex),this.m_shape.computeAABB(m,s,a.childIndex),a.aabb.combine(n,m);var c=r.sub(s.p,e.p);t.moveProxy(a.proxyId,a.aabb,c)}},i.prototype.setFilterData=function(t){this.m_filterGroupIndex=t.groupIndex,this.m_filterCategoryBits=t.categoryBits,this.m_filterMaskBits=t.maskBits,this.refilter()},i.prototype.getFilterGroupIndex=function(){return this.m_filterGroupIndex},i.prototype.setFilterGroupIndex=function(t){this.m_filterGroupIndex=t},i.prototype.getFilterCategoryBits=function(){return this.m_filterCategoryBits},i.prototype.setFilterCategoryBits=function(t){this.m_filterCategoryBits=t},i.prototype.getFilterMaskBits=function(){return this.m_filterMaskBits},i.prototype.setFilterMaskBits=function(t){this.m_filterMaskBits=t},i.prototype.refilter=function(){if(this.m_body!=null){for(var t=this.m_body.getContactList();t;){var e=t.contact,s=e.getFixtureA(),o=e.getFixtureB();(s==this||o==this)&&e.flagForFiltering(),t=t.next}var a=this.m_body.getWorld();if(a!=null)for(var n=a.m_broadPhase,m=0;m<this.m_proxyCount;++m)n.touchProxy(this.m_proxies[m].proxyId)}},i.prototype.shouldCollide=function(t){if(t.m_filterGroupIndex===this.m_filterGroupIndex&&t.m_filterGroupIndex!==0)return t.m_filterGroupIndex>0;var e=(t.m_filterMaskBits&this.m_filterCategoryBits)!==0,s=(t.m_filterCategoryBits&this.m_filterMaskBits)!==0,o=e&&s;return o},i}(),Ft="static",Qe="kinematic",Vt="dynamic",Ii={type:Ft,position:r.zero(),angle:0,linearVelocity:r.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null},Si=function(){function i(){this.mass=0,this.center=r.zero(),this.I=0}return i}(),tt=function(){function i(t,e){e=k(e,Ii),this.m_world=t,this.m_awakeFlag=e.awake,this.m_autoSleepFlag=e.allowSleep,this.m_bulletFlag=e.bullet,this.m_fixedRotationFlag=e.fixedRotation,this.m_activeFlag=e.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=e.userData,this.m_type=e.type,this.m_type==Vt?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=R.identity(),this.m_xf.p=r.clone(e.position),this.m_xf.q.setAngle(e.angle),this.m_sweep=new Ut,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new le,this.c_position=new Q,this.m_force=r.zero(),this.m_torque=0,this.m_linearVelocity=r.clone(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_gravityScale=e.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null,this.m_destroyed=!1}return i.prototype._serialize=function(){for(var t=[],e=this.m_fixtureList;e;e=e.m_next)t.push(e);return{type:this.m_type,bullet:this.m_bulletFlag,position:this.m_xf.p,angle:this.m_xf.q.getAngle(),linearVelocity:this.m_linearVelocity,angularVelocity:this.m_angularVelocity,fixtures:t}},i._deserialize=function(t,e,s){var o=new i(e,t);if(t.fixtures)for(var a=t.fixtures.length-1;a>=0;a--){var n=s(St,t.fixtures[a],o);o._addFixture(n)}return o},i.prototype.isWorldLocked=function(){return!!(this.m_world&&this.m_world.isLocked())},i.prototype.getWorld=function(){return this.m_world},i.prototype.getNext=function(){return this.m_next},i.prototype.setUserData=function(t){this.m_userData=t},i.prototype.getUserData=function(){return this.m_userData},i.prototype.getFixtureList=function(){return this.m_fixtureList},i.prototype.getJointList=function(){return this.m_jointList},i.prototype.getContactList=function(){return this.m_contactList},i.prototype.isStatic=function(){return this.m_type==Ft},i.prototype.isDynamic=function(){return this.m_type==Vt},i.prototype.isKinematic=function(){return this.m_type==Qe},i.prototype.setStatic=function(){return this.setType(Ft),this},i.prototype.setDynamic=function(){return this.setType(Vt),this},i.prototype.setKinematic=function(){return this.setType(Qe),this},i.prototype.getType=function(){return this.m_type},i.prototype.setType=function(t){if(this.isWorldLocked()!=!0&&this.m_type!=t){this.m_type=t,this.resetMassData(),this.m_type==Ft&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var s=e;e=e.next,this.m_world.destroyContact(s.contact)}this.m_contactList=null;for(var o=this.m_world.m_broadPhase,a=this.m_fixtureList;a;a=a.m_next)for(var n=a.m_proxyCount,m=0;m<n;++m)o.touchProxy(a.m_proxies[m].proxyId)}},i.prototype.isBullet=function(){return this.m_bulletFlag},i.prototype.setBullet=function(t){this.m_bulletFlag=!!t},i.prototype.isSleepingAllowed=function(){return this.m_autoSleepFlag},i.prototype.setSleepingAllowed=function(t){this.m_autoSleepFlag=!!t,this.m_autoSleepFlag==!1&&this.setAwake(!0)},i.prototype.isAwake=function(){return this.m_awakeFlag},i.prototype.setAwake=function(t){t?this.m_awakeFlag==!1&&(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},i.prototype.isActive=function(){return this.m_activeFlag},i.prototype.setActive=function(t){if(t!=this.m_activeFlag)if(this.m_activeFlag=!!t,this.m_activeFlag)for(var e=this.m_world.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)s.createProxies(e,this.m_xf);else{for(var e=this.m_world.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)s.destroyProxies(e);for(var o=this.m_contactList;o;){var a=o;o=o.next,this.m_world.destroyContact(a.contact)}this.m_contactList=null}},i.prototype.isFixedRotation=function(){return this.m_fixedRotationFlag},i.prototype.setFixedRotation=function(t){this.m_fixedRotationFlag!=t&&(this.m_fixedRotationFlag=!!t,this.m_angularVelocity=0,this.resetMassData())},i.prototype.getTransform=function(){return this.m_xf},i.prototype.setTransform=function(t,e){if(this.isWorldLocked()!=!0){this.m_xf.setNum(t,e),this.m_sweep.setTransform(this.m_xf);for(var s=this.m_world.m_broadPhase,o=this.m_fixtureList;o;o=o.m_next)o.synchronize(s,this.m_xf,this.m_xf)}},i.prototype.synchronizeTransform=function(){this.m_sweep.getTransform(this.m_xf,1)},i.prototype.synchronizeFixtures=function(){var t=R.identity();this.m_sweep.getTransform(t,0);for(var e=this.m_world.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)s.synchronize(e,t,this.m_xf)},i.prototype.advance=function(t){this.m_sweep.advance(t),this.m_sweep.c.setVec2(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)},i.prototype.getPosition=function(){return this.m_xf.p},i.prototype.setPosition=function(t){this.setTransform(t,this.m_sweep.a)},i.prototype.getAngle=function(){return this.m_sweep.a},i.prototype.setAngle=function(t){this.setTransform(this.m_xf.p,t)},i.prototype.getWorldCenter=function(){return this.m_sweep.c},i.prototype.getLocalCenter=function(){return this.m_sweep.localCenter},i.prototype.getLinearVelocity=function(){return this.m_linearVelocity},i.prototype.getLinearVelocityFromWorldPoint=function(t){var e=r.sub(t,this.m_sweep.c);return r.add(this.m_linearVelocity,r.crossNumVec2(this.m_angularVelocity,e))},i.prototype.getLinearVelocityFromLocalPoint=function(t){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(t))},i.prototype.setLinearVelocity=function(t){this.m_type!=Ft&&(r.dot(t,t)>0&&this.setAwake(!0),this.m_linearVelocity.setVec2(t))},i.prototype.getAngularVelocity=function(){return this.m_angularVelocity},i.prototype.setAngularVelocity=function(t){this.m_type!=Ft&&(t*t>0&&this.setAwake(!0),this.m_angularVelocity=t)},i.prototype.getLinearDamping=function(){return this.m_linearDamping},i.prototype.setLinearDamping=function(t){this.m_linearDamping=t},i.prototype.getAngularDamping=function(){return this.m_angularDamping},i.prototype.setAngularDamping=function(t){this.m_angularDamping=t},i.prototype.getGravityScale=function(){return this.m_gravityScale},i.prototype.setGravityScale=function(t){this.m_gravityScale=t},i.prototype.getMass=function(){return this.m_mass},i.prototype.getInertia=function(){return this.m_I+this.m_mass*r.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)},i.prototype.getMassData=function(t){t.mass=this.m_mass,t.I=this.getInertia(),t.center.setVec2(this.m_sweep.localCenter)},i.prototype.resetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.setZero(),this.isStatic()||this.isKinematic()){this.m_sweep.c0.setVec2(this.m_xf.p),this.m_sweep.c.setVec2(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a;return}for(var t=r.zero(),e=this.m_fixtureList;e;e=e.m_next)if(e.m_density!=0){var s=new Si;e.getMassData(s),this.m_mass+=s.mass,t.addMul(s.mass,s.center),this.m_I+=s.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,t.mul(this.m_invMass)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&this.m_fixedRotationFlag==!1?(this.m_I-=this.m_mass*r.dot(t,t),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var o=r.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(t,this.m_xf),this.m_linearVelocity.add(r.crossNumVec2(this.m_angularVelocity,r.sub(this.m_sweep.c,o)))},i.prototype.setMassData=function(t){if(this.isWorldLocked()!=!0&&this.m_type==Vt){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&this.m_fixedRotationFlag==!1&&(this.m_I=t.I-this.m_mass*r.dot(t.center,t.center),this.m_invI=1/this.m_I);var e=r.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(t.center,this.m_xf),this.m_linearVelocity.add(r.crossNumVec2(this.m_angularVelocity,r.sub(this.m_sweep.c,e)))}},i.prototype.applyForce=function(t,e,s){s===void 0&&(s=!0),this.m_type==Vt&&(s&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(t),this.m_torque+=r.crossVec2Vec2(r.sub(e,this.m_sweep.c),t)))},i.prototype.applyForceToCenter=function(t,e){e===void 0&&(e=!0),this.m_type==Vt&&(e&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(t))},i.prototype.applyTorque=function(t,e){e===void 0&&(e=!0),this.m_type==Vt&&(e&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},i.prototype.applyLinearImpulse=function(t,e,s){s===void 0&&(s=!0),this.m_type==Vt&&(s&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.addMul(this.m_invMass,t),this.m_angularVelocity+=this.m_invI*r.crossVec2Vec2(r.sub(e,this.m_sweep.c),t)))},i.prototype.applyAngularImpulse=function(t,e){e===void 0&&(e=!0),this.m_type==Vt&&(e&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},i.prototype.shouldCollide=function(t){if(this.m_type!=Vt&&t.m_type!=Vt)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&e.joint.m_collideConnected==!1)return!1;return!0},i.prototype._addFixture=function(t){if(this.isWorldLocked()==!0)return null;if(this.m_activeFlag){var e=this.m_world.m_broadPhase;t.createProxies(e,this.m_xf)}return t.m_next=this.m_fixtureList,this.m_fixtureList=t,t.m_density>0&&this.resetMassData(),this.m_world.m_newFixture=!0,t},i.prototype.createFixture=function(t,e){if(this.isWorldLocked()==!0)return null;var s=new St(this,t,e);return this._addFixture(s),s},i.prototype.destroyFixture=function(t){if(this.isWorldLocked()!=!0){if(this.m_fixtureList===t)this.m_fixtureList=t.m_next;else for(var e=this.m_fixtureList;e!=null;){if(e.m_next===t){e.m_next=t.m_next;break}e=e.m_next}for(var s=this.m_contactList;s;){var o=s.contact;s=s.next;var a=o.getFixtureA(),n=o.getFixtureB();(t==a||t==n)&&this.m_world.destroyContact(o)}if(this.m_activeFlag){var m=this.m_world.m_broadPhase;t.destroyProxies(m)}t.m_body=null,t.m_next=null,this.m_world.publish("remove-fixture",t),this.resetMassData()}},i.prototype.getWorldPoint=function(t){return R.mulVec2(this.m_xf,t)},i.prototype.getWorldVector=function(t){return V.mulVec2(this.m_xf.q,t)},i.prototype.getLocalPoint=function(t){return R.mulTVec2(this.m_xf,t)},i.prototype.getLocalVector=function(t){return V.mulTVec2(this.m_xf.q,t)},i.STATIC="static",i.KINEMATIC="kinematic",i.DYNAMIC="dynamic",i}(),dt=function(){function i(t,e,s,o){typeof t=="object"&&t!==null?(this.ex=r.clone(t),this.ey=r.clone(e)):typeof t=="number"?(this.ex=r.neo(t,s),this.ey=r.neo(e,o)):(this.ex=r.zero(),this.ey=r.zero())}return i.prototype.toString=function(){return JSON.stringify(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:r.isValid(t.ex)&&r.isValid(t.ey)},i.assert=function(t){},i.prototype.set=function(t,e,s,o){typeof t=="number"&&typeof e=="number"&&typeof s=="number"&&typeof o=="number"?(this.ex.setNum(t,s),this.ey.setNum(e,o)):typeof t=="object"&&typeof e=="object"?(this.ex.setVec2(t),this.ey.setVec2(e)):typeof t=="object"&&(this.ex.setVec2(t.ex),this.ey.setVec2(t.ey))},i.prototype.setIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},i.prototype.setZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},i.prototype.getInverse=function(){var t=this.ex.x,e=this.ey.x,s=this.ex.y,o=this.ey.y,a=t*o-e*s;a!==0&&(a=1/a);var n=new i;return n.ex.x=a*o,n.ey.x=-a*e,n.ex.y=-a*s,n.ey.y=a*t,n},i.prototype.solve=function(t){var e=this.ex.x,s=this.ey.x,o=this.ex.y,a=this.ey.y,n=e*a-s*o;n!==0&&(n=1/n);var m=r.zero();return m.x=n*(a*t.x-s*t.y),m.y=n*(e*t.y-o*t.x),m},i.mul=function(t,e){if(e&&"x"in e&&"y"in e){var s=t.ex.x*e.x+t.ey.x*e.y,o=t.ex.y*e.x+t.ey.y*e.y;return r.neo(s,o)}else if(e&&"ex"in e&&"ey"in e){var a=t.ex.x*e.ex.x+t.ey.x*e.ex.y,n=t.ex.x*e.ey.x+t.ey.x*e.ey.y,m=t.ex.y*e.ex.x+t.ey.y*e.ex.y,c=t.ex.y*e.ey.x+t.ey.y*e.ey.y;return new i(a,n,m,c)}},i.mulVec2=function(t,e){var s=t.ex.x*e.x+t.ey.x*e.y,o=t.ex.y*e.x+t.ey.y*e.y;return r.neo(s,o)},i.mulMat22=function(t,e){var s=t.ex.x*e.ex.x+t.ey.x*e.ex.y,o=t.ex.x*e.ey.x+t.ey.x*e.ey.y,a=t.ex.y*e.ex.x+t.ey.y*e.ex.y,n=t.ex.y*e.ey.x+t.ey.y*e.ey.y;return new i(s,o,a,n)},i.mulT=function(t,e){if(e&&"x"in e&&"y"in e)return r.neo(r.dot(e,t.ex),r.dot(e,t.ey));if(e&&"ex"in e&&"ey"in e){var s=r.neo(r.dot(t.ex,e.ex),r.dot(t.ey,e.ex)),o=r.neo(r.dot(t.ex,e.ey),r.dot(t.ey,e.ey));return new i(s,o)}},i.mulTVec2=function(t,e){return r.neo(r.dot(e,t.ex),r.dot(e,t.ey))},i.mulTMat22=function(t,e){var s=r.neo(r.dot(t.ex,e.ex),r.dot(t.ey,e.ex)),o=r.neo(r.dot(t.ex,e.ey),r.dot(t.ey,e.ey));return new i(s,o)},i.abs=function(t){return new i(r.abs(t.ex),r.abs(t.ey))},i.add=function(t,e){return new i(r.add(t.ex,e.ex),r.add(t.ey,e.ey))},i}(),mt;(function(i){i[i.e_circles=0]="e_circles",i[i.e_faceA=1]="e_faceA",i[i.e_faceB=2]="e_faceB"})(mt||(mt={}));var et;(function(i){i[i.e_vertex=0]="e_vertex",i[i.e_face=1]="e_face"})(et||(et={}));var Zt;(function(i){i[i.nullState=0]="nullState",i[i.addState=1]="addState",i[i.persistState=2]="persistState",i[i.removeState=3]="removeState"})(Zt||(Zt={}));var At=function(){function i(){this.v=r.zero(),this.id=new ei}return i.prototype.set=function(t){this.v.setVec2(t.v),this.id.set(t.id)},i}(),_e=function(){function i(){this.localNormal=r.zero(),this.localPoint=r.zero(),this.points=[new ti,new ti],this.pointCount=0}return i.prototype.getWorldManifold=function(t,e,s,o,a){if(this.pointCount!=0){t=t||new zi;var n=t.normal,m=t.points,c=t.separations;switch(this.type){case mt.e_circles:{n=r.neo(1,0);var p=R.mulVec2(e,this.localPoint),_=R.mulVec2(o,this.points[0].localPoint),v=r.sub(_,p);r.lengthSquared(v)>b.EPSILON*b.EPSILON&&(n.setVec2(v),n.normalize());var u=p.clone().addMul(s,n),h=_.clone().addMul(-a,n);m[0]=r.mid(u,h),c[0]=r.dot(r.sub(h,u),n),m.length=1,c.length=1;break}case mt.e_faceA:{n=V.mulVec2(e.q,this.localNormal);for(var l=R.mulVec2(e,this.localPoint),y=0;y<this.pointCount;++y){var f=R.mulVec2(o,this.points[y].localPoint),u=r.clone(f).addMul(s-r.dot(r.sub(f,l),n),n),h=r.clone(f).subMul(a,n);m[y]=r.mid(u,h),c[y]=r.dot(r.sub(h,u),n)}m.length=this.pointCount,c.length=this.pointCount;break}case mt.e_faceB:{n=V.mulVec2(o.q,this.localNormal);for(var l=R.mulVec2(o,this.localPoint),y=0;y<this.pointCount;++y){var f=R.mulVec2(e,this.points[y].localPoint),h=r.combine(1,f,a-r.dot(r.sub(f,l),n),n),u=r.combine(1,f,-s,n);m[y]=r.mid(u,h),c[y]=r.dot(r.sub(u,h),n)}m.length=this.pointCount,c.length=this.pointCount,n.mul(-1);break}}return t.normal=n,t.points=m,t.separations=c,t}},i.clipSegmentToLine=oe,i.ClipVertex=At,i.getPointStates=Li,i.PointState=Zt,i}(),ti=function(){function i(){this.localPoint=r.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.id=new ei}return i}(),ei=function(){function i(){this.cf=new Pi}return Object.defineProperty(i.prototype,"key",{get:function(){return this.cf.indexA+this.cf.indexB*4+this.cf.typeA*16+this.cf.typeB*64},enumerable:!1,configurable:!0}),i.prototype.set=function(t){this.cf.set(t.cf)},i}(),Pi=function(){function i(){}return i.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.typeA=t.typeA,this.typeB=t.typeB},i}(),zi=function(){function i(){this.points=[],this.separations=[]}return i}();function Li(i,t,e,s){for(var o=0;o<e.pointCount;++o){var a=e.points[o].id;i[o]=Zt.removeState;for(var n=0;n<s.pointCount;++n)if(s.points[n].id.key==a.key){i[o]=Zt.persistState;break}}for(var o=0;o<s.pointCount;++o){var a=s.points[o].id;t[o]=Zt.addState;for(var n=0;n<e.pointCount;++n)if(e.points[n].id.key==a.key){t[o]=Zt.persistState;break}}}function oe(i,t,e,s,o){var a=0,n=r.dot(e,t[0].v)-s,m=r.dot(e,t[1].v)-s;if(n<=0&&i[a++].set(t[0]),m<=0&&i[a++].set(t[1]),n*m<0){var c=n/(n-m);i[a].v.setCombine(1-c,t[0].v,c,t[1].v),i[a].id.cf.indexA=o,i[a].id.cf.indexB=t[0].id.cf.indexB,i[a].id.cf.typeA=et.e_vertex,i[a].id.cf.typeB=et.e_face,++a}return a}var at={gjkCalls:0,gjkIters:0,gjkMaxIters:0,toiTime:0,toiMaxTime:0,toiCalls:0,toiIters:0,toiMaxIters:0,toiRootIters:0,toiMaxRootIters:0,toString:function(i){i=typeof i=="string"?i:`
`;var t="";for(var e in this)typeof this[e]!="function"&&typeof this[e]!="object"&&(t+=e+": "+this[e]+i);return t}};at.gjkCalls=0,at.gjkIters=0,at.gjkMaxIters=0;var be=function(){function i(){this.proxyA=new Xt,this.proxyB=new Xt,this.transformA=null,this.transformB=null,this.useRadii=!1}return i}(),Ve=function(){function i(){this.pointA=r.zero(),this.pointB=r.zero()}return i}(),we=function(){function i(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0}return i}();function qt(i,t,e){++at.gjkCalls;var s=e.proxyA,o=e.proxyB,a=e.transformA,n=e.transformB,m=new Ti;m.readCache(t,s,a,o,n);for(var c=m.m_v,p=P.maxDistnceIterations,_=[],v=[],u=0,h=0;h<p;){u=m.m_count;for(var l=0;l<u;++l)_[l]=c[l].indexA,v[l]=c[l].indexB;if(m.solve(),m.m_count===3)break;var y=m.getClosestPoint();y.lengthSquared();var f=m.getSearchDirection();if(f.lengthSquared()<b.EPSILON*b.EPSILON)break;var d=c[m.m_count];d.indexA=s.getSupport(V.mulTVec2(a.q,r.neg(f))),d.wA=R.mulVec2(a,s.getVertex(d.indexA)),d.indexB=o.getSupport(V.mulTVec2(n.q,f)),d.wB=R.mulVec2(n,o.getVertex(d.indexB)),d.w=r.sub(d.wB,d.wA),++h,++at.gjkIters;for(var A=!1,l=0;l<u;++l)if(d.indexA===_[l]&&d.indexB===v[l]){A=!0;break}if(A)break;++m.m_count}if(at.gjkMaxIters=b.max(at.gjkMaxIters,h),m.getWitnessPoints(i.pointA,i.pointB),i.distance=r.distance(i.pointA,i.pointB),i.iterations=h,m.writeCache(t),e.useRadii){var x=s.m_radius,C=o.m_radius;if(i.distance>x+C&&i.distance>b.EPSILON){i.distance-=x+C;var M=r.sub(i.pointB,i.pointA);M.normalize(),i.pointA.addMul(x,M),i.pointB.subMul(C,M)}else{var y=r.mid(i.pointA,i.pointB);i.pointA.setVec2(y),i.pointB.setVec2(y),i.distance=0}}}var Xt=function(){function i(){this.m_buffer=[],this.m_vertices=[],this.m_count=0,this.m_radius=0}return i.prototype.getVertexCount=function(){return this.m_count},i.prototype.getVertex=function(t){return this.m_vertices[t]},i.prototype.getSupport=function(t){for(var e=0,s=r.dot(this.m_vertices[0],t),o=0;o<this.m_count;++o){var a=r.dot(this.m_vertices[o],t);a>s&&(e=o,s=a)}return e},i.prototype.getSupportVertex=function(t){return this.m_vertices[this.getSupport(t)]},i.prototype.set=function(t,e){t.computeDistanceProxy(this,e)},i}(),Ce=function(){function i(){this.wA=r.zero(),this.wB=r.zero(),this.w=r.zero()}return i.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.wA=r.clone(t.wA),this.wB=r.clone(t.wB),this.w=r.clone(t.w),this.a=t.a},i}(),Ti=function(){function i(){this.m_v1=new Ce,this.m_v2=new Ce,this.m_v3=new Ce,this.m_v=[this.m_v1,this.m_v2,this.m_v3],this.m_count}return i.prototype.toString=function(){return this.m_count===3?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():this.m_count===2?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():this.m_count===1?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count},i.prototype.readCache=function(t,e,s,o,a){this.m_count=t.count;for(var n=0;n<this.m_count;++n){var m=this.m_v[n];m.indexA=t.indexA[n],m.indexB=t.indexB[n];var c=e.getVertex(m.indexA),p=o.getVertex(m.indexB);m.wA=R.mulVec2(s,c),m.wB=R.mulVec2(a,p),m.w=r.sub(m.wB,m.wA),m.a=0}if(this.m_count>1){var _=t.metric,v=this.getMetric();(v<.5*_||2*_<v||v<b.EPSILON)&&(this.m_count=0)}if(this.m_count===0){var m=this.m_v[0];m.indexA=0,m.indexB=0;var c=e.getVertex(0),p=o.getVertex(0);m.wA=R.mulVec2(s,c),m.wB=R.mulVec2(a,p),m.w=r.sub(m.wB,m.wA),m.a=1,this.m_count=1}},i.prototype.writeCache=function(t){t.metric=this.getMetric(),t.count=this.m_count;for(var e=0;e<this.m_count;++e)t.indexA[e]=this.m_v[e].indexA,t.indexB[e]=this.m_v[e].indexB},i.prototype.getSearchDirection=function(){switch(this.m_count){case 1:return r.neg(this.m_v1.w);case 2:{var t=r.sub(this.m_v2.w,this.m_v1.w),e=r.crossVec2Vec2(t,r.neg(this.m_v1.w));return e>0?r.crossNumVec2(1,t):r.crossVec2Num(t,1)}default:return r.zero()}},i.prototype.getClosestPoint=function(){switch(this.m_count){case 0:return r.zero();case 1:return r.clone(this.m_v1.w);case 2:return r.combine(this.m_v1.a,this.m_v1.w,this.m_v2.a,this.m_v2.w);case 3:return r.zero();default:return r.zero()}},i.prototype.getWitnessPoints=function(t,e){switch(this.m_count){case 0:break;case 1:t.setVec2(this.m_v1.wA),e.setVec2(this.m_v1.wB);break;case 2:t.setCombine(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),e.setCombine(this.m_v1.a,this.m_v1.wB,this.m_v2.a,this.m_v2.wB);break;case 3:t.setCombine(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),t.addMul(this.m_v3.a,this.m_v3.wA),e.setVec2(t);break}},i.prototype.getMetric=function(){switch(this.m_count){case 0:return 0;case 1:return 0;case 2:return r.distance(this.m_v1.w,this.m_v2.w);case 3:return r.crossVec2Vec2(r.sub(this.m_v2.w,this.m_v1.w),r.sub(this.m_v3.w,this.m_v1.w));default:return 0}},i.prototype.solve=function(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3();break}},i.prototype.solve2=function(){var t=this.m_v1.w,e=this.m_v2.w,s=r.sub(e,t),o=-r.dot(t,s);if(o<=0){this.m_v1.a=1,this.m_count=1;return}var a=r.dot(e,s);if(a<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.set(this.m_v2);return}var n=1/(a+o);this.m_v1.a=a*n,this.m_v2.a=o*n,this.m_count=2},i.prototype.solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,s=this.m_v3.w,o=r.sub(e,t),a=r.dot(t,o),n=r.dot(e,o),m=n,c=-a,p=r.sub(s,t),_=r.dot(t,p),v=r.dot(s,p),u=v,h=-_,l=r.sub(s,e),y=r.dot(e,l),f=r.dot(s,l),d=f,A=-y,x=r.crossVec2Vec2(o,p),C=x*r.crossVec2Vec2(e,s),M=x*r.crossVec2Vec2(s,t),I=x*r.crossVec2Vec2(t,e);if(c<=0&&h<=0){this.m_v1.a=1,this.m_count=1;return}if(m>0&&c>0&&I<=0){var z=1/(m+c);this.m_v1.a=m*z,this.m_v2.a=c*z,this.m_count=2;return}if(u>0&&h>0&&M<=0){var F=1/(u+h);this.m_v1.a=u*F,this.m_v3.a=h*F,this.m_count=2,this.m_v2.set(this.m_v3);return}if(m<=0&&A<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.set(this.m_v2);return}if(u<=0&&d<=0){this.m_v3.a=1,this.m_count=1,this.m_v1.set(this.m_v3);return}if(d>0&&A>0&&C<=0){var D=1/(d+A);this.m_v2.a=d*D,this.m_v3.a=A*D,this.m_count=2,this.m_v1.set(this.m_v3);return}var E=1/(C+M+I);this.m_v1.a=C*E,this.m_v2.a=M*E,this.m_v3.a=I*E,this.m_count=3},i}();function ii(i,t,e,s,o,a){var n=new be;n.proxyA.set(i,t),n.proxyB.set(e,s),n.transformA=o,n.transformB=a,n.useRadii=!0;var m=new we,c=new Ve;return qt(c,m,n),c.distance<10*b.EPSILON}var si=function(){function i(t){this.contact=t}return i}();function ri(i,t){return b.sqrt(i*t)}function oi(i,t){return i>t?i:t}var jt=[],Fi=function(){function i(){this.rA=r.zero(),this.rB=r.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return i}(),Pt=function(){function i(t,e,s,o,a){this.m_manifold=new _e,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse=new Di(this),this.v_points=[],this.v_normal=r.zero(),this.v_normalMass=new dt,this.v_K=new dt,this.p_localPoints=[],this.p_localNormal=r.zero(),this.p_localPoint=r.zero(),this.p_localCenterA=r.zero(),this.p_localCenterB=r.zero(),this.m_nodeA=new si(this),this.m_nodeB=new si(this),this.m_fixtureA=t,this.m_fixtureB=s,this.m_indexA=e,this.m_indexB=o,this.m_evaluateFcn=a,this.m_friction=ri(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=oi(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}return i.prototype.initConstraint=function(t){var e=this.m_fixtureA,s=this.m_fixtureB,o=e.getShape(),a=s.getShape(),n=e.getBody(),m=s.getBody(),c=this.getManifold(),p=c.pointCount;this.v_invMassA=n.m_invMass,this.v_invMassB=m.m_invMass,this.v_invIA=n.m_invI,this.v_invIB=m.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=p,this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=n.m_invMass,this.p_invMassB=m.m_invMass,this.p_invIA=n.m_invI,this.p_invIB=m.m_invI,this.p_localCenterA=r.clone(n.m_sweep.localCenter),this.p_localCenterB=r.clone(m.m_sweep.localCenter),this.p_radiusA=o.m_radius,this.p_radiusB=a.m_radius,this.p_type=c.type,this.p_localNormal=r.clone(c.localNormal),this.p_localPoint=r.clone(c.localPoint),this.p_pointCount=p;for(var _=0;_<p;++_){var v=c.points[_],u=this.v_points[_]=new Fi;t.warmStarting?(u.normalImpulse=t.dtRatio*v.normalImpulse,u.tangentImpulse=t.dtRatio*v.tangentImpulse):(u.normalImpulse=0,u.tangentImpulse=0),u.rA.setZero(),u.rB.setZero(),u.normalMass=0,u.tangentMass=0,u.velocityBias=0,this.p_localPoints[_]=r.clone(v.localPoint)}},i.prototype.getManifold=function(){return this.m_manifold},i.prototype.getWorldManifold=function(t){var e=this.m_fixtureA.getBody(),s=this.m_fixtureB.getBody(),o=this.m_fixtureA.getShape(),a=this.m_fixtureB.getShape();return this.m_manifold.getWorldManifold(t,e.getTransform(),o.m_radius,s.getTransform(),a.m_radius)},i.prototype.setEnabled=function(t){this.m_enabledFlag=!!t},i.prototype.isEnabled=function(){return this.m_enabledFlag},i.prototype.isTouching=function(){return this.m_touchingFlag},i.prototype.getNext=function(){return this.m_next},i.prototype.getFixtureA=function(){return this.m_fixtureA},i.prototype.getFixtureB=function(){return this.m_fixtureB},i.prototype.getChildIndexA=function(){return this.m_indexA},i.prototype.getChildIndexB=function(){return this.m_indexB},i.prototype.flagForFiltering=function(){this.m_filterFlag=!0},i.prototype.setFriction=function(t){this.m_friction=t},i.prototype.getFriction=function(){return this.m_friction},i.prototype.resetFriction=function(){this.m_friction=ri(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},i.prototype.setRestitution=function(t){this.m_restitution=t},i.prototype.getRestitution=function(){return this.m_restitution},i.prototype.resetRestitution=function(){this.m_restitution=oi(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},i.prototype.setTangentSpeed=function(t){this.m_tangentSpeed=t},i.prototype.getTangentSpeed=function(){return this.m_tangentSpeed},i.prototype.evaluate=function(t,e,s){this.m_evaluateFcn(t,e,this.m_fixtureA,this.m_indexA,s,this.m_fixtureB,this.m_indexB)},i.prototype.update=function(t){this.m_enabledFlag=!0;var e=!1,s=this.m_touchingFlag,o=this.m_fixtureA.isSensor(),a=this.m_fixtureB.isSensor(),n=o||a,m=this.m_fixtureA.getBody(),c=this.m_fixtureB.getBody(),p=m.getTransform(),_=c.getTransform(),v;if(n){var u=this.m_fixtureA.getShape(),h=this.m_fixtureB.getShape();e=ii(u,this.m_indexA,h,this.m_indexB,p,_),this.m_manifold.pointCount=0}else{v=this.m_manifold,this.m_manifold=new _e,this.evaluate(this.m_manifold,p,_),e=this.m_manifold.pointCount>0;for(var l=0;l<this.m_manifold.pointCount;++l){var y=this.m_manifold.points[l];y.normalImpulse=0,y.tangentImpulse=0;for(var f=0;f<v.pointCount;++f){var d=v.points[f];if(d.id.key==y.id.key){y.normalImpulse=d.normalImpulse,y.tangentImpulse=d.tangentImpulse;break}}}e!=s&&(m.setAwake(!0),c.setAwake(!0))}this.m_touchingFlag=e,!s&&e&&t&&t.beginContact(this),s&&!e&&t&&t.endContact(this),!n&&e&&t&&t.preSolve(this,v)},i.prototype.solvePositionConstraint=function(t){return this._solvePositionConstraint(t)},i.prototype.solvePositionConstraintTOI=function(t,e,s){return this._solvePositionConstraint(t,e,s)},i.prototype._solvePositionConstraint=function(t,e,s){var o=!!e&&!!s,a=this.m_fixtureA,n=this.m_fixtureB,m=a.getBody(),c=n.getBody();m.c_velocity,c.c_velocity;var p=m.c_position,_=c.c_position,v=r.clone(this.p_localCenterA),u=r.clone(this.p_localCenterB),h=0,l=0;(!o||m==e||m==s)&&(h=this.p_invMassA,l=this.p_invIA);var y=0,f=0;(!o||c==e||c==s)&&(y=this.p_invMassB,f=this.p_invIB);for(var d=r.clone(p.c),A=p.a,x=r.clone(_.c),C=_.a,M=0,I=0;I<this.p_pointCount;++I){var z=R.identity(),F=R.identity();z.q.setAngle(A),F.q.setAngle(C),z.p=r.sub(d,V.mulVec2(z.q,v)),F.p=r.sub(x,V.mulVec2(F.q,u));var D=void 0,E=void 0,N=void 0;switch(this.p_type){case mt.e_circles:{var T=R.mulVec2(z,this.p_localPoint),Z=R.mulVec2(F,this.p_localPoints[0]);D=r.sub(Z,T),D.normalize(),E=r.combine(.5,T,.5,Z),N=r.dot(r.sub(Z,T),D)-this.p_radiusA-this.p_radiusB;break}case mt.e_faceA:{D=V.mulVec2(z.q,this.p_localNormal);var H=R.mulVec2(z,this.p_localPoint),$=R.mulVec2(F,this.p_localPoints[I]);N=r.dot(r.sub($,H),D)-this.p_radiusA-this.p_radiusB,E=$;break}case mt.e_faceB:{D=V.mulVec2(F.q,this.p_localNormal);var H=R.mulVec2(F,this.p_localPoint),$=R.mulVec2(z,this.p_localPoints[I]);N=r.dot(r.sub($,H),D)-this.p_radiusA-this.p_radiusB,E=$,D.mul(-1);break}}var ot=r.sub(E,d),nt=r.sub(E,x);M=b.min(M,N);var it=o?P.toiBaugarte:P.baumgarte,Y=P.linearSlop,U=P.maxLinearCorrection,X=b.clamp(it*(N+Y),-U,0),O=r.crossVec2Vec2(ot,D),ct=r.crossVec2Vec2(nt,D),xt=h+y+l*O*O+f*ct*ct,wt=xt>0?-X/xt:0,_t=r.mulNumVec2(wt,D);d.subMul(h,_t),A-=l*r.crossVec2Vec2(ot,_t),x.addMul(y,_t),C+=f*r.crossVec2Vec2(nt,_t)}return p.c.setVec2(d),p.a=A,_.c.setVec2(x),_.a=C,M},i.prototype.initVelocityConstraint=function(t){var e=this.m_fixtureA,s=this.m_fixtureB,o=e.getBody(),a=s.getBody(),n=o.c_velocity,m=a.c_velocity,c=o.c_position,p=a.c_position,_=this.p_radiusA,v=this.p_radiusB,u=this.getManifold(),h=this.v_invMassA,l=this.v_invMassB,y=this.v_invIA,f=this.v_invIB,d=r.clone(this.p_localCenterA),A=r.clone(this.p_localCenterB),x=r.clone(c.c),C=c.a,M=r.clone(n.v),I=n.w,z=r.clone(p.c),F=p.a,D=r.clone(m.v),E=m.w,N=R.identity(),T=R.identity();N.q.setAngle(C),T.q.setAngle(F),N.p.setCombine(1,x,-1,V.mulVec2(N.q,d)),T.p.setCombine(1,z,-1,V.mulVec2(T.q,A));var Z=u.getWorldManifold(null,N,_,T,v);this.v_normal.setVec2(Z.normal);for(var H=0;H<this.v_pointCount;++H){var $=this.v_points[H];$.rA.setVec2(r.sub(Z.points[H],x)),$.rB.setVec2(r.sub(Z.points[H],z));var ot=r.crossVec2Vec2($.rA,this.v_normal),nt=r.crossVec2Vec2($.rB,this.v_normal),it=h+l+y*ot*ot+f*nt*nt;$.normalMass=it>0?1/it:0;var Y=r.crossVec2Num(this.v_normal,1),U=r.crossVec2Vec2($.rA,Y),X=r.crossVec2Vec2($.rB,Y),O=h+l+y*U*U+f*X*X;$.tangentMass=O>0?1/O:0,$.velocityBias=0;var ct=r.dot(this.v_normal,D)+r.dot(this.v_normal,r.crossNumVec2(E,$.rB))-r.dot(this.v_normal,M)-r.dot(this.v_normal,r.crossNumVec2(I,$.rA));ct<-P.velocityThreshold&&($.velocityBias=-this.v_restitution*ct)}if(this.v_pointCount==2&&t.blockSolve){var xt=this.v_points[0],wt=this.v_points[1],_t=r.crossVec2Vec2(xt.rA,this.v_normal),Ht=r.crossVec2Vec2(xt.rB,this.v_normal),Qt=r.crossVec2Vec2(wt.rA,this.v_normal),gt=r.crossVec2Vec2(wt.rB,this.v_normal),Jt=h+l+y*_t*_t+f*Ht*Ht,te=h+l+y*Qt*Qt+f*gt*gt,ee=h+l+y*_t*Qt+f*Ht*gt,Ot=1e3;Jt*Jt<Ot*(Jt*te-ee*ee)?(this.v_K.ex.setNum(Jt,ee),this.v_K.ey.setNum(ee,te),this.v_normalMass.set(this.v_K.getInverse())):this.v_pointCount=1}c.c.setVec2(x),c.a=C,n.v.setVec2(M),n.w=I,p.c.setVec2(z),p.a=F,m.v.setVec2(D),m.w=E},i.prototype.warmStartConstraint=function(t){var e=this.m_fixtureA,s=this.m_fixtureB,o=e.getBody(),a=s.getBody(),n=o.c_velocity,m=a.c_velocity;o.c_position,a.c_position;for(var c=this.v_invMassA,p=this.v_invIA,_=this.v_invMassB,v=this.v_invIB,u=r.clone(n.v),h=n.w,l=r.clone(m.v),y=m.w,f=this.v_normal,d=r.crossVec2Num(f,1),A=0;A<this.v_pointCount;++A){var x=this.v_points[A],C=r.combine(x.normalImpulse,f,x.tangentImpulse,d);h-=p*r.crossVec2Vec2(x.rA,C),u.subMul(c,C),y+=v*r.crossVec2Vec2(x.rB,C),l.addMul(_,C)}n.v.setVec2(u),n.w=h,m.v.setVec2(l),m.w=y},i.prototype.storeConstraintImpulses=function(t){for(var e=this.m_manifold,s=0;s<this.v_pointCount;++s)e.points[s].normalImpulse=this.v_points[s].normalImpulse,e.points[s].tangentImpulse=this.v_points[s].tangentImpulse},i.prototype.solveVelocityConstraint=function(t){var e=this.m_fixtureA.m_body,s=this.m_fixtureB.m_body,o=e.c_velocity;e.c_position;var a=s.c_velocity;s.c_position;for(var n=this.v_invMassA,m=this.v_invIA,c=this.v_invMassB,p=this.v_invIB,_=r.clone(o.v),v=o.w,u=r.clone(a.v),h=a.w,l=this.v_normal,y=r.crossVec2Num(l,1),f=this.v_friction,d=0;d<this.v_pointCount;++d){var A=this.v_points[d],x=r.zero();x.addCombine(1,u,1,r.crossNumVec2(h,A.rB)),x.subCombine(1,_,1,r.crossNumVec2(v,A.rA));var C=r.dot(x,y)-this.v_tangentSpeed,M=A.tangentMass*-C,I=f*A.normalImpulse,z=b.clamp(A.tangentImpulse+M,-I,I);M=z-A.tangentImpulse,A.tangentImpulse=z;var F=r.mulNumVec2(M,y);_.subMul(n,F),v-=m*r.crossVec2Vec2(A.rA,F),u.addMul(c,F),h+=p*r.crossVec2Vec2(A.rB,F)}if(this.v_pointCount==1||t.blockSolve==!1)for(var D=0;D<this.v_pointCount;++D){var A=this.v_points[D],x=r.zero();x.addCombine(1,u,1,r.crossNumVec2(h,A.rB)),x.subCombine(1,_,1,r.crossNumVec2(v,A.rA));var E=r.dot(x,l),M=-A.normalMass*(E-A.velocityBias),z=b.max(A.normalImpulse+M,0);M=z-A.normalImpulse,A.normalImpulse=z;var F=r.mulNumVec2(M,l);_.subMul(n,F),v-=m*r.crossVec2Vec2(A.rA,F),u.addMul(c,F),h+=p*r.crossVec2Vec2(A.rB,F)}else{var N=this.v_points[0],T=this.v_points[1],Z=r.neo(N.normalImpulse,T.normalImpulse),H=r.zero().add(u).add(r.crossNumVec2(h,N.rB)).sub(_).sub(r.crossNumVec2(v,N.rA)),$=r.zero().add(u).add(r.crossNumVec2(h,T.rB)).sub(_).sub(r.crossNumVec2(v,T.rA)),ot=r.dot(H,l),nt=r.dot($,l),it=r.neo(ot-N.velocityBias,nt-T.velocityBias);for(it.sub(dt.mulVec2(this.v_K,Z));;){var Y=dt.mulVec2(this.v_normalMass,it).neg();if(Y.x>=0&&Y.y>=0){var U=r.sub(Y,Z),X=r.mulNumVec2(U.x,l),O=r.mulNumVec2(U.y,l);_.subCombine(n,X,n,O),v-=m*(r.crossVec2Vec2(N.rA,X)+r.crossVec2Vec2(T.rA,O)),u.addCombine(c,X,c,O),h+=p*(r.crossVec2Vec2(N.rB,X)+r.crossVec2Vec2(T.rB,O)),N.normalImpulse=Y.x,T.normalImpulse=Y.y;break}if(Y.x=-N.normalMass*it.x,Y.y=0,ot=0,nt=this.v_K.ex.y*Y.x+it.y,Y.x>=0&&nt>=0){var U=r.sub(Y,Z),X=r.mulNumVec2(U.x,l),O=r.mulNumVec2(U.y,l);_.subCombine(n,X,n,O),v-=m*(r.crossVec2Vec2(N.rA,X)+r.crossVec2Vec2(T.rA,O)),u.addCombine(c,X,c,O),h+=p*(r.crossVec2Vec2(N.rB,X)+r.crossVec2Vec2(T.rB,O)),N.normalImpulse=Y.x,T.normalImpulse=Y.y;break}if(Y.x=0,Y.y=-T.normalMass*it.y,ot=this.v_K.ey.x*Y.y+it.x,nt=0,Y.y>=0&&ot>=0){var U=r.sub(Y,Z),X=r.mulNumVec2(U.x,l),O=r.mulNumVec2(U.y,l);_.subCombine(n,X,n,O),v-=m*(r.crossVec2Vec2(N.rA,X)+r.crossVec2Vec2(T.rA,O)),u.addCombine(c,X,c,O),h+=p*(r.crossVec2Vec2(N.rB,X)+r.crossVec2Vec2(T.rB,O)),N.normalImpulse=Y.x,T.normalImpulse=Y.y;break}if(Y.x=0,Y.y=0,ot=it.x,nt=it.y,ot>=0&&nt>=0){var U=r.sub(Y,Z),X=r.mulNumVec2(U.x,l),O=r.mulNumVec2(U.y,l);_.subCombine(n,X,n,O),v-=m*(r.crossVec2Vec2(N.rA,X)+r.crossVec2Vec2(T.rA,O)),u.addCombine(c,X,c,O),h+=p*(r.crossVec2Vec2(N.rB,X)+r.crossVec2Vec2(T.rB,O)),N.normalImpulse=Y.x,T.normalImpulse=Y.y;break}break}}o.v.setVec2(_),o.w=v,a.v.setVec2(u),a.w=h},i.addType=function(t,e,s){jt[t]=jt[t]||{},jt[t][e]=s},i.create=function(t,e,s,o){var a=t.getType(),n=s.getType(),m,c;if(c=jt[a]&&jt[a][n])m=new i(t,e,s,o,c);else if(c=jt[n]&&jt[n][a])m=new i(s,o,t,e,c);else return null;t=m.getFixtureA(),s=m.getFixtureB(),e=m.getChildIndexA(),o=m.getChildIndexB();var p=t.getBody(),_=s.getBody();return m.m_nodeA.contact=m,m.m_nodeA.other=_,m.m_nodeA.prev=null,m.m_nodeA.next=p.m_contactList,p.m_contactList!=null&&(p.m_contactList.prev=m.m_nodeA),p.m_contactList=m.m_nodeA,m.m_nodeB.contact=m,m.m_nodeB.other=p,m.m_nodeB.prev=null,m.m_nodeB.next=_.m_contactList,_.m_contactList!=null&&(_.m_contactList.prev=m.m_nodeB),_.m_contactList=m.m_nodeB,t.isSensor()==!1&&s.isSensor()==!1&&(p.setAwake(!0),_.setAwake(!0)),m},i.destroy=function(t,e){var s=t.m_fixtureA,o=t.m_fixtureB,a=s.getBody(),n=o.getBody();t.isTouching()&&e.endContact(t),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==a.m_contactList&&(a.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&s.isSensor()==!1&&o.isSensor()==!1&&(a.setAwake(!0),n.setAwake(!0)),s.getType(),o.getType()},i}(),ni=function(){function i(){this.other=null,this.joint=null,this.prev=null,this.next=null}return i}(),pt=function(){function i(t,e,s){this.m_type="unknown-joint",this.m_prev=null,this.m_next=null,this.m_edgeA=new ni,this.m_edgeB=new ni,this.m_islandFlag=!1,e="bodyA"in t?t.bodyA:e,s="bodyB"in t?t.bodyB:s,this.m_bodyA=e,this.m_bodyB=s,this.m_collideConnected=!!t.collideConnected,this.m_userData=t.userData}return i.prototype.isActive=function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},i.prototype.getType=function(){return this.m_type},i.prototype.getBodyA=function(){return this.m_bodyA},i.prototype.getBodyB=function(){return this.m_bodyB},i.prototype.getNext=function(){return this.m_next},i.prototype.getUserData=function(){return this.m_userData},i.prototype.setUserData=function(t){this.m_userData=t},i.prototype.getCollideConnected=function(){return this.m_collideConnected},i.prototype.shiftOrigin=function(t){},i}(),qi=function(){return Date.now()},Ni=function(i){return Date.now()-i},ai={now:qi,diff:Ni},mi=function(){function i(){this.proxyA=new Xt,this.proxyB=new Xt,this.sweepA=new Ut,this.sweepB=new Ut}return i}(),zt;(function(i){i[i.e_unknown=0]="e_unknown",i[i.e_failed=1]="e_failed",i[i.e_overlapped=2]="e_overlapped",i[i.e_touching=3]="e_touching",i[i.e_separated=4]="e_separated"})(zt||(zt={}));var ci=function(){function i(){}return i}();at.toiTime=0,at.toiMaxTime=0,at.toiCalls=0,at.toiIters=0,at.toiMaxIters=0,at.toiRootIters=0,at.toiMaxRootIters=0;function ne(i,t){var e=ai.now();++at.toiCalls,i.state=zt.e_unknown,i.t=t.tMax;var s=t.proxyA,o=t.proxyB,a=t.sweepA,n=t.sweepB;a.normalize(),n.normalize();var m=t.tMax,c=s.m_radius+o.m_radius,p=b.max(P.linearSlop,c-3*P.linearSlop),_=.25*P.linearSlop,v=0,u=P.maxTOIIterations,h=0,l=new we,y=new be;for(y.proxyA=t.proxyA,y.proxyB=t.proxyB,y.useRadii=!1;;){var f=R.identity(),d=R.identity();a.getTransform(f,v),n.getTransform(d,v),y.transformA=f,y.transformB=d;var A=new Ve;if(qt(A,l,y),A.distance<=0){i.state=zt.e_overlapped,i.t=0;break}if(A.distance<p+_){i.state=zt.e_touching,i.t=v;break}var x=new ki;x.initialize(l,s,a,o,n,v);for(var C=!1,M=m,I=0;;){var z=x.findMinSeparation(M);if(z>p+_){i.state=zt.e_separated,i.t=m,C=!0;break}if(z>p-_){v=M;break}var F=x.evaluate(v);if(F<p-_){i.state=zt.e_failed,i.t=v,C=!0;break}if(F<=p+_){i.state=zt.e_touching,i.t=v,C=!0;break}for(var D=0,E=v,N=M;;){var T=void 0;D&1?T=E+(p-F)*(N-E)/(z-F):T=.5*(E+N),++D,++at.toiRootIters;var Z=x.evaluate(T);if(x.indexA,x.indexB,b.abs(Z-p)<_){M=T;break}if(Z>p?(E=T,F=Z):(N=T,z=Z),D===50)break}if(at.toiMaxRootIters=b.max(at.toiMaxRootIters,D),++I,I===P.maxPolygonVertices)break}if(++h,++at.toiIters,C)break;if(h===u){i.state=zt.e_failed,i.t=v;break}}at.toiMaxIters=b.max(at.toiMaxIters,h);var H=ai.diff(e);at.toiMaxTime=b.max(at.toiMaxTime,H),at.toiTime+=H}var Yt;(function(i){i[i.e_points=1]="e_points",i[i.e_faceA=2]="e_faceA",i[i.e_faceB=3]="e_faceB"})(Yt||(Yt={}));var ki=function(){function i(){this.m_proxyA=new Xt,this.m_proxyB=new Xt,this.m_localPoint=r.zero(),this.m_axis=r.zero()}return i.prototype.initialize=function(t,e,s,o,a,n){this.m_proxyA=e,this.m_proxyB=o;var m=t.count;this.m_sweepA=s,this.m_sweepB=a;var c=R.identity(),p=R.identity();if(this.m_sweepA.getTransform(c,n),this.m_sweepB.getTransform(p,n),m===1){this.m_type=Yt.e_points;var _=this.m_proxyA.getVertex(t.indexA[0]),v=this.m_proxyB.getVertex(t.indexB[0]),u=R.mulVec2(c,_),h=R.mulVec2(p,v);this.m_axis.setCombine(1,h,-1,u);var l=this.m_axis.normalize();return l}else if(t.indexA[0]===t.indexA[1]){this.m_type=Yt.e_faceB;var y=o.getVertex(t.indexB[0]),f=o.getVertex(t.indexB[1]);this.m_axis=r.crossVec2Num(r.sub(f,y),1),this.m_axis.normalize();var d=V.mulVec2(p.q,this.m_axis);this.m_localPoint=r.mid(y,f);var h=R.mulVec2(p,this.m_localPoint),_=e.getVertex(t.indexA[0]),u=R.mulVec2(c,_),l=r.dot(u,d)-r.dot(h,d);return l<0&&(this.m_axis=r.neg(this.m_axis),l=-l),l}else{this.m_type=Yt.e_faceA;var A=this.m_proxyA.getVertex(t.indexA[0]),x=this.m_proxyA.getVertex(t.indexA[1]);this.m_axis=r.crossVec2Num(r.sub(x,A),1),this.m_axis.normalize();var d=V.mulVec2(c.q,this.m_axis);this.m_localPoint=r.mid(A,x);var u=R.mulVec2(c,this.m_localPoint),v=this.m_proxyB.getVertex(t.indexB[0]),h=R.mulVec2(p,v),l=r.dot(h,d)-r.dot(u,d);return l<0&&(this.m_axis=r.neg(this.m_axis),l=-l),l}},i.prototype.compute=function(t,e){var s=R.identity(),o=R.identity();switch(this.m_sweepA.getTransform(s,e),this.m_sweepB.getTransform(o,e),this.m_type){case Yt.e_points:{if(t){var a=V.mulTVec2(s.q,this.m_axis),n=V.mulTVec2(o.q,r.neg(this.m_axis));this.indexA=this.m_proxyA.getSupport(a),this.indexB=this.m_proxyB.getSupport(n)}var m=this.m_proxyA.getVertex(this.indexA),c=this.m_proxyB.getVertex(this.indexB),p=R.mulVec2(s,m),_=R.mulVec2(o,c),v=r.dot(_,this.m_axis)-r.dot(p,this.m_axis);return v}case Yt.e_faceA:{var u=V.mulVec2(s.q,this.m_axis),p=R.mulVec2(s,this.m_localPoint);if(t){var n=V.mulTVec2(o.q,r.neg(u));this.indexA=-1,this.indexB=this.m_proxyB.getSupport(n)}var c=this.m_proxyB.getVertex(this.indexB),_=R.mulVec2(o,c),v=r.dot(_,u)-r.dot(p,u);return v}case Yt.e_faceB:{var u=V.mulVec2(o.q,this.m_axis),_=R.mulVec2(o,this.m_localPoint);if(t){var a=V.mulTVec2(s.q,r.neg(u));this.indexB=-1,this.indexA=this.m_proxyA.getSupport(a)}var m=this.m_proxyA.getVertex(this.indexA),p=R.mulVec2(s,m),v=r.dot(p,u)-r.dot(_,u);return v}default:return t&&(this.indexA=-1,this.indexB=-1),0}},i.prototype.findMinSeparation=function(t){return this.compute(!0,t)},i.prototype.evaluate=function(t){return this.compute(!1,t)},i}(),Me=function(){function i(){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}return i.prototype.reset=function(t){this.dt>0&&(this.inv_dt0=this.inv_dt),this.dt=t,this.inv_dt=t==0?0:1/t,this.dtRatio=t*this.inv_dt0},i}(),Kt=new Me,Di=function(){function i(t){this.contact=t,this.normals=[],this.tangents=[]}return Object.defineProperty(i.prototype,"normalImpulses",{get:function(){var t=this.contact,e=this.normals;e.length=0;for(var s=0;s<t.v_points.length;++s)e.push(t.v_points[s].normalImpulse);return e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tangentImpulses",{get:function(){var t=this.contact,e=this.tangents;e.length=0;for(var s=0;s<t.v_points.length;++s)e.push(t.v_points[s].tangentImpulse);return e},enumerable:!1,configurable:!0}),i}(),hi=function(){function i(t){this.m_world=t,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}return i.prototype.clear=function(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0},i.prototype.addBody=function(t){this.m_bodies.push(t)},i.prototype.addContact=function(t){this.m_contacts.push(t)},i.prototype.addJoint=function(t){this.m_joints.push(t)},i.prototype.solveWorld=function(t){for(var e=this.m_world,s=e.m_bodyList;s;s=s.m_next)s.m_islandFlag=!1;for(var o=e.m_contactList;o;o=o.m_next)o.m_islandFlag=!1;for(var a=e.m_jointList;a;a=a.m_next)a.m_islandFlag=!1;for(var n=this.m_stack,m=e.m_bodyList;m;m=m.m_next)if(!m.m_islandFlag&&!(m.isAwake()==!1||m.isActive()==!1)&&!m.isStatic()){for(this.clear(),n.push(m),m.m_islandFlag=!0;n.length>0;){var s=n.pop();if(this.addBody(s),s.setAwake(!0),!s.isStatic()){for(var c=s.m_contactList;c;c=c.next){var p=c.contact;if(!p.m_islandFlag&&!(p.isEnabled()==!1||p.isTouching()==!1)){var _=p.m_fixtureA.m_isSensor,v=p.m_fixtureB.m_isSensor;if(!(_||v)){this.addContact(p),p.m_islandFlag=!0;var u=c.other;u.m_islandFlag||(n.push(u),u.m_islandFlag=!0)}}}for(var h=s.m_jointList;h;h=h.next)if(h.joint.m_islandFlag!=!0){var u=h.other;u.isActive()!=!1&&(this.addJoint(h.joint),h.joint.m_islandFlag=!0,!u.m_islandFlag&&(n.push(u),u.m_islandFlag=!0))}}}this.solveIsland(t);for(var l=0;l<this.m_bodies.length;++l){var s=this.m_bodies[l];s.isStatic()&&(s.m_islandFlag=!1)}}},i.prototype.solveIsland=function(t){for(var e=this.m_world,s=e.m_gravity,o=e.m_allowSleep,a=t.dt,n=0;n<this.m_bodies.length;++n){var m=this.m_bodies[n],c=r.clone(m.m_sweep.c),p=m.m_sweep.a,_=r.clone(m.m_linearVelocity),v=m.m_angularVelocity;m.m_sweep.c0.setVec2(m.m_sweep.c),m.m_sweep.a0=m.m_sweep.a,m.isDynamic()&&(_.addMul(a*m.m_gravityScale,s),_.addMul(a*m.m_invMass,m.m_force),v+=a*m.m_invI*m.m_torque,_.mul(1/(1+a*m.m_linearDamping)),v*=1/(1+a*m.m_angularDamping)),m.c_position.c=c,m.c_position.a=p,m.c_velocity.v=_,m.c_velocity.w=v}for(var n=0;n<this.m_contacts.length;++n){var u=this.m_contacts[n];u.initConstraint(t)}for(var n=0;n<this.m_contacts.length;++n){var u=this.m_contacts[n];u.initVelocityConstraint(t)}if(t.warmStarting)for(var n=0;n<this.m_contacts.length;++n){var u=this.m_contacts[n];u.warmStartConstraint(t)}for(var n=0;n<this.m_joints.length;++n){var h=this.m_joints[n];h.initVelocityConstraints(t)}for(var n=0;n<t.velocityIterations;++n){for(var l=0;l<this.m_joints.length;++l){var h=this.m_joints[l];h.solveVelocityConstraints(t)}for(var l=0;l<this.m_contacts.length;++l){var u=this.m_contacts[l];u.solveVelocityConstraint(t)}}for(var n=0;n<this.m_contacts.length;++n){var u=this.m_contacts[n];u.storeConstraintImpulses(t)}for(var n=0;n<this.m_bodies.length;++n){var m=this.m_bodies[n],c=r.clone(m.c_position.c),p=m.c_position.a,_=r.clone(m.c_velocity.v),v=m.c_velocity.w,y=r.mulNumVec2(a,_);if(r.lengthSquared(y)>P.maxTranslationSquared){var f=P.maxTranslation/y.length();_.mul(f)}var d=a*v;if(d*d>P.maxRotationSquared){var f=P.maxRotation/b.abs(d);v*=f}c.addMul(a,_),p+=a*v,m.c_position.c.setVec2(c),m.c_position.a=p,m.c_velocity.v.setVec2(_),m.c_velocity.w=v}for(var A=!1,n=0;n<t.positionIterations;++n){for(var x=0,l=0;l<this.m_contacts.length;++l){var u=this.m_contacts[l],C=u.solvePositionConstraint(t);x=b.min(x,C)}for(var M=x>=-3*P.linearSlop,I=!0,l=0;l<this.m_joints.length;++l){var h=this.m_joints[l],z=h.solvePositionConstraints(t);I=I&&z}if(M&&I){A=!0;break}}for(var n=0;n<this.m_bodies.length;++n){var m=this.m_bodies[n];m.m_sweep.c.setVec2(m.c_position.c),m.m_sweep.a=m.c_position.a,m.m_linearVelocity.setVec2(m.c_velocity.v),m.m_angularVelocity=m.c_velocity.w,m.synchronizeTransform()}if(this.postSolveIsland(),o){for(var F=1/0,D=P.linearSleepToleranceSqr,E=P.angularSleepToleranceSqr,n=0;n<this.m_bodies.length;++n){var m=this.m_bodies[n];m.isStatic()||(m.m_autoSleepFlag==!1||m.m_angularVelocity*m.m_angularVelocity>E||r.lengthSquared(m.m_linearVelocity)>D?(m.m_sleepTime=0,F=0):(m.m_sleepTime+=a,F=b.min(F,m.m_sleepTime)))}if(F>=P.timeToSleep&&A)for(var n=0;n<this.m_bodies.length;++n){var m=this.m_bodies[n];m.setAwake(!1)}}},i.prototype.printBodies=function(t){for(var e=0;e<this.m_bodies.length;++e){var s=this.m_bodies[e];ft.debug(t,s.c_position.a,s.c_position.c.x,s.c_position.c.y,s.c_velocity.w,s.c_velocity.v.x,s.c_velocity.v.y)}},i.prototype.solveWorldTOI=function(t){var e=this.m_world;if(e.m_stepComplete){for(var Y=e.m_bodyList;Y;Y=Y.m_next)Y.m_islandFlag=!1,Y.m_sweep.alpha0=0;for(var U=e.m_contactList;U;U=U.m_next)U.m_toiFlag=!1,U.m_islandFlag=!1,U.m_toiCount=0,U.m_toi=1}for(;;){for(var s=null,o=1,U=e.m_contactList;U;U=U.m_next)if(U.isEnabled()!=!1&&!(U.m_toiCount>P.maxSubSteps)){var a=1;if(U.m_toiFlag)a=U.m_toi;else{var n=U.getFixtureA(),m=U.getFixtureB();if(n.isSensor()||m.isSensor())continue;var c=n.getBody(),p=m.getBody(),_=c.isAwake()&&!c.isStatic(),v=p.isAwake()&&!p.isStatic();if(_==!1&&v==!1)continue;var u=c.isBullet()||!c.isDynamic(),h=p.isBullet()||!p.isDynamic();if(u==!1&&h==!1)continue;var l=c.m_sweep.alpha0;c.m_sweep.alpha0<p.m_sweep.alpha0?(l=p.m_sweep.alpha0,c.m_sweep.advance(l)):p.m_sweep.alpha0<c.m_sweep.alpha0&&(l=c.m_sweep.alpha0,p.m_sweep.advance(l));var y=U.getChildIndexA(),f=U.getChildIndexB();c.m_sweep,p.m_sweep;var d=new mi;d.proxyA.set(n.getShape(),y),d.proxyB.set(m.getShape(),f),d.sweepA.set(c.m_sweep),d.sweepB.set(p.m_sweep),d.tMax=1;var A=new ci;ne(A,d);var x=A.t;A.state==zt.e_touching?a=b.min(l+(1-l)*x,1):a=1,U.m_toi=a,U.m_toiFlag=!0}a<o&&(s=U,o=a)}if(s==null||1-10*b.EPSILON<o){e.m_stepComplete=!0;break}var C=s.getFixtureA(),M=s.getFixtureB(),I=C.getBody(),z=M.getBody(),F=I.m_sweep.clone(),D=z.m_sweep.clone();if(I.advance(o),z.advance(o),s.update(e),s.m_toiFlag=!1,++s.m_toiCount,s.isEnabled()==!1||s.isTouching()==!1){s.setEnabled(!1),I.m_sweep.set(F),z.m_sweep.set(D),I.synchronizeTransform(),z.synchronizeTransform();continue}I.setAwake(!0),z.setAwake(!0),this.clear(),this.addBody(I),this.addBody(z),this.addContact(s),I.m_islandFlag=!0,z.m_islandFlag=!0,s.m_islandFlag=!0;for(var E=[I,z],N=0;N<E.length;++N){var T=E[N];if(T.isDynamic())for(var Z=T.m_contactList;Z;Z=Z.next){var H=Z.contact;if(!H.m_islandFlag){var $=Z.other;if(!($.isDynamic()&&!T.isBullet()&&!$.isBullet())){var ot=H.m_fixtureA.m_isSensor,nt=H.m_fixtureB.m_isSensor;if(!(ot||nt)){var it=$.m_sweep.clone();if($.m_islandFlag==!1&&$.advance(o),H.update(e),H.isEnabled()==!1||H.isTouching()==!1){$.m_sweep.set(it),$.synchronizeTransform();continue}H.m_islandFlag=!0,this.addContact(H),!$.m_islandFlag&&($.m_islandFlag=!0,$.isStatic()||$.setAwake(!0),this.addBody($))}}}}}Kt.reset((1-o)*t.dt),Kt.dtRatio=1,Kt.positionIterations=20,Kt.velocityIterations=t.velocityIterations,Kt.warmStarting=!1,this.solveIslandTOI(Kt,I,z);for(var N=0;N<this.m_bodies.length;++N){var T=this.m_bodies[N];if(T.m_islandFlag=!1,!!T.isDynamic()){T.synchronizeFixtures();for(var Z=T.m_contactList;Z;Z=Z.next)Z.contact.m_toiFlag=!1,Z.contact.m_islandFlag=!1}}if(e.findNewContacts(),e.m_subStepping){e.m_stepComplete=!1;break}}var Y,U},i.prototype.solveIslandTOI=function(t,e,s){this.m_world;for(var _=0;_<this.m_bodies.length;++_){var o=this.m_bodies[_];o.c_position.c.setVec2(o.m_sweep.c),o.c_position.a=o.m_sweep.a,o.c_velocity.v.setVec2(o.m_linearVelocity),o.c_velocity.w=o.m_angularVelocity}for(var _=0;_<this.m_contacts.length;++_){var a=this.m_contacts[_];a.initConstraint(t)}for(var _=0;_<t.positionIterations;++_){for(var n=0,m=0;m<this.m_contacts.length;++m){var a=this.m_contacts[m],c=a.solvePositionConstraintTOI(t,e,s);n=b.min(n,c)}var p=n>=-1.5*P.linearSlop;if(p)break}var _,v;e.m_sweep.c0.setVec2(e.c_position.c),e.m_sweep.a0=e.c_position.a,s.m_sweep.c0.setVec2(s.c_position.c),s.m_sweep.a0=s.c_position.a;for(var _=0;_<this.m_contacts.length;++_){var a=this.m_contacts[_];a.initVelocityConstraint(t)}for(var _=0;_<t.velocityIterations;++_)for(var m=0;m<this.m_contacts.length;++m){var a=this.m_contacts[m];a.solveVelocityConstraint(t)}for(var u=t.dt,_=0;_<this.m_bodies.length;++_){var o=this.m_bodies[_],v=r.clone(o.c_position.c),h=o.c_position.a,l=r.clone(o.c_velocity.v),y=o.c_velocity.w,f=r.mulNumVec2(u,l);if(r.dot(f,f)>P.maxTranslationSquared){var d=P.maxTranslation/f.length();l.mul(d)}var A=u*y;if(A*A>P.maxRotationSquared){var d=P.maxRotation/b.abs(A);y*=d}v.addMul(u,l),h+=u*y,o.c_position.c=v,o.c_position.a=h,o.c_velocity.v=l,o.c_velocity.w=y,o.m_sweep.c=v,o.m_sweep.a=h,o.m_linearVelocity=l,o.m_angularVelocity=y,o.synchronizeTransform()}this.postSolveIsland()},i.prototype.postSolveIsland=function(){for(var t=0;t<this.m_contacts.length;++t){var e=this.m_contacts[t];this.m_world.postSolve(e,e.m_impulse)}},i}(),Ri={gravity:r.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3},Ie=function(){function i(t){var e=this;if(this.s_step=new Me,this.createContact=function(s,o){var a=s.fixture,n=o.fixture,m=s.childIndex,c=o.childIndex,p=a.getBody(),_=n.getBody();if(p!=_){for(var v=_.getContactList();v;){if(v.other==p){var u=v.contact.getFixtureA(),h=v.contact.getFixtureB(),l=v.contact.getChildIndexA(),y=v.contact.getChildIndexB();if(u==a&&h==n&&l==m&&y==c||u==n&&h==a&&l==c&&y==m)return}v=v.next}if(_.shouldCollide(p)!=!1&&n.shouldCollide(a)!=!1){var f=Pt.create(a,m,n,c);f!=null&&(f.m_prev=null,e.m_contactList!=null&&(f.m_next=e.m_contactList,e.m_contactList.m_prev=f),e.m_contactList=f,++e.m_contactCount)}}},!(this instanceof i))return new i(t);t&&r.isValid(t)&&(t={gravity:t}),t=k(t,Ri),this.m_solver=new hi(this),this.m_broadPhase=new It,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=t.allowSleep,this.m_gravity=r.clone(t.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=t.warmStarting,this.m_continuousPhysics=t.continuousPhysics,this.m_subStepping=t.subStepping,this.m_blockSolve=t.blockSolve,this.m_velocityIterations=t.velocityIterations,this.m_positionIterations=t.positionIterations,this.m_t=0}return i.prototype._serialize=function(){for(var t=[],e=[],s=this.getBodyList();s;s=s.getNext())t.push(s);for(var o=this.getJointList();o;o=o.getNext())typeof o._serialize=="function"&&e.push(o);return{gravity:this.m_gravity,bodies:t,joints:e}},i._deserialize=function(t,e,s){if(!t)return new i;var o=new i(t.gravity);if(t.bodies)for(var a=t.bodies.length-1;a>=0;a-=1)o._addBody(s(tt,t.bodies[a],o));if(t.joints)for(var a=t.joints.length-1;a>=0;a--)o.createJoint(s(pt,t.joints[a],o));return o},i.prototype.getBodyList=function(){return this.m_bodyList},i.prototype.getJointList=function(){return this.m_jointList},i.prototype.getContactList=function(){return this.m_contactList},i.prototype.getBodyCount=function(){return this.m_bodyCount},i.prototype.getJointCount=function(){return this.m_jointCount},i.prototype.getContactCount=function(){return this.m_contactCount},i.prototype.setGravity=function(t){this.m_gravity=t},i.prototype.getGravity=function(){return this.m_gravity},i.prototype.isLocked=function(){return this.m_locked},i.prototype.setAllowSleeping=function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,this.m_allowSleep==!1))for(var e=this.m_bodyList;e;e=e.m_next)e.setAwake(!0)},i.prototype.getAllowSleeping=function(){return this.m_allowSleep},i.prototype.setWarmStarting=function(t){this.m_warmStarting=t},i.prototype.getWarmStarting=function(){return this.m_warmStarting},i.prototype.setContinuousPhysics=function(t){this.m_continuousPhysics=t},i.prototype.getContinuousPhysics=function(){return this.m_continuousPhysics},i.prototype.setSubStepping=function(t){this.m_subStepping=t},i.prototype.getSubStepping=function(){return this.m_subStepping},i.prototype.setAutoClearForces=function(t){this.m_clearForces=t},i.prototype.getAutoClearForces=function(){return this.m_clearForces},i.prototype.clearForces=function(){for(var t=this.m_bodyList;t;t=t.getNext())t.m_force.setZero(),t.m_torque=0},i.prototype.queryAABB=function(t,e){var s=this.m_broadPhase;this.m_broadPhase.query(t,function(o){var a=s.getUserData(o);return e(a.fixture)})},i.prototype.rayCast=function(t,e,s){var o=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:t,p2:e},function(a,n){var m=o.getUserData(n),c=m.fixture,p=m.childIndex,_={},v=c.rayCast(_,a,p);if(v){var u=_.fraction,h=r.add(r.mulNumVec2(1-u,a.p1),r.mulNumVec2(u,a.p2));return s(c,h,_.normal,u)}return a.maxFraction})},i.prototype.getProxyCount=function(){return this.m_broadPhase.getProxyCount()},i.prototype.getTreeHeight=function(){return this.m_broadPhase.getTreeHeight()},i.prototype.getTreeBalance=function(){return this.m_broadPhase.getTreeBalance()},i.prototype.getTreeQuality=function(){return this.m_broadPhase.getTreeQuality()},i.prototype.shiftOrigin=function(t){if(!this.m_locked){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.sub(t),e.m_sweep.c0.sub(t),e.m_sweep.c.sub(t);for(var s=this.m_jointList;s;s=s.m_next)s.shiftOrigin(t);this.m_broadPhase.shiftOrigin(t)}},i.prototype._addBody=function(t){this.isLocked()||(t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount)},i.prototype.createBody=function(t,e){if(this.isLocked())return null;var s={};t&&(r.isValid(t)?s={position:t,angle:e}:typeof t=="object"&&(s=t));var o=new tt(this,s);return this._addBody(o),o},i.prototype.createDynamicBody=function(t,e){var s={};return t&&(r.isValid(t)?s={position:t,angle:e}:typeof t=="object"&&(s=t)),s.type="dynamic",this.createBody(s)},i.prototype.createKinematicBody=function(t,e){var s={};return t&&(r.isValid(t)?s={position:t,angle:e}:typeof t=="object"&&(s=t)),s.type="kinematic",this.createBody(s)},i.prototype.destroyBody=function(t){if(!this.isLocked()){if(t.m_destroyed)return!1;for(var e=t.m_jointList;e;){var s=e;e=e.next,this.publish("remove-joint",s.joint),this.destroyJoint(s.joint),t.m_jointList=e}t.m_jointList=null;for(var o=t.m_contactList;o;){var a=o;o=o.next,this.destroyContact(a.contact),t.m_contactList=o}t.m_contactList=null;for(var n=t.m_fixtureList;n;){var m=n;n=n.m_next,this.publish("remove-fixture",m),m.destroyProxies(this.m_broadPhase),t.m_fixtureList=n}return t.m_fixtureList=null,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_destroyed=!0,--this.m_bodyCount,this.publish("remove-body",t),!0}},i.prototype.createJoint=function(t){if(this.isLocked())return null;if(t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB,t.m_collideConnected==!1)for(var e=t.m_bodyB.getContactList();e;e=e.next)e.other==t.m_bodyA&&e.contact.flagForFiltering();return t},i.prototype.destroyJoint=function(t){if(!this.isLocked()){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var e=t.m_bodyA,s=t.m_bodyB;if(e.setAwake(!0),s.setAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==s.m_jointList&&(s.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,--this.m_jointCount,t.m_collideConnected==!1)for(var o=s.getContactList();o;)o.other==e&&o.contact.flagForFiltering(),o=o.next;this.publish("remove-joint",t)}},i.prototype.step=function(t,e,s){if(this.publish("pre-step",t),(e|0)!==e&&(e=0),e=e||this.m_velocityIterations,s=s||this.m_positionIterations,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,this.s_step.reset(t),this.s_step.velocityIterations=e,this.s_step.positionIterations=s,this.s_step.warmStarting=this.m_warmStarting,this.s_step.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&t>0){this.m_solver.solveWorld(this.s_step);for(var o=this.m_bodyList;o;o=o.getNext())o.m_islandFlag!=!1&&(o.isStatic()||o.synchronizeFixtures());this.findNewContacts()}this.m_continuousPhysics&&t>0&&this.m_solver.solveWorldTOI(this.s_step),this.m_clearForces&&this.clearForces(),this.m_locked=!1,this.publish("post-step",t)},i.prototype.findNewContacts=function(){this.m_broadPhase.updatePairs(this.createContact)},i.prototype.updateContacts=function(){for(var t,e=this.m_contactList;t=e;){e=t.getNext();var s=t.getFixtureA(),o=t.getFixtureB(),a=t.getChildIndexA(),n=t.getChildIndexB(),m=s.getBody(),c=o.getBody();if(t.m_filterFlag){if(c.shouldCollide(m)==!1){this.destroyContact(t);continue}if(o.shouldCollide(s)==!1){this.destroyContact(t);continue}t.m_filterFlag=!1}var p=m.isAwake()&&!m.isStatic(),_=c.isAwake()&&!c.isStatic();if(!(p==!1&&_==!1)){var v=s.m_proxies[a].proxyId,u=o.m_proxies[n].proxyId,h=this.m_broadPhase.testOverlap(v,u);if(h==!1){this.destroyContact(t);continue}t.update(this)}}},i.prototype.destroyContact=function(t){Pt.destroy(t,this),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),--this.m_contactCount},i.prototype.on=function(t,e){return typeof t!="string"||typeof e!="function"?this:(this._listeners||(this._listeners={}),this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e),this)},i.prototype.off=function(t,e){if(typeof t!="string"||typeof e!="function")return this;var s=this._listeners&&this._listeners[t];if(!s||!s.length)return this;var o=s.indexOf(e);return o>=0&&s.splice(o,1),this},i.prototype.publish=function(t,e,s,o){var a=this._listeners&&this._listeners[t];if(!a||!a.length)return 0;for(var n=0;n<a.length;n++)a[n].call(this,e,s,o);return a.length},i.prototype.beginContact=function(t){this.publish("begin-contact",t)},i.prototype.endContact=function(t){this.publish("end-contact",t)},i.prototype.preSolve=function(t,e){this.publish("pre-solve",t,e)},i.prototype.postSolve=function(t,e){this.publish("post-solve",t,e)},i}(),j=function(){function i(t,e,s){if(!(this instanceof i))return new i(t,e,s);typeof t>"u"?(this.x=0,this.y=0,this.z=0):typeof t=="object"?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=s)}return i.prototype._serialize=function(){return{x:this.x,y:this.y,z:this.z}},i._deserialize=function(t){var e=Object.create(i.prototype);return e.x=t.x,e.y=t.y,e.z=t.z,e},i.neo=function(t,e,s){var o=Object.create(i.prototype);return o.x=t,o.y=e,o.z=s,o},i.zero=function(){var t=Object.create(i.prototype);return t.x=0,t.y=0,t.z=0,t},i.clone=function(t){return i.neo(t.x,t.y,t.z)},i.prototype.toString=function(){return JSON.stringify(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:b.isFinite(t.x)&&b.isFinite(t.y)&&b.isFinite(t.z)},i.assert=function(t){},i.prototype.setZero=function(){return this.x=0,this.y=0,this.z=0,this},i.prototype.set=function(t,e,s){return this.x=t,this.y=e,this.z=s,this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.areEqual=function(t,e){return t===e||typeof t=="object"&&t!==null&&typeof e=="object"&&e!==null&&t.x===e.x&&t.y===e.y&&t.z===e.z},i.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},i.cross=function(t,e){return new i(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},i.add=function(t,e){return new i(t.x+e.x,t.y+e.y,t.z+e.z)},i.sub=function(t,e){return new i(t.x-e.x,t.y-e.y,t.z-e.z)},i.mul=function(t,e){return new i(e*t.x,e*t.y,e*t.z)},i.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.neg=function(t){return new i(-t.x,-t.y,-t.z)},i}(),Nt=function(i){S(t,i);function t(e,s){var o=this;return o instanceof t?(o=i.call(this)||this,o.m_type=t.TYPE,o.m_radius=P.polygonRadius,o.m_vertex1=e?r.clone(e):r.zero(),o.m_vertex2=s?r.clone(s):r.zero(),o.m_vertex0=r.zero(),o.m_vertex3=r.zero(),o.m_hasVertex0=!1,o.m_hasVertex3=!1,o):new t(e,s)}return t.prototype._serialize=function(){return{type:this.m_type,vertex1:this.m_vertex1,vertex2:this.m_vertex2,vertex0:this.m_vertex0,vertex3:this.m_vertex3,hasVertex0:this.m_hasVertex0,hasVertex3:this.m_hasVertex3}},t._deserialize=function(e){var s=new t(e.vertex1,e.vertex2);return s.m_hasVertex0&&s.setPrevVertex(e.vertex0),s.m_hasVertex3&&s.setNextVertex(e.vertex3),s},t.prototype.setNext=function(e){return this.setNextVertex(e)},t.prototype.setNextVertex=function(e){return e?(this.m_vertex3.setVec2(e),this.m_hasVertex3=!0):(this.m_vertex3.setZero(),this.m_hasVertex3=!1),this},t.prototype.getNextVertex=function(){return this.m_vertex3},t.prototype.setPrev=function(e){return this.setPrevVertex(e)},t.prototype.setPrevVertex=function(e){return e?(this.m_vertex0.setVec2(e),this.m_hasVertex0=!0):(this.m_vertex0.setZero(),this.m_hasVertex0=!1),this},t.prototype.getPrevVertex=function(){return this.m_vertex0},t.prototype._set=function(e,s){return this.m_vertex1.setVec2(e),this.m_vertex2.setVec2(s),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},t.prototype._clone=function(){var e=new t;return e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_vertex1.setVec2(this.m_vertex1),e.m_vertex2.setVec2(this.m_vertex2),e.m_vertex0.setVec2(this.m_vertex0),e.m_vertex3.setVec2(this.m_vertex3),e.m_hasVertex0=this.m_hasVertex0,e.m_hasVertex3=this.m_hasVertex3,e},t.prototype.getChildCount=function(){return 1},t.prototype.testPoint=function(e,s){return!1},t.prototype.rayCast=function(e,s,o,a){var n=V.mulTVec2(o.q,r.sub(s.p1,o.p)),m=V.mulTVec2(o.q,r.sub(s.p2,o.p)),c=r.sub(m,n),p=this.m_vertex1,_=this.m_vertex2,v=r.sub(_,p),u=r.neo(v.y,-v.x);u.normalize();var h=r.dot(u,r.sub(p,n)),l=r.dot(u,c);if(l==0)return!1;var y=h/l;if(y<0||s.maxFraction<y)return!1;var f=r.add(n,r.mulNumVec2(y,c)),d=r.sub(_,p),A=r.dot(d,d);if(A==0)return!1;var x=r.dot(r.sub(f,p),d)/A;return x<0||1<x?!1:(e.fraction=y,h>0?e.normal=V.mulVec2(o.q,u).neg():e.normal=V.mulVec2(o.q,u),!0)},t.prototype.computeAABB=function(e,s,o){var a=R.mulVec2(s,this.m_vertex1),n=R.mulVec2(s,this.m_vertex2);e.combinePoints(a,n),e.extend(this.m_radius)},t.prototype.computeMass=function(e,s){e.mass=0,e.center.setCombine(.5,this.m_vertex1,.5,this.m_vertex2),e.I=0},t.prototype.computeDistanceProxy=function(e){e.m_vertices.push(this.m_vertex1),e.m_vertices.push(this.m_vertex2),e.m_count=2,e.m_radius=this.m_radius},t.TYPE="edge",t}(G),ae=function(i){S(t,i);function t(e,s){var o=this;return o instanceof t?(o=i.call(this)||this,o.m_type=t.TYPE,o.m_radius=P.polygonRadius,o.m_vertices=[],o.m_count=0,o.m_prevVertex=null,o.m_nextVertex=null,o.m_hasPrevVertex=!1,o.m_hasNextVertex=!1,o.m_isLoop=!!s,e&&e.length&&(s?o._createLoop(e):o._createChain(e)),o):new t(e,s)}return t.prototype._serialize=function(){var e={type:this.m_type,vertices:this.m_vertices,isLoop:this.m_isLoop,hasPrevVertex:this.m_hasPrevVertex,hasNextVertex:this.m_hasNextVertex,prevVertex:null,nextVertex:null};return this.m_prevVertex&&(e.prevVertex=this.m_prevVertex),this.m_nextVertex&&(e.nextVertex=this.m_nextVertex),e},t._deserialize=function(e,s,o){var a=[];if(e.vertices)for(var n=0;n<e.vertices.length;n++)a.push(o(r,e.vertices[n]));var m=new t(a,e.isLoop);return e.prevVertex&&m.setPrevVertex(e.prevVertex),e.nextVertex&&m.setNextVertex(e.nextVertex),m},t.prototype._createLoop=function(e){for(var s=1;s<e.length;++s)e[s-1],e[s];this.m_vertices=[],this.m_count=e.length+1;for(var s=0;s<e.length;++s)this.m_vertices[s]=r.clone(e[s]);return this.m_vertices[e.length]=r.clone(e[0]),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},t.prototype._createChain=function(e){for(var s=1;s<e.length;++s)e[s-1],e[s];this.m_count=e.length;for(var s=0;s<e.length;++s)this.m_vertices[s]=r.clone(e[s]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex=null,this.m_nextVertex=null,this},t.prototype._reset=function(){this.m_isLoop?this._createLoop(this.m_vertices):this._createChain(this.m_vertices)},t.prototype.setPrevVertex=function(e){this.m_prevVertex=e,this.m_hasPrevVertex=!0},t.prototype.getPrevVertex=function(){return this.m_prevVertex},t.prototype.setNextVertex=function(e){this.m_nextVertex=e,this.m_hasNextVertex=!0},t.prototype.getNextVertex=function(){return this.m_nextVertex},t.prototype._clone=function(){var e=new t;return e._createChain(this.m_vertices),e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_prevVertex=this.m_prevVertex,e.m_nextVertex=this.m_nextVertex,e.m_hasPrevVertex=this.m_hasPrevVertex,e.m_hasNextVertex=this.m_hasNextVertex,e},t.prototype.getChildCount=function(){return this.m_count-1},t.prototype.getChildEdge=function(e,s){e.m_type=Nt.TYPE,e.m_radius=this.m_radius,e.m_vertex1=this.m_vertices[s],e.m_vertex2=this.m_vertices[s+1],s>0?(e.m_vertex0=this.m_vertices[s-1],e.m_hasVertex0=!0):(e.m_vertex0=this.m_prevVertex,e.m_hasVertex0=this.m_hasPrevVertex),s<this.m_count-2?(e.m_vertex3=this.m_vertices[s+2],e.m_hasVertex3=!0):(e.m_vertex3=this.m_nextVertex,e.m_hasVertex3=this.m_hasNextVertex)},t.prototype.getVertex=function(e){return e<this.m_count?this.m_vertices[e]:this.m_vertices[0]},t.prototype.isLoop=function(){return this.m_isLoop},t.prototype.testPoint=function(e,s){return!1},t.prototype.rayCast=function(e,s,o,a){var n=new Nt(this.getVertex(a),this.getVertex(a+1));return n.rayCast(e,s,o,0)},t.prototype.computeAABB=function(e,s,o){var a=R.mulVec2(s,this.getVertex(o)),n=R.mulVec2(s,this.getVertex(o+1));e.combinePoints(a,n)},t.prototype.computeMass=function(e,s){e.mass=0,e.center=r.zero(),e.I=0},t.prototype.computeDistanceProxy=function(e,s){e.m_buffer[0]=this.getVertex(s),e.m_buffer[1]=this.getVertex(s+1),e.m_vertices=e.m_buffer,e.m_count=2,e.m_radius=this.m_radius},t.TYPE="chain",t}(G),kt=function(i){S(t,i);function t(e){var s=this;return s instanceof t?(s=i.call(this)||this,s.m_type=t.TYPE,s.m_radius=P.polygonRadius,s.m_centroid=r.zero(),s.m_vertices=[],s.m_normals=[],s.m_count=0,e&&e.length&&s._set(e),s):new t(e)}return t.prototype._serialize=function(){return{type:this.m_type,vertices:this.m_vertices}},t._deserialize=function(e,s,o){var a=[];if(e.vertices)for(var n=0;n<e.vertices.length;n++)a.push(o(r,e.vertices[n]));var m=new t(a);return m},t.prototype.getVertex=function(e){return this.m_vertices[e]},t.prototype._clone=function(){var e=new t;e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_count=this.m_count,e.m_centroid.setVec2(this.m_centroid);for(var s=0;s<this.m_count;s++)e.m_vertices.push(this.m_vertices[s].clone());for(var s=0;s<this.m_normals.length;s++)e.m_normals.push(this.m_normals[s].clone());return e},t.prototype.getChildCount=function(){return 1},t.prototype._reset=function(){this._set(this.m_vertices)},t.prototype._set=function(e){if(e.length<3){this._setAsBox(1,1);return}for(var s=b.min(e.length,P.maxPolygonVertices),o=[],a=0;a<s;++a){for(var n=e[a],m=!0,c=0;c<o.length;++c)if(r.distanceSquared(n,o[c])<.25*P.linearSlopSquared){m=!1;break}m&&o.push(n)}if(s=o.length,s<3){this._setAsBox(1,1);return}for(var p=0,_=o[0].x,a=1;a<s;++a){var v=o[a].x;(v>_||v===_&&o[a].y<o[p].y)&&(p=a,_=v)}for(var u=[],h=0,l=p;;){u[h]=l;for(var y=0,c=1;c<s;++c){if(y===l){y=c;continue}var f=r.sub(o[y],o[u[h]]),n=r.sub(o[c],o[u[h]]),d=r.crossVec2Vec2(f,n);d<0&&(y=c),d===0&&n.lengthSquared()>f.lengthSquared()&&(y=c)}if(++h,l=y,y===p)break}if(h<3){this._setAsBox(1,1);return}this.m_count=h,this.m_vertices=[];for(var a=0;a<h;++a)this.m_vertices[a]=o[u[a]];for(var a=0;a<h;++a){var A=a,x=a+1<h?a+1:0,C=r.sub(this.m_vertices[x],this.m_vertices[A]);this.m_normals[a]=r.crossVec2Num(C,1),this.m_normals[a].normalize()}this.m_centroid=Ei(this.m_vertices,h)},t.prototype._setAsBox=function(e,s,o,a){if(this.m_vertices[0]=r.neo(e,-s),this.m_vertices[1]=r.neo(e,s),this.m_vertices[2]=r.neo(-e,s),this.m_vertices[3]=r.neo(-e,-s),this.m_normals[0]=r.neo(1,0),this.m_normals[1]=r.neo(0,1),this.m_normals[2]=r.neo(-1,0),this.m_normals[3]=r.neo(0,-1),this.m_count=4,r.isValid(o)){a=a||0,this.m_centroid.setVec2(o);var n=R.identity();n.p.setVec2(o),n.q.setAngle(a);for(var m=0;m<this.m_count;++m)this.m_vertices[m]=R.mulVec2(n,this.m_vertices[m]),this.m_normals[m]=V.mulVec2(n.q,this.m_normals[m])}},t.prototype.testPoint=function(e,s){for(var o=V.mulTVec2(e.q,r.sub(s,e.p)),a=0;a<this.m_count;++a){var n=r.dot(this.m_normals[a],r.sub(o,this.m_vertices[a]));if(n>0)return!1}return!0},t.prototype.rayCast=function(e,s,o,a){for(var n=V.mulTVec2(o.q,r.sub(s.p1,o.p)),m=V.mulTVec2(o.q,r.sub(s.p2,o.p)),c=r.sub(m,n),p=0,_=s.maxFraction,v=-1,u=0;u<this.m_count;++u){var h=r.dot(this.m_normals[u],r.sub(this.m_vertices[u],n)),l=r.dot(this.m_normals[u],c);if(l==0){if(h<0)return!1}else l<0&&h<p*l?(p=h/l,v=u):l>0&&h<_*l&&(_=h/l);if(_<p)return!1}return v>=0?(e.fraction=p,e.normal=V.mulVec2(o.q,this.m_normals[v]),!0):!1},t.prototype.computeAABB=function(e,s,o){for(var a=1/0,n=1/0,m=-1/0,c=-1/0,p=0;p<this.m_count;++p){var _=R.mulVec2(s,this.m_vertices[p]);a=b.min(a,_.x),m=b.max(m,_.x),n=b.min(n,_.y),c=b.max(c,_.y)}e.lowerBound.setNum(a,n),e.upperBound.setNum(m,c),e.extend(this.m_radius)},t.prototype.computeMass=function(e,s){for(var o=r.zero(),a=0,n=0,m=r.zero(),c=0;c<this.m_count;++c)m.add(this.m_vertices[c]);m.mul(1/this.m_count);for(var p=1/3,c=0;c<this.m_count;++c){var _=r.sub(this.m_vertices[c],m),v=c+1<this.m_count?r.sub(this.m_vertices[c+1],m):r.sub(this.m_vertices[0],m),u=r.crossVec2Vec2(_,v),h=.5*u;a+=h,o.addCombine(h*p,_,h*p,v);var l=_.x,y=_.y,f=v.x,d=v.y,A=l*l+f*l+f*f,x=y*y+d*y+d*d;n+=.25*p*u*(A+x)}e.mass=s*a,o.mul(1/a),e.center.setCombine(1,o,1,m),e.I=s*n,e.I+=e.mass*(r.dot(e.center,e.center)-r.dot(o,o))},t.prototype.validate=function(){for(var e=0;e<this.m_count;++e)for(var s=e,o=e<this.m_count-1?s+1:0,a=this.m_vertices[s],n=r.sub(this.m_vertices[o],a),m=0;m<this.m_count;++m)if(!(m==s||m==o)){var c=r.sub(this.m_vertices[m],a),p=r.crossVec2Vec2(n,c);if(p<0)return!1}return!0},t.prototype.computeDistanceProxy=function(e){e.m_vertices=this.m_vertices,e.m_count=this.m_count,e.m_radius=this.m_radius},t.TYPE="polygon",t}(G);function Ei(i,t){for(var e=r.zero(),s=0,o=r.zero(),a,n=1/3,a=0;a<t;++a){var m=o,c=i[a],p=a+1<t?i[a+1]:i[0],_=r.sub(c,m),v=r.sub(p,m),u=r.crossVec2Vec2(_,v),h=.5*u;s+=h,e.addMul(h*n,m),e.addMul(h*n,c),e.addMul(h*n,p)}return e.mul(1/s),e}var Se=function(i){S(t,i);function t(e,s,o,a){var n=this;return n instanceof t?(n=i.call(this)||this,n._setAsBox(e,s,o,a),n):new t(e,s,o,a)}return t.TYPE="polygon",t}(kt),Wt=function(i){S(t,i);function t(e,s){var o=this;return o instanceof t?(o=i.call(this)||this,o.m_type=t.TYPE,o.m_p=r.zero(),o.m_radius=1,typeof e=="object"&&r.isValid(e)?(o.m_p.setVec2(e),typeof s=="number"&&(o.m_radius=s)):typeof e=="number"&&(o.m_radius=e),o):new t(e,s)}return t.prototype._serialize=function(){return{type:this.m_type,p:this.m_p,radius:this.m_radius}},t._deserialize=function(e){return new t(e.p,e.radius)},t.prototype.getRadius=function(){return this.m_radius},t.prototype.getCenter=function(){return this.m_p},t.prototype.getVertex=function(e){return this.m_p},t.prototype._clone=function(){var e=new t;return e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_p=this.m_p.clone(),e},t.prototype.getChildCount=function(){return 1},t.prototype.testPoint=function(e,s){var o=r.add(e.p,V.mulVec2(e.q,this.m_p)),a=r.sub(s,o);return r.dot(a,a)<=this.m_radius*this.m_radius},t.prototype.rayCast=function(e,s,o,a){var n=r.add(o.p,V.mulVec2(o.q,this.m_p)),m=r.sub(s.p1,n),c=r.dot(m,m)-this.m_radius*this.m_radius,p=r.sub(s.p2,s.p1),_=r.dot(m,p),v=r.dot(p,p),u=_*_-v*c;if(u<0||v<b.EPSILON)return!1;var h=-(_+b.sqrt(u));return 0<=h&&h<=s.maxFraction*v?(h/=v,e.fraction=h,e.normal=r.add(m,r.mulNumVec2(h,p)),e.normal.normalize(),!0):!1},t.prototype.computeAABB=function(e,s,o){var a=r.add(s.p,V.mulVec2(s.q,this.m_p));e.lowerBound.setNum(a.x-this.m_radius,a.y-this.m_radius),e.upperBound.setNum(a.x+this.m_radius,a.y+this.m_radius)},t.prototype.computeMass=function(e,s){e.mass=s*b.PI*this.m_radius*this.m_radius,e.center=this.m_p,e.I=e.mass*(.5*this.m_radius*this.m_radius+r.dot(this.m_p,this.m_p))},t.prototype.computeDistanceProxy=function(e){e.m_vertices.push(this.m_p),e.m_count=1,e.m_radius=this.m_radius},t.TYPE="circle",t}(G),Ji={frequencyHz:0,dampingRatio:0},Pe=function(i){S(t,i);function t(e,s,o,a,n){var m=this;if(!(m instanceof t))return new t(e,s,o,a,n);if(o&&a&&"m_type"in a&&"x"in o&&"y"in o){var c=o;o=a,a=c}return e=k(e,Ji),m=i.call(this,e,s,o)||this,s=m.m_bodyA,o=m.m_bodyB,m.m_type=t.TYPE,m.m_localAnchorA=r.clone(a?s.getLocalPoint(a):e.localAnchorA||r.zero()),m.m_localAnchorB=r.clone(n?o.getLocalPoint(n):e.localAnchorB||r.zero()),m.m_length=b.isFinite(e.length)?e.length:r.distance(s.getWorldPoint(m.m_localAnchorA),o.getWorldPoint(m.m_localAnchorB)),m.m_frequencyHz=e.frequencyHz,m.m_dampingRatio=e.dampingRatio,m.m_impulse=0,m.m_gamma=0,m.m_bias=0,m}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,length:this.m_length,impulse:this.m_impulse,gamma:this.m_gamma,bias:this.m_bias}},t._deserialize=function(e,s,o){e=q({},e),e.bodyA=o(tt,e.bodyA,s),e.bodyB=o(tt,e.bodyB,s);var a=new t(e);return a},t.prototype._setAnchors=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),e.length>0?this.m_length=+e.length:e.length<0||(e.anchorA||e.anchorA||e.anchorA||e.anchorA)&&(this.m_length=r.distance(this.m_bodyA.getWorldPoint(this.m_localAnchorA),this.m_bodyB.getWorldPoint(this.m_localAnchorB)))},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.setLength=function(e){this.m_length=e},t.prototype.getLength=function(){return this.m_length},t.prototype.setFrequency=function(e){this.m_frequencyHz=e},t.prototype.getFrequency=function(){return this.m_frequencyHz},t.prototype.setDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return r.mulNumVec2(this.m_impulse,this.m_u).mul(e)},t.prototype.getReactionTorque=function(e){return 0},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,a=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_position.c,c=this.m_bodyB.c_position.a,p=this.m_bodyB.c_velocity.v,_=this.m_bodyB.c_velocity.w,v=V.neo(o),u=V.neo(c);this.m_rA=V.mulVec2(v,r.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=V.mulVec2(u,r.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=r.sub(r.add(m,this.m_rB),r.add(s,this.m_rA));var h=this.m_u.length();h>P.linearSlop?this.m_u.mul(1/h):this.m_u.setNum(0,0);var l=r.crossVec2Vec2(this.m_rA,this.m_u),y=r.crossVec2Vec2(this.m_rB,this.m_u),f=this.m_invMassA+this.m_invIA*l*l+this.m_invMassB+this.m_invIB*y*y;if(this.m_mass=f!=0?1/f:0,this.m_frequencyHz>0){var d=h-this.m_length,A=2*b.PI*this.m_frequencyHz,x=2*this.m_mass*this.m_dampingRatio*A,C=this.m_mass*A*A,M=e.dt;this.m_gamma=M*(x+M*C),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=d*M*C*this.m_gamma,f+=this.m_gamma,this.m_mass=f!=0?1/f:0}else this.m_gamma=0,this.m_bias=0;if(e.warmStarting){this.m_impulse*=e.dtRatio;var I=r.mulNumVec2(this.m_impulse,this.m_u);a.subMul(this.m_invMassA,I),n-=this.m_invIA*r.crossVec2Vec2(this.m_rA,I),p.addMul(this.m_invMassB,I),_+=this.m_invIB*r.crossVec2Vec2(this.m_rB,I)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(a),this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v.setVec2(p),this.m_bodyB.c_velocity.w=_},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_velocity.v,n=this.m_bodyB.c_velocity.w,m=r.add(s,r.crossNumVec2(o,this.m_rA)),c=r.add(a,r.crossNumVec2(n,this.m_rB)),p=r.dot(this.m_u,c)-r.dot(this.m_u,m),_=-this.m_mass*(p+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=_;var v=r.mulNumVec2(_,this.m_u);s.subMul(this.m_invMassA,v),o-=this.m_invIA*r.crossVec2Vec2(this.m_rA,v),a.addMul(this.m_invMassB,v),n+=this.m_invIB*r.crossVec2Vec2(this.m_rB,v),this.m_bodyA.c_velocity.v.setVec2(s),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=n},t.prototype.solvePositionConstraints=function(e){if(this.m_frequencyHz>0)return!0;var s=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,a=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,m=V.neo(o),c=V.neo(n),p=V.mulSub(m,this.m_localAnchorA,this.m_localCenterA),_=V.mulSub(c,this.m_localAnchorB,this.m_localCenterB),v=r.sub(r.add(a,_),r.add(s,p)),u=v.normalize(),h=u-this.m_length;h=b.clamp(h,-P.maxLinearCorrection,P.maxLinearCorrection);var l=-this.m_mass*h,y=r.mulNumVec2(l,v);return s.subMul(this.m_invMassA,y),o-=this.m_invIA*r.crossVec2Vec2(p,y),a.addMul(this.m_invMassB,y),n+=this.m_invIB*r.crossVec2Vec2(_,y),this.m_bodyA.c_position.c.setVec2(s),this.m_bodyA.c_position.a=o,this.m_bodyB.c_position.c.setVec2(a),this.m_bodyB.c_position.a=n,b.abs(h)<P.linearSlop},t.TYPE="distance-joint",t}(pt),Oi={maxForce:0,maxTorque:0},ze=function(i){S(t,i);function t(e,s,o,a){var n=this;return n instanceof t?(e=k(e,Oi),n=i.call(this,e,s,o)||this,s=n.m_bodyA,o=n.m_bodyB,n.m_type=t.TYPE,n.m_localAnchorA=r.clone(a?s.getLocalPoint(a):e.localAnchorA||r.zero()),n.m_localAnchorB=r.clone(a?o.getLocalPoint(a):e.localAnchorB||r.zero()),n.m_linearImpulse=r.zero(),n.m_angularImpulse=0,n.m_maxForce=e.maxForce,n.m_maxTorque=e.maxTorque,n):new t(e,s,o,a)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB}},t._deserialize=function(e,s,o){e=q({},e),e.bodyA=o(tt,e.bodyA,s),e.bodyB=o(tt,e.bodyB,s);var a=new t(e);return a},t.prototype._setAnchors=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.setMaxForce=function(e){this.m_maxForce=e},t.prototype.getMaxForce=function(){return this.m_maxForce},t.prototype.setMaxTorque=function(e){this.m_maxTorque=e},t.prototype.getMaxTorque=function(){return this.m_maxTorque},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return r.mulNumVec2(e,this.m_linearImpulse)},t.prototype.getReactionTorque=function(e){return e*this.m_angularImpulse},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,a=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,c=this.m_bodyB.c_velocity.w,p=V.neo(s),_=V.neo(n);this.m_rA=V.mulVec2(p,r.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=V.mulVec2(_,r.sub(this.m_localAnchorB,this.m_localCenterB));var v=this.m_invMassA,u=this.m_invMassB,h=this.m_invIA,l=this.m_invIB,y=new dt;if(y.ex.x=v+u+h*this.m_rA.y*this.m_rA.y+l*this.m_rB.y*this.m_rB.y,y.ex.y=-h*this.m_rA.x*this.m_rA.y-l*this.m_rB.x*this.m_rB.y,y.ey.x=y.ex.y,y.ey.y=v+u+h*this.m_rA.x*this.m_rA.x+l*this.m_rB.x*this.m_rB.x,this.m_linearMass=y.getInverse(),this.m_angularMass=h+l,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),e.warmStarting){this.m_linearImpulse.mul(e.dtRatio),this.m_angularImpulse*=e.dtRatio;var f=r.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);o.subMul(v,f),a-=h*(r.crossVec2Vec2(this.m_rA,f)+this.m_angularImpulse),m.addMul(u,f),c+=l*(r.crossVec2Vec2(this.m_rB,f)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=o,this.m_bodyA.c_velocity.w=a,this.m_bodyB.c_velocity.v=m,this.m_bodyB.c_velocity.w=c},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_velocity.v,n=this.m_bodyB.c_velocity.w,m=this.m_invMassA,c=this.m_invMassB,p=this.m_invIA,_=this.m_invIB,v=e.dt;{var u=n-o,h=-this.m_angularMass*u,l=this.m_angularImpulse,y=v*this.m_maxTorque;this.m_angularImpulse=b.clamp(this.m_angularImpulse+h,-y,y),h=this.m_angularImpulse-l,o-=p*h,n+=_*h}{var u=r.sub(r.add(a,r.crossNumVec2(n,this.m_rB)),r.add(s,r.crossNumVec2(o,this.m_rA))),h=r.neg(dt.mulVec2(this.m_linearMass,u)),l=this.m_linearImpulse;this.m_linearImpulse.add(h);var y=v*this.m_maxForce;this.m_linearImpulse.lengthSquared()>y*y&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(y)),h=r.sub(this.m_linearImpulse,l),s.subMul(m,h),o-=p*r.crossVec2Vec2(this.m_rA,h),a.addMul(c,h),n+=_*r.crossVec2Vec2(this.m_rB,h)}this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=n},t.prototype.solvePositionConstraints=function(e){return!0},t.TYPE="friction-joint",t}(pt),Dt=function(){function i(t,e,s){typeof t=="object"&&t!==null?(this.ex=j.clone(t),this.ey=j.clone(e),this.ez=j.clone(s)):(this.ex=j.zero(),this.ey=j.zero(),this.ez=j.zero())}return i.prototype.toString=function(){return JSON.stringify(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:j.isValid(t.ex)&&j.isValid(t.ey)&&j.isValid(t.ez)},i.assert=function(t){},i.prototype.setZero=function(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this},i.prototype.solve33=function(t){var e=j.dot(this.ex,j.cross(this.ey,this.ez));e!==0&&(e=1/e);var s=new j;return s.x=e*j.dot(t,j.cross(this.ey,this.ez)),s.y=e*j.dot(this.ex,j.cross(t,this.ez)),s.z=e*j.dot(this.ex,j.cross(this.ey,t)),s},i.prototype.solve22=function(t){var e=this.ex.x,s=this.ey.x,o=this.ex.y,a=this.ey.y,n=e*a-s*o;n!==0&&(n=1/n);var m=r.zero();return m.x=n*(a*t.x-s*t.y),m.y=n*(e*t.y-o*t.x),m},i.prototype.getInverse22=function(t){var e=this.ex.x,s=this.ey.x,o=this.ex.y,a=this.ey.y,n=e*a-s*o;n!==0&&(n=1/n),t.ex.x=n*a,t.ey.x=-n*s,t.ex.z=0,t.ex.y=-n*o,t.ey.y=n*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},i.prototype.getSymInverse33=function(t){var e=j.dot(this.ex,j.cross(this.ey,this.ez));e!==0&&(e=1/e);var s=this.ex.x,o=this.ey.x,a=this.ez.x,n=this.ey.y,m=this.ez.y,c=this.ez.z;t.ex.x=e*(n*c-m*m),t.ex.y=e*(a*m-o*c),t.ex.z=e*(o*m-a*n),t.ey.x=t.ex.y,t.ey.y=e*(s*c-a*a),t.ey.z=e*(a*o-s*m),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(s*n-o*o)},i.mul=function(t,e){if(e&&"z"in e&&"y"in e&&"x"in e){var s=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,o=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,a=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new j(s,o,a)}else if(e&&"y"in e&&"x"in e){var s=t.ex.x*e.x+t.ey.x*e.y,o=t.ex.y*e.x+t.ey.y*e.y;return r.neo(s,o)}},i.mulVec3=function(t,e){var s=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,o=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,a=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new j(s,o,a)},i.mulVec2=function(t,e){var s=t.ex.x*e.x+t.ey.x*e.y,o=t.ex.y*e.x+t.ey.y*e.y;return r.neo(s,o)},i.add=function(t,e){return new i(j.add(t.ex,e.ex),j.add(t.ey,e.ey),j.add(t.ez,e.ez))},i}(),me=0,ue=1,pe=2,ve=3,Yi={lowerAngle:0,upperAngle:0,maxMotorTorque:0,motorSpeed:0,enableLimit:!1,enableMotor:!1},Rt=function(i){S(t,i);function t(e,s,o,a){var n=this;return n instanceof t?(e=k(e,Yi),n=i.call(this,e,s,o)||this,n.m_mass=new Dt,n.m_limitState=me,s=n.m_bodyA,o=n.m_bodyB,n.m_type=t.TYPE,n.m_localAnchorA=r.clone(a?s.getLocalPoint(a):e.localAnchorA||r.zero()),n.m_localAnchorB=r.clone(a?o.getLocalPoint(a):e.localAnchorB||r.zero()),n.m_referenceAngle=b.isFinite(e.referenceAngle)?e.referenceAngle:o.getAngle()-s.getAngle(),n.m_impulse=new j,n.m_motorImpulse=0,n.m_lowerAngle=e.lowerAngle,n.m_upperAngle=e.upperAngle,n.m_maxMotorTorque=e.maxMotorTorque,n.m_motorSpeed=e.motorSpeed,n.m_enableLimit=e.enableLimit,n.m_enableMotor=e.enableMotor,n):new t(e,s,o,a)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerAngle:this.m_lowerAngle,upperAngle:this.m_upperAngle,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},t._deserialize=function(e,s,o){e=q({},e),e.bodyA=o(tt,e.bodyA,s),e.bodyB=o(tt,e.bodyB,s);var a=new t(e);return a},t.prototype._setAnchors=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getReferenceAngle=function(){return this.m_referenceAngle},t.prototype.getJointAngle=function(){var e=this.m_bodyA,s=this.m_bodyB;return s.m_sweep.a-e.m_sweep.a-this.m_referenceAngle},t.prototype.getJointSpeed=function(){var e=this.m_bodyA,s=this.m_bodyB;return s.m_angularVelocity-e.m_angularVelocity},t.prototype.isMotorEnabled=function(){return this.m_enableMotor},t.prototype.enableMotor=function(e){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=e},t.prototype.getMotorTorque=function(e){return e*this.m_motorImpulse},t.prototype.setMotorSpeed=function(e){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=e},t.prototype.getMotorSpeed=function(){return this.m_motorSpeed},t.prototype.setMaxMotorTorque=function(e){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=e},t.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},t.prototype.isLimitEnabled=function(){return this.m_enableLimit},t.prototype.enableLimit=function(e){e!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=e,this.m_impulse.z=0)},t.prototype.getLowerLimit=function(){return this.m_lowerAngle},t.prototype.getUpperLimit=function(){return this.m_upperAngle},t.prototype.setLimits=function(e,s){(e!=this.m_lowerAngle||s!=this.m_upperAngle)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=e,this.m_upperAngle=s)},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return r.neo(this.m_impulse.x,this.m_impulse.y).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_impulse.z},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,a=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,c=this.m_bodyB.c_velocity.w,p=V.neo(s),_=V.neo(n);this.m_rA=V.mulVec2(p,r.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=V.mulVec2(_,r.sub(this.m_localAnchorB,this.m_localCenterB));var v=this.m_invMassA,u=this.m_invMassB,h=this.m_invIA,l=this.m_invIB,y=h+l===0;if(this.m_mass.ex.x=v+u+this.m_rA.y*this.m_rA.y*h+this.m_rB.y*this.m_rB.y*l,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*h-this.m_rB.y*this.m_rB.x*l,this.m_mass.ez.x=-this.m_rA.y*h-this.m_rB.y*l,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=v+u+this.m_rA.x*this.m_rA.x*h+this.m_rB.x*this.m_rB.x*l,this.m_mass.ez.y=this.m_rA.x*h+this.m_rB.x*l,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=h+l,this.m_motorMass=h+l,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(this.m_enableMotor==!1||y)&&(this.m_motorImpulse=0),this.m_enableLimit&&y==!1){var f=n-s-this.m_referenceAngle;b.abs(this.m_upperAngle-this.m_lowerAngle)<2*P.angularSlop?this.m_limitState=ve:f<=this.m_lowerAngle?(this.m_limitState!=ue&&(this.m_impulse.z=0),this.m_limitState=ue):f>=this.m_upperAngle?(this.m_limitState!=pe&&(this.m_impulse.z=0),this.m_limitState=pe):(this.m_limitState=me,this.m_impulse.z=0)}else this.m_limitState=me;if(e.warmStarting){this.m_impulse.mul(e.dtRatio),this.m_motorImpulse*=e.dtRatio;var d=r.neo(this.m_impulse.x,this.m_impulse.y);o.subMul(v,d),a-=h*(r.crossVec2Vec2(this.m_rA,d)+this.m_motorImpulse+this.m_impulse.z),m.addMul(u,d),c+=l*(r.crossVec2Vec2(this.m_rB,d)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=o,this.m_bodyA.c_velocity.w=a,this.m_bodyB.c_velocity.v=m,this.m_bodyB.c_velocity.w=c},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_velocity.v,n=this.m_bodyB.c_velocity.w,m=this.m_invMassA,c=this.m_invMassB,p=this.m_invIA,_=this.m_invIB,v=p+_===0;if(this.m_enableMotor&&this.m_limitState!=ve&&v==!1){var u=n-o-this.m_motorSpeed,h=-this.m_motorMass*u,l=this.m_motorImpulse,y=e.dt*this.m_maxMotorTorque;this.m_motorImpulse=b.clamp(this.m_motorImpulse+h,-y,y),h=this.m_motorImpulse-l,o-=p*h,n+=_*h}if(this.m_enableLimit&&this.m_limitState!=me&&v==!1){var f=r.zero();f.addCombine(1,a,1,r.crossNumVec2(n,this.m_rB)),f.subCombine(1,s,1,r.crossNumVec2(o,this.m_rA));var d=n-o,u=new j(f.x,f.y,d),h=j.neg(this.m_mass.solve33(u));if(this.m_limitState==ve)this.m_impulse.add(h);else if(this.m_limitState==ue){var A=this.m_impulse.z+h.z;if(A<0){var x=r.combine(-1,f,this.m_impulse.z,r.neo(this.m_mass.ez.x,this.m_mass.ez.y)),C=this.m_mass.solve22(x);h.x=C.x,h.y=C.y,h.z=-this.m_impulse.z,this.m_impulse.x+=C.x,this.m_impulse.y+=C.y,this.m_impulse.z=0}else this.m_impulse.add(h)}else if(this.m_limitState==pe){var A=this.m_impulse.z+h.z;if(A>0){var x=r.combine(-1,f,this.m_impulse.z,r.neo(this.m_mass.ez.x,this.m_mass.ez.y)),C=this.m_mass.solve22(x);h.x=C.x,h.y=C.y,h.z=-this.m_impulse.z,this.m_impulse.x+=C.x,this.m_impulse.y+=C.y,this.m_impulse.z=0}else this.m_impulse.add(h)}var M=r.neo(h.x,h.y);s.subMul(m,M),o-=p*(r.crossVec2Vec2(this.m_rA,M)+h.z),a.addMul(c,M),n+=_*(r.crossVec2Vec2(this.m_rB,M)+h.z)}else{var u=r.zero();u.addCombine(1,a,1,r.crossNumVec2(n,this.m_rB)),u.subCombine(1,s,1,r.crossNumVec2(o,this.m_rA));var h=this.m_mass.solve22(r.neg(u));this.m_impulse.x+=h.x,this.m_impulse.y+=h.y,s.subMul(m,h),o-=p*r.crossVec2Vec2(this.m_rA,h),a.addMul(c,h),n+=_*r.crossVec2Vec2(this.m_rB,h)}this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=n},t.prototype.solvePositionConstraints=function(e){var s=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,a=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,m=V.neo(o),c=V.neo(n),p=0,_=0,v=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=me&&v==!1){var u=n-o-this.m_referenceAngle,h=0;if(this.m_limitState==ve){var l=b.clamp(u-this.m_lowerAngle,-P.maxAngularCorrection,P.maxAngularCorrection);h=-this.m_motorMass*l,p=b.abs(l)}else if(this.m_limitState==ue){var l=u-this.m_lowerAngle;p=-l,l=b.clamp(l+P.angularSlop,-P.maxAngularCorrection,0),h=-this.m_motorMass*l}else if(this.m_limitState==pe){var l=u-this.m_upperAngle;p=l,l=b.clamp(l-P.angularSlop,0,P.maxAngularCorrection),h=-this.m_motorMass*l}o-=this.m_invIA*h,n+=this.m_invIB*h}{m.setAngle(o),c.setAngle(n);var y=V.mulVec2(m,r.sub(this.m_localAnchorA,this.m_localCenterA)),f=V.mulVec2(c,r.sub(this.m_localAnchorB,this.m_localCenterB)),l=r.zero();l.addCombine(1,a,1,f),l.subCombine(1,s,1,y),_=l.length();var d=this.m_invMassA,A=this.m_invMassB,x=this.m_invIA,C=this.m_invIB,M=new dt;M.ex.x=d+A+x*y.y*y.y+C*f.y*f.y,M.ex.y=-x*y.x*y.y-C*f.x*f.y,M.ey.x=M.ex.y,M.ey.y=d+A+x*y.x*y.x+C*f.x*f.x;var I=r.neg(M.solve(l));s.subMul(d,I),o-=x*r.crossVec2Vec2(y,I),a.addMul(A,I),n+=C*r.crossVec2Vec2(f,I)}return this.m_bodyA.c_position.c.setVec2(s),this.m_bodyA.c_position.a=o,this.m_bodyB.c_position.c.setVec2(a),this.m_bodyB.c_position.a=n,_<=P.linearSlop&&p<=P.angularSlop},t.TYPE="revolute-joint",t}(pt),ye=0,Le=1,Te=2,li=3,Wi={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0},Fe=function(i){S(t,i);function t(e,s,o,a,n){var m=this;return m instanceof t?(e=k(e,Wi),m=i.call(this,e,s,o)||this,s=m.m_bodyA,o=m.m_bodyB,m.m_type=t.TYPE,m.m_localAnchorA=r.clone(a?s.getLocalPoint(a):e.localAnchorA||r.zero()),m.m_localAnchorB=r.clone(a?o.getLocalPoint(a):e.localAnchorB||r.zero()),m.m_localXAxisA=r.clone(n?s.getLocalVector(n):e.localAxisA||r.neo(1,0)),m.m_localXAxisA.normalize(),m.m_localYAxisA=r.crossNumVec2(1,m.m_localXAxisA),m.m_referenceAngle=b.isFinite(e.referenceAngle)?e.referenceAngle:o.getAngle()-s.getAngle(),m.m_impulse=new j,m.m_motorMass=0,m.m_motorImpulse=0,m.m_lowerTranslation=e.lowerTranslation,m.m_upperTranslation=e.upperTranslation,m.m_maxMotorForce=e.maxMotorForce,m.m_motorSpeed=e.motorSpeed,m.m_enableLimit=e.enableLimit,m.m_enableMotor=e.enableMotor,m.m_limitState=ye,m.m_axis=r.zero(),m.m_perp=r.zero(),m.m_K=new Dt,m):new t(e,s,o,a,n)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerTranslation:this.m_lowerTranslation,upperTranslation:this.m_upperTranslation,maxMotorForce:this.m_maxMotorForce,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA,referenceAngle:this.m_referenceAngle}},t._deserialize=function(e,s,o){e=q({},e),e.bodyA=o(tt,e.bodyA,s),e.bodyB=o(tt,e.bodyB,s),e.localAxisA=r.clone(e.localAxisA);var a=new t(e);return a},t.prototype._setAnchors=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),e.localAxisA&&(this.m_localXAxisA.setVec2(e.localAxisA),this.m_localYAxisA.setVec2(r.crossNumVec2(1,e.localAxisA)))},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getLocalAxisA=function(){return this.m_localXAxisA},t.prototype.getReferenceAngle=function(){return this.m_referenceAngle},t.prototype.getJointTranslation=function(){var e=this.m_bodyA.getWorldPoint(this.m_localAnchorA),s=this.m_bodyB.getWorldPoint(this.m_localAnchorB),o=r.sub(s,e),a=this.m_bodyA.getWorldVector(this.m_localXAxisA),n=r.dot(o,a);return n},t.prototype.getJointSpeed=function(){var e=this.m_bodyA,s=this.m_bodyB,o=V.mulVec2(e.m_xf.q,r.sub(this.m_localAnchorA,e.m_sweep.localCenter)),a=V.mulVec2(s.m_xf.q,r.sub(this.m_localAnchorB,s.m_sweep.localCenter)),n=r.add(e.m_sweep.c,o),m=r.add(s.m_sweep.c,a),c=r.sub(m,n),p=V.mulVec2(e.m_xf.q,this.m_localXAxisA),_=e.m_linearVelocity,v=s.m_linearVelocity,u=e.m_angularVelocity,h=s.m_angularVelocity,l=r.dot(c,r.crossNumVec2(u,p))+r.dot(p,r.sub(r.addCrossNumVec2(v,h,a),r.addCrossNumVec2(_,u,o)));return l},t.prototype.isLimitEnabled=function(){return this.m_enableLimit},t.prototype.enableLimit=function(e){e!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=e,this.m_impulse.z=0)},t.prototype.getLowerLimit=function(){return this.m_lowerTranslation},t.prototype.getUpperLimit=function(){return this.m_upperTranslation},t.prototype.setLimits=function(e,s){(e!=this.m_lowerTranslation||s!=this.m_upperTranslation)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=s,this.m_impulse.z=0)},t.prototype.isMotorEnabled=function(){return this.m_enableMotor},t.prototype.enableMotor=function(e){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=e},t.prototype.setMotorSpeed=function(e){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=e},t.prototype.setMaxMotorForce=function(e){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=e},t.prototype.getMaxMotorForce=function(){return this.m_maxMotorForce},t.prototype.getMotorSpeed=function(){return this.m_motorSpeed},t.prototype.getMotorForce=function(e){return e*this.m_motorImpulse},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return r.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_impulse.y},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,a=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_position.c,c=this.m_bodyB.c_position.a,p=this.m_bodyB.c_velocity.v,_=this.m_bodyB.c_velocity.w,v=V.neo(o),u=V.neo(c),h=V.mulVec2(v,r.sub(this.m_localAnchorA,this.m_localCenterA)),l=V.mulVec2(u,r.sub(this.m_localAnchorB,this.m_localCenterB)),y=r.zero();y.addCombine(1,m,1,l),y.subCombine(1,s,1,h);var f=this.m_invMassA,d=this.m_invMassB,A=this.m_invIA,x=this.m_invIB;this.m_axis=V.mulVec2(v,this.m_localXAxisA),this.m_a1=r.crossVec2Vec2(r.add(y,h),this.m_axis),this.m_a2=r.crossVec2Vec2(l,this.m_axis),this.m_motorMass=f+d+A*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass);{this.m_perp=V.mulVec2(v,this.m_localYAxisA),this.m_s1=r.crossVec2Vec2(r.add(y,h),this.m_perp),this.m_s2=r.crossVec2Vec2(l,this.m_perp),r.crossVec2Vec2(h,this.m_perp);var C=f+d+A*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2,M=A*this.m_s1+x*this.m_s2,I=A*this.m_s1*this.m_a1+x*this.m_s2*this.m_a2,z=A+x;z==0&&(z=1);var F=A*this.m_a1+x*this.m_a2,D=f+d+A*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2;this.m_K.ex.set(C,M,I),this.m_K.ey.set(M,z,F),this.m_K.ez.set(I,F,D)}if(this.m_enableLimit){var E=r.dot(this.m_axis,y);b.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*P.linearSlop?this.m_limitState=li:E<=this.m_lowerTranslation?this.m_limitState!=Le&&(this.m_limitState=Le,this.m_impulse.z=0):E>=this.m_upperTranslation?this.m_limitState!=Te&&(this.m_limitState=Te,this.m_impulse.z=0):(this.m_limitState=ye,this.m_impulse.z=0)}else this.m_limitState=ye,this.m_impulse.z=0;if(this.m_enableMotor==!1&&(this.m_motorImpulse=0),e.warmStarting){this.m_impulse.mul(e.dtRatio),this.m_motorImpulse*=e.dtRatio;var N=r.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),T=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,Z=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;a.subMul(f,N),n-=A*T,p.addMul(d,N),_+=x*Z}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(a),this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v.setVec2(p),this.m_bodyB.c_velocity.w=_},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_velocity.v,n=this.m_bodyB.c_velocity.w,m=this.m_invMassA,c=this.m_invMassB,p=this.m_invIA,_=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!=li){var v=r.dot(this.m_axis,r.sub(a,s))+this.m_a2*n-this.m_a1*o,u=this.m_motorMass*(this.m_motorSpeed-v),h=this.m_motorImpulse,l=e.dt*this.m_maxMotorForce;this.m_motorImpulse=b.clamp(this.m_motorImpulse+u,-l,l),u=this.m_motorImpulse-h;var y=r.mulNumVec2(u,this.m_axis),f=u*this.m_a1,d=u*this.m_a2;s.subMul(m,y),o-=p*f,a.addMul(c,y),n+=_*d}var A=r.zero();if(A.x+=r.dot(this.m_perp,a)+this.m_s2*n,A.x-=r.dot(this.m_perp,s)+this.m_s1*o,A.y=n-o,this.m_enableLimit&&this.m_limitState!=ye){var x=0;x+=r.dot(this.m_axis,a)+this.m_a2*n,x-=r.dot(this.m_axis,s)+this.m_a1*o;var v=new j(A.x,A.y,x),C=j.clone(this.m_impulse),M=this.m_K.solve33(j.neg(v));this.m_impulse.add(M),this.m_limitState==Le?this.m_impulse.z=b.max(this.m_impulse.z,0):this.m_limitState==Te&&(this.m_impulse.z=b.min(this.m_impulse.z,0));var I=r.combine(-1,A,-(this.m_impulse.z-C.z),r.neo(this.m_K.ez.x,this.m_K.ez.y)),z=r.add(this.m_K.solve22(I),r.neo(C.x,C.y));this.m_impulse.x=z.x,this.m_impulse.y=z.y,M=j.sub(this.m_impulse,C);var y=r.combine(M.x,this.m_perp,M.z,this.m_axis),f=M.x*this.m_s1+M.y+M.z*this.m_a1,d=M.x*this.m_s2+M.y+M.z*this.m_a2;s.subMul(m,y),o-=p*f,a.addMul(c,y),n+=_*d}else{var M=this.m_K.solve22(r.neg(A));this.m_impulse.x+=M.x,this.m_impulse.y+=M.y;var y=r.mulNumVec2(M.x,this.m_perp),f=M.x*this.m_s1+M.y,d=M.x*this.m_s2+M.y;s.subMul(m,y),o-=p*f,a.addMul(c,y),n+=_*d}this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=n},t.prototype.solvePositionConstraints=function(e){var s=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,a=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,m=V.neo(o),c=V.neo(n),p=this.m_invMassA,_=this.m_invMassB,v=this.m_invIA,u=this.m_invIB,h=V.mulVec2(m,r.sub(this.m_localAnchorA,this.m_localCenterA)),l=V.mulVec2(c,r.sub(this.m_localAnchorB,this.m_localCenterB)),y=r.sub(r.add(a,l),r.add(s,h)),f=V.mulVec2(m,this.m_localXAxisA),d=r.crossVec2Vec2(r.add(y,h),f),A=r.crossVec2Vec2(l,f),x=V.mulVec2(m,this.m_localYAxisA),C=r.crossVec2Vec2(r.add(y,h),x),M=r.crossVec2Vec2(l,x),I=new j,z=r.zero();z.x=r.dot(x,y),z.y=n-o-this.m_referenceAngle;var F=b.abs(z.x),D=b.abs(z.y),E=P.linearSlop,N=P.maxLinearCorrection,T=!1,Z=0;if(this.m_enableLimit){var H=r.dot(f,y);b.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*E?(Z=b.clamp(H,-N,N),F=b.max(F,b.abs(H)),T=!0):H<=this.m_lowerTranslation?(Z=b.clamp(H-this.m_lowerTranslation+E,-N,0),F=b.max(F,this.m_lowerTranslation-H),T=!0):H>=this.m_upperTranslation&&(Z=b.clamp(H-this.m_upperTranslation-E,0,N),F=b.max(F,H-this.m_upperTranslation),T=!0)}if(T){var $=p+_+v*C*C+u*M*M,ot=v*C+u*M,nt=v*C*d+u*M*A,it=v+u;it==0&&(it=1);var Y=v*d+u*A,U=p+_+v*d*d+u*A*A,X=new Dt;X.ex.set($,ot,nt),X.ey.set(ot,it,Y),X.ez.set(nt,Y,U);var O=new j;O.x=z.x,O.y=z.y,O.z=Z,I=X.solve33(j.neg(O))}else{var $=p+_+v*C*C+u*M*M,ot=v*C+u*M,it=v+u;it==0&&(it=1);var X=new dt;X.ex.setNum($,ot),X.ey.setNum(ot,it);var ct=X.solve(r.neg(z));I.x=ct.x,I.y=ct.y,I.z=0}var xt=r.combine(I.x,x,I.z,f),wt=I.x*C+I.y+I.z*d,_t=I.x*M+I.y+I.z*A;return s.subMul(p,xt),o-=v*wt,a.addMul(_,xt),n+=u*_t,this.m_bodyA.c_position.c=s,this.m_bodyA.c_position.a=o,this.m_bodyB.c_position.c=a,this.m_bodyB.c_position.a=n,F<=P.linearSlop&&D<=P.angularSlop},t.TYPE="prismatic-joint",t}(pt),Hi={ratio:1},qe=function(i){S(t,i);function t(e,s,o,a,n,m){var c=this;if(!(c instanceof t))return new t(e,s,o,a,n,m);e=k(e,Hi),c=i.call(this,e,s,o)||this,s=c.m_bodyA,o=c.m_bodyB,c.m_type=t.TYPE,c.m_joint1=a||e.joint1,c.m_joint2=n||e.joint2,c.m_ratio=b.isFinite(m)?m:e.ratio,c.m_type1=c.m_joint1.getType(),c.m_type2=c.m_joint2.getType();var p,_;c.m_bodyC=c.m_joint1.getBodyA(),c.m_bodyA=c.m_joint1.getBodyB();var v=c.m_bodyA.m_xf,u=c.m_bodyA.m_sweep.a,h=c.m_bodyC.m_xf,l=c.m_bodyC.m_sweep.a;if(c.m_type1===Rt.TYPE){var y=c.m_joint1;c.m_localAnchorC=y.m_localAnchorA,c.m_localAnchorA=y.m_localAnchorB,c.m_referenceAngleA=y.m_referenceAngle,c.m_localAxisC=r.zero(),p=u-l-c.m_referenceAngleA}else{var f=c.m_joint1;c.m_localAnchorC=f.m_localAnchorA,c.m_localAnchorA=f.m_localAnchorB,c.m_referenceAngleA=f.m_referenceAngle,c.m_localAxisC=f.m_localXAxisA;var d=c.m_localAnchorC,A=V.mulTVec2(h.q,r.add(V.mulVec2(v.q,c.m_localAnchorA),r.sub(v.p,h.p)));p=r.dot(A,c.m_localAxisC)-r.dot(d,c.m_localAxisC)}c.m_bodyD=c.m_joint2.getBodyA(),c.m_bodyB=c.m_joint2.getBodyB();var x=c.m_bodyB.m_xf,C=c.m_bodyB.m_sweep.a,M=c.m_bodyD.m_xf,I=c.m_bodyD.m_sweep.a;if(c.m_type2===Rt.TYPE){var y=c.m_joint2;c.m_localAnchorD=y.m_localAnchorA,c.m_localAnchorB=y.m_localAnchorB,c.m_referenceAngleB=y.m_referenceAngle,c.m_localAxisD=r.zero(),_=C-I-c.m_referenceAngleB}else{var f=c.m_joint2;c.m_localAnchorD=f.m_localAnchorA,c.m_localAnchorB=f.m_localAnchorB,c.m_referenceAngleB=f.m_referenceAngle,c.m_localAxisD=f.m_localXAxisA;var z=c.m_localAnchorD,F=V.mulTVec2(M.q,r.add(V.mulVec2(x.q,c.m_localAnchorB),r.sub(x.p,M.p)));_=r.dot(F,c.m_localAxisD)-r.dot(z,c.m_localAxisD)}return c.m_constant=p+c.m_ratio*_,c.m_impulse=0,c}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,joint1:this.m_joint1,joint2:this.m_joint2,ratio:this.m_ratio}},t._deserialize=function(e,s,o){e=q({},e),e.bodyA=o(tt,e.bodyA,s),e.bodyB=o(tt,e.bodyB,s),e.joint1=o(pt,e.joint1,s),e.joint2=o(pt,e.joint2,s);var a=new t(e);return a},t.prototype.getJoint1=function(){return this.m_joint1},t.prototype.getJoint2=function(){return this.m_joint2},t.prototype.setRatio=function(e){this.m_ratio=e},t.prototype.getRatio=function(){return this.m_ratio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return r.mulNumVec2(this.m_impulse,this.m_JvAC).mul(e)},t.prototype.getReactionTorque=function(e){var s=this.m_impulse*this.m_JwA;return e*s},t.prototype.initVelocityConstraints=function(e){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var s=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,a=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,c=this.m_bodyB.c_velocity.w,p=this.m_bodyC.c_position.a,_=this.m_bodyC.c_velocity.v,v=this.m_bodyC.c_velocity.w,u=this.m_bodyD.c_position.a,h=this.m_bodyD.c_velocity.v,l=this.m_bodyD.c_velocity.w,y=V.neo(s),f=V.neo(n),d=V.neo(p),A=V.neo(u);if(this.m_mass=0,this.m_type1==Rt.TYPE)this.m_JvAC=r.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var x=V.mulVec2(d,this.m_localAxisC),C=V.mulSub(d,this.m_localAnchorC,this.m_lcC),M=V.mulSub(y,this.m_localAnchorA,this.m_lcA);this.m_JvAC=x,this.m_JwC=r.crossVec2Vec2(C,x),this.m_JwA=r.crossVec2Vec2(M,x),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==Rt.TYPE)this.m_JvBD=r.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var x=V.mulVec2(A,this.m_localAxisD),I=V.mulSub(A,this.m_localAnchorD,this.m_lcD),z=V.mulSub(f,this.m_localAnchorB,this.m_lcB);this.m_JvBD=r.mulNumVec2(this.m_ratio,x),this.m_JwD=this.m_ratio*r.crossVec2Vec2(I,x),this.m_JwB=this.m_ratio*r.crossVec2Vec2(z,x),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,e.warmStarting?(o.addMul(this.m_mA*this.m_impulse,this.m_JvAC),a+=this.m_iA*this.m_impulse*this.m_JwA,m.addMul(this.m_mB*this.m_impulse,this.m_JvBD),c+=this.m_iB*this.m_impulse*this.m_JwB,_.subMul(this.m_mC*this.m_impulse,this.m_JvAC),v-=this.m_iC*this.m_impulse*this.m_JwC,h.subMul(this.m_mD*this.m_impulse,this.m_JvBD),l-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.setVec2(o),this.m_bodyA.c_velocity.w=a,this.m_bodyB.c_velocity.v.setVec2(m),this.m_bodyB.c_velocity.w=c,this.m_bodyC.c_velocity.v.setVec2(_),this.m_bodyC.c_velocity.w=v,this.m_bodyD.c_velocity.v.setVec2(h),this.m_bodyD.c_velocity.w=l},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_velocity.v,n=this.m_bodyB.c_velocity.w,m=this.m_bodyC.c_velocity.v,c=this.m_bodyC.c_velocity.w,p=this.m_bodyD.c_velocity.v,_=this.m_bodyD.c_velocity.w,v=r.dot(this.m_JvAC,s)-r.dot(this.m_JvAC,m)+r.dot(this.m_JvBD,a)-r.dot(this.m_JvBD,p);v+=this.m_JwA*o-this.m_JwC*c+(this.m_JwB*n-this.m_JwD*_);var u=-this.m_mass*v;this.m_impulse+=u,s.addMul(this.m_mA*u,this.m_JvAC),o+=this.m_iA*u*this.m_JwA,a.addMul(this.m_mB*u,this.m_JvBD),n+=this.m_iB*u*this.m_JwB,m.subMul(this.m_mC*u,this.m_JvAC),c-=this.m_iC*u*this.m_JwC,p.subMul(this.m_mD*u,this.m_JvBD),_-=this.m_iD*u*this.m_JwD,this.m_bodyA.c_velocity.v.setVec2(s),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=n,this.m_bodyC.c_velocity.v.setVec2(m),this.m_bodyC.c_velocity.w=c,this.m_bodyD.c_velocity.v.setVec2(p),this.m_bodyD.c_velocity.w=_},t.prototype.solvePositionConstraints=function(e){var s=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,a=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,m=this.m_bodyC.c_position.c,c=this.m_bodyC.c_position.a,p=this.m_bodyD.c_position.c,_=this.m_bodyD.c_position.a,v=V.neo(o),u=V.neo(n),h=V.neo(c),l=V.neo(_),y=0,f,d,A,x,C,M,I,z,F=0;if(this.m_type1==Rt.TYPE)A=r.zero(),C=1,I=1,F+=this.m_iA+this.m_iC,f=o-c-this.m_referenceAngleA;else{var D=V.mulVec2(h,this.m_localAxisC),E=V.mulSub(h,this.m_localAnchorC,this.m_lcC),N=V.mulSub(v,this.m_localAnchorA,this.m_lcA);A=D,I=r.crossVec2Vec2(E,D),C=r.crossVec2Vec2(N,D),F+=this.m_mC+this.m_mA+this.m_iC*I*I+this.m_iA*C*C;var T=r.sub(this.m_localAnchorC,this.m_lcC),Z=V.mulTVec2(h,r.add(N,r.sub(s,m)));f=r.dot(r.sub(Z,T),this.m_localAxisC)}if(this.m_type2==Rt.TYPE)x=r.zero(),M=this.m_ratio,z=this.m_ratio,F+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),d=n-_-this.m_referenceAngleB;else{var D=V.mulVec2(l,this.m_localAxisD),H=V.mulSub(l,this.m_localAnchorD,this.m_lcD),$=V.mulSub(u,this.m_localAnchorB,this.m_lcB);x=r.mulNumVec2(this.m_ratio,D),z=this.m_ratio*r.crossVec2Vec2(H,D),M=this.m_ratio*r.crossVec2Vec2($,D),F+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*z*z+this.m_iB*M*M;var ot=r.sub(this.m_localAnchorD,this.m_lcD),nt=V.mulTVec2(l,r.add($,r.sub(a,p)));d=r.dot(nt,this.m_localAxisD)-r.dot(ot,this.m_localAxisD)}var it=f+this.m_ratio*d-this.m_constant,Y=0;return F>0&&(Y=-it/F),s.addMul(this.m_mA*Y,A),o+=this.m_iA*Y*C,a.addMul(this.m_mB*Y,x),n+=this.m_iB*Y*M,m.subMul(this.m_mC*Y,A),c-=this.m_iC*Y*I,p.subMul(this.m_mD*Y,x),_-=this.m_iD*Y*z,this.m_bodyA.c_position.c.setVec2(s),this.m_bodyA.c_position.a=o,this.m_bodyB.c_position.c.setVec2(a),this.m_bodyB.c_position.a=n,this.m_bodyC.c_position.c.setVec2(m),this.m_bodyC.c_position.a=c,this.m_bodyD.c_position.c.setVec2(p),this.m_bodyD.c_position.a=_,y<P.linearSlop},t.TYPE="gear-joint",t}(pt),Ui={maxForce:1,maxTorque:1,correctionFactor:.3},Ne=function(i){S(t,i);function t(e,s,o){var a=this;return a instanceof t?(e=k(e,Ui),a=i.call(this,e,s,o)||this,s=a.m_bodyA,o=a.m_bodyB,a.m_type=t.TYPE,a.m_linearOffset=b.isFinite(e.linearOffset)?e.linearOffset:s.getLocalPoint(o.getPosition()),a.m_angularOffset=b.isFinite(e.angularOffset)?e.angularOffset:o.getAngle()-s.getAngle(),a.m_linearImpulse=r.zero(),a.m_angularImpulse=0,a.m_maxForce=e.maxForce,a.m_maxTorque=e.maxTorque,a.m_correctionFactor=e.correctionFactor,a):new t(e,s,o)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,correctionFactor:this.m_correctionFactor,linearOffset:this.m_linearOffset,angularOffset:this.m_angularOffset}},t._deserialize=function(e,s,o){e=q({},e),e.bodyA=o(tt,e.bodyA,s),e.bodyB=o(tt,e.bodyB,s);var a=new t(e);return a},t.prototype._setAnchors=function(e){},t.prototype.setMaxForce=function(e){this.m_maxForce=e},t.prototype.getMaxForce=function(){return this.m_maxForce},t.prototype.setMaxTorque=function(e){this.m_maxTorque=e},t.prototype.getMaxTorque=function(){return this.m_maxTorque},t.prototype.setCorrectionFactor=function(e){this.m_correctionFactor=e},t.prototype.getCorrectionFactor=function(){return this.m_correctionFactor},t.prototype.setLinearOffset=function(e){(e.x!=this.m_linearOffset.x||e.y!=this.m_linearOffset.y)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset=e)},t.prototype.getLinearOffset=function(){return this.m_linearOffset},t.prototype.setAngularOffset=function(e){e!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=e)},t.prototype.getAngularOffset=function(){return this.m_angularOffset},t.prototype.getAnchorA=function(){return this.m_bodyA.getPosition()},t.prototype.getAnchorB=function(){return this.m_bodyB.getPosition()},t.prototype.getReactionForce=function(e){return r.mulNumVec2(e,this.m_linearImpulse)},t.prototype.getReactionTorque=function(e){return e*this.m_angularImpulse},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,a=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_position.c,c=this.m_bodyB.c_position.a,p=this.m_bodyB.c_velocity.v,_=this.m_bodyB.c_velocity.w,v=V.neo(o),u=V.neo(c);this.m_rA=V.mulVec2(v,r.neg(this.m_localCenterA)),this.m_rB=V.mulVec2(u,r.neg(this.m_localCenterB));var h=this.m_invMassA,l=this.m_invMassB,y=this.m_invIA,f=this.m_invIB,d=new dt;if(d.ex.x=h+l+y*this.m_rA.y*this.m_rA.y+f*this.m_rB.y*this.m_rB.y,d.ex.y=-y*this.m_rA.x*this.m_rA.y-f*this.m_rB.x*this.m_rB.y,d.ey.x=d.ex.y,d.ey.y=h+l+y*this.m_rA.x*this.m_rA.x+f*this.m_rB.x*this.m_rB.x,this.m_linearMass=d.getInverse(),this.m_angularMass=y+f,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=r.zero(),this.m_linearError.addCombine(1,m,1,this.m_rB),this.m_linearError.subCombine(1,s,1,this.m_rA),this.m_linearError.sub(V.mulVec2(v,this.m_linearOffset)),this.m_angularError=c-o-this.m_angularOffset,e.warmStarting){this.m_linearImpulse.mul(e.dtRatio),this.m_angularImpulse*=e.dtRatio;var A=r.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);a.subMul(h,A),n-=y*(r.crossVec2Vec2(this.m_rA,A)+this.m_angularImpulse),p.addMul(l,A),_+=f*(r.crossVec2Vec2(this.m_rB,A)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=a,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=p,this.m_bodyB.c_velocity.w=_},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_velocity.v,n=this.m_bodyB.c_velocity.w,m=this.m_invMassA,c=this.m_invMassB,p=this.m_invIA,_=this.m_invIB,v=e.dt,u=e.inv_dt;{var h=n-o+u*this.m_correctionFactor*this.m_angularError,l=-this.m_angularMass*h,y=this.m_angularImpulse,f=v*this.m_maxTorque;this.m_angularImpulse=b.clamp(this.m_angularImpulse+l,-f,f),l=this.m_angularImpulse-y,o-=p*l,n+=_*l}{var h=r.zero();h.addCombine(1,a,1,r.crossNumVec2(n,this.m_rB)),h.subCombine(1,s,1,r.crossNumVec2(o,this.m_rA)),h.addMul(u*this.m_correctionFactor,this.m_linearError);var l=r.neg(dt.mulVec2(this.m_linearMass,h)),y=r.clone(this.m_linearImpulse);this.m_linearImpulse.add(l);var f=v*this.m_maxForce;this.m_linearImpulse.clamp(f),l=r.sub(this.m_linearImpulse,y),s.subMul(m,l),o-=p*r.crossVec2Vec2(this.m_rA,l),a.addMul(c,l),n+=_*r.crossVec2Vec2(this.m_rB,l)}this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=n},t.prototype.solvePositionConstraints=function(e){return!0},t.TYPE="motor-joint",t}(pt),Zi={maxForce:0,frequencyHz:5,dampingRatio:.7},ke=function(i){S(t,i);function t(e,s,o,a){var n=this;return n instanceof t?(e=k(e,Zi),n=i.call(this,e,s,o)||this,s=n.m_bodyA,o=n.m_bodyB,n.m_type=t.TYPE,n.m_targetA=a?r.clone(a):e.target||r.zero(),n.m_localAnchorB=R.mulTVec2(o.getTransform(),n.m_targetA),n.m_maxForce=e.maxForce,n.m_impulse=r.zero(),n.m_frequencyHz=e.frequencyHz,n.m_dampingRatio=e.dampingRatio,n.m_beta=0,n.m_gamma=0,n.m_rB=r.zero(),n.m_localCenterB=r.zero(),n.m_invMassB=0,n.m_invIB=0,n.m_mass=new dt,n.m_C=r.zero(),n):new t(e,s,o,a)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,target:this.m_targetA,maxForce:this.m_maxForce,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,_localAnchorB:this.m_localAnchorB}},t._deserialize=function(e,s,o){e=q({},e),e.bodyA=o(tt,e.bodyA,s),e.bodyB=o(tt,e.bodyB,s),e.target=r.clone(e.target);var a=new t(e);return e._localAnchorB&&(a.m_localAnchorB=e._localAnchorB),a},t.prototype.setTarget=function(e){this.m_bodyB.isAwake()==!1&&this.m_bodyB.setAwake(!0),this.m_targetA=r.clone(e)},t.prototype.getTarget=function(){return this.m_targetA},t.prototype.setMaxForce=function(e){this.m_maxForce=e},t.prototype.getMaxForce=function(){return this.m_maxForce},t.prototype.setFrequency=function(e){this.m_frequencyHz=e},t.prototype.getFrequency=function(){return this.m_frequencyHz},t.prototype.setDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return r.clone(this.m_targetA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return r.mulNumVec2(e,this.m_impulse)},t.prototype.getReactionTorque=function(e){return e*0},t.prototype.shiftOrigin=function(e){this.m_targetA.sub(e)},t.prototype.initVelocityConstraints=function(e){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_bodyB.c_position,o=this.m_bodyB.c_velocity,a=s.c,n=s.a,m=o.v,c=o.w,p=V.neo(n),_=this.m_bodyB.getMass(),v=2*b.PI*this.m_frequencyHz,u=2*_*this.m_dampingRatio*v,h=_*(v*v),l=e.dt;this.m_gamma=l*(u+l*h),this.m_gamma!=0&&(this.m_gamma=1/this.m_gamma),this.m_beta=l*h*this.m_gamma,this.m_rB=V.mulVec2(p,r.sub(this.m_localAnchorB,this.m_localCenterB));var y=new dt;y.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,y.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,y.ey.x=y.ex.y,y.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=y.getInverse(),this.m_C.setVec2(a),this.m_C.addCombine(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),c*=.98,e.warmStarting?(this.m_impulse.mul(e.dtRatio),m.addMul(this.m_invMassB,this.m_impulse),c+=this.m_invIB*r.crossVec2Vec2(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),o.v.setVec2(m),o.w=c},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyB.c_velocity,o=r.clone(s.v),a=s.w,n=r.crossNumVec2(a,this.m_rB);n.add(o),n.addCombine(1,this.m_C,this.m_gamma,this.m_impulse),n.neg();var m=dt.mulVec2(this.m_mass,n),c=r.clone(this.m_impulse);this.m_impulse.add(m);var p=e.dt*this.m_maxForce;this.m_impulse.clamp(p),m=r.sub(this.m_impulse,c),o.addMul(this.m_invMassB,m),a+=this.m_invIB*r.crossVec2Vec2(this.m_rB,m),s.v.setVec2(o),s.w=a},t.prototype.solvePositionConstraints=function(e){return!0},t.TYPE="mouse-joint",t}(pt),Xi={collideConnected:!0},De=function(i){S(t,i);function t(e,s,o,a,n,m,c,p){var _=this;return _ instanceof t?(e=k(e,Xi),_=i.call(this,e,s,o)||this,s=_.m_bodyA,o=_.m_bodyB,_.m_type=t.TYPE,_.m_groundAnchorA=a||e.groundAnchorA||r.neo(-1,1),_.m_groundAnchorB=n||e.groundAnchorB||r.neo(1,1),_.m_localAnchorA=m?s.getLocalPoint(m):e.localAnchorA||r.neo(-1,0),_.m_localAnchorB=c?o.getLocalPoint(c):e.localAnchorB||r.neo(1,0),_.m_lengthA=b.isFinite(e.lengthA)?e.lengthA:r.distance(m,a),_.m_lengthB=b.isFinite(e.lengthB)?e.lengthB:r.distance(c,n),_.m_ratio=b.isFinite(p)?p:e.ratio,_.m_constant=_.m_lengthA+_.m_ratio*_.m_lengthB,_.m_impulse=0,_):new t(e,s,o,a,n,m,c,p)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,groundAnchorA:this.m_groundAnchorA,groundAnchorB:this.m_groundAnchorB,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,lengthA:this.m_lengthA,lengthB:this.m_lengthB,ratio:this.m_ratio}},t._deserialize=function(e,s,o){e=q({},e),e.bodyA=o(tt,e.bodyA,s),e.bodyB=o(tt,e.bodyB,s);var a=new t(e);return a},t.prototype.getGroundAnchorA=function(){return this.m_groundAnchorA},t.prototype.getGroundAnchorB=function(){return this.m_groundAnchorB},t.prototype.getLengthA=function(){return this.m_lengthA},t.prototype.getLengthB=function(){return this.m_lengthB},t.prototype.getRatio=function(){return this.m_ratio},t.prototype.getCurrentLengthA=function(){var e=this.m_bodyA.getWorldPoint(this.m_localAnchorA),s=this.m_groundAnchorA;return r.distance(e,s)},t.prototype.getCurrentLengthB=function(){var e=this.m_bodyB.getWorldPoint(this.m_localAnchorB),s=this.m_groundAnchorB;return r.distance(e,s)},t.prototype.shiftOrigin=function(e){this.m_groundAnchorA.sub(e),this.m_groundAnchorB.sub(e)},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return r.mulNumVec2(this.m_impulse,this.m_uB).mul(e)},t.prototype.getReactionTorque=function(e){return 0},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,a=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_position.c,c=this.m_bodyB.c_position.a,p=this.m_bodyB.c_velocity.v,_=this.m_bodyB.c_velocity.w,v=V.neo(o),u=V.neo(c);this.m_rA=V.mulVec2(v,r.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=V.mulVec2(u,r.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=r.sub(r.add(s,this.m_rA),this.m_groundAnchorA),this.m_uB=r.sub(r.add(m,this.m_rB),this.m_groundAnchorB);var h=this.m_uA.length(),l=this.m_uB.length();h>10*P.linearSlop?this.m_uA.mul(1/h):this.m_uA.setZero(),l>10*P.linearSlop?this.m_uB.mul(1/l):this.m_uB.setZero();var y=r.crossVec2Vec2(this.m_rA,this.m_uA),f=r.crossVec2Vec2(this.m_rB,this.m_uB),d=this.m_invMassA+this.m_invIA*y*y,A=this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=d+this.m_ratio*this.m_ratio*A,this.m_mass>0&&(this.m_mass=1/this.m_mass),e.warmStarting){this.m_impulse*=e.dtRatio;var x=r.mulNumVec2(-this.m_impulse,this.m_uA),C=r.mulNumVec2(-this.m_ratio*this.m_impulse,this.m_uB);a.addMul(this.m_invMassA,x),n+=this.m_invIA*r.crossVec2Vec2(this.m_rA,x),p.addMul(this.m_invMassB,C),_+=this.m_invIB*r.crossVec2Vec2(this.m_rB,C)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=a,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=p,this.m_bodyB.c_velocity.w=_},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_velocity.v,n=this.m_bodyB.c_velocity.w,m=r.add(s,r.crossNumVec2(o,this.m_rA)),c=r.add(a,r.crossNumVec2(n,this.m_rB)),p=-r.dot(this.m_uA,m)-this.m_ratio*r.dot(this.m_uB,c),_=-this.m_mass*p;this.m_impulse+=_;var v=r.mulNumVec2(-_,this.m_uA),u=r.mulNumVec2(-this.m_ratio*_,this.m_uB);s.addMul(this.m_invMassA,v),o+=this.m_invIA*r.crossVec2Vec2(this.m_rA,v),a.addMul(this.m_invMassB,u),n+=this.m_invIB*r.crossVec2Vec2(this.m_rB,u),this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=n},t.prototype.solvePositionConstraints=function(e){var s=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,a=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,m=V.neo(o),c=V.neo(n),p=V.mulVec2(m,r.sub(this.m_localAnchorA,this.m_localCenterA)),_=V.mulVec2(c,r.sub(this.m_localAnchorB,this.m_localCenterB)),v=r.sub(r.add(s,this.m_rA),this.m_groundAnchorA),u=r.sub(r.add(a,this.m_rB),this.m_groundAnchorB),h=v.length(),l=u.length();h>10*P.linearSlop?v.mul(1/h):v.setZero(),l>10*P.linearSlop?u.mul(1/l):u.setZero();var y=r.crossVec2Vec2(p,v),f=r.crossVec2Vec2(_,u),d=this.m_invMassA+this.m_invIA*y*y,A=this.m_invMassB+this.m_invIB*f*f,x=d+this.m_ratio*this.m_ratio*A;x>0&&(x=1/x);var C=this.m_constant-h-this.m_ratio*l,M=b.abs(C),I=-x*C,z=r.mulNumVec2(-I,v),F=r.mulNumVec2(-this.m_ratio*I,u);return s.addMul(this.m_invMassA,z),o+=this.m_invIA*r.crossVec2Vec2(p,z),a.addMul(this.m_invMassB,F),n+=this.m_invIB*r.crossVec2Vec2(_,F),this.m_bodyA.c_position.c=s,this.m_bodyA.c_position.a=o,this.m_bodyB.c_position.c=a,this.m_bodyB.c_position.a=n,M<P.linearSlop},t.TYPE="pulley-joint",t}(pt),_i=0,ji=2,$i={maxLength:0},Re=function(i){S(t,i);function t(e,s,o,a){var n=this;return n instanceof t?(e=k(e,$i),n=i.call(this,e,s,o)||this,s=n.m_bodyA,o=n.m_bodyB,n.m_type=t.TYPE,n.m_localAnchorA=a?s.getLocalPoint(a):e.localAnchorA||r.neo(-1,0),n.m_localAnchorB=a?o.getLocalPoint(a):e.localAnchorB||r.neo(1,0),n.m_maxLength=e.maxLength,n.m_mass=0,n.m_impulse=0,n.m_length=0,n.m_state=_i,n):new t(e,s,o,a)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,maxLength:this.m_maxLength}},t._deserialize=function(e,s,o){e=q({},e),e.bodyA=o(tt,e.bodyA,s),e.bodyB=o(tt,e.bodyB,s);var a=new t(e);return a},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.setMaxLength=function(e){this.m_maxLength=e},t.prototype.getMaxLength=function(){return this.m_maxLength},t.prototype.getLimitState=function(){return this.m_state},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return r.mulNumVec2(this.m_impulse,this.m_u).mul(e)},t.prototype.getReactionTorque=function(e){return 0},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,a=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_position.c,c=this.m_bodyB.c_position.a,p=this.m_bodyB.c_velocity.v,_=this.m_bodyB.c_velocity.w,v=V.neo(o),u=V.neo(c);this.m_rA=V.mulSub(v,this.m_localAnchorA,this.m_localCenterA),this.m_rB=V.mulSub(u,this.m_localAnchorB,this.m_localCenterB),this.m_u=r.zero(),this.m_u.addCombine(1,m,1,this.m_rB),this.m_u.subCombine(1,s,1,this.m_rA),this.m_length=this.m_u.length();var h=this.m_length-this.m_maxLength;if(h>0?this.m_state=ji:this.m_state=_i,this.m_length>P.linearSlop)this.m_u.mul(1/this.m_length);else{this.m_u.setZero(),this.m_mass=0,this.m_impulse=0;return}var l=r.crossVec2Vec2(this.m_rA,this.m_u),y=r.crossVec2Vec2(this.m_rB,this.m_u),f=this.m_invMassA+this.m_invIA*l*l+this.m_invMassB+this.m_invIB*y*y;if(this.m_mass=f!=0?1/f:0,e.warmStarting){this.m_impulse*=e.dtRatio;var d=r.mulNumVec2(this.m_impulse,this.m_u);a.subMul(this.m_invMassA,d),n-=this.m_invIA*r.crossVec2Vec2(this.m_rA,d),p.addMul(this.m_invMassB,d),_+=this.m_invIB*r.crossVec2Vec2(this.m_rB,d)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(a),this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v.setVec2(p),this.m_bodyB.c_velocity.w=_},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_velocity.v,n=this.m_bodyB.c_velocity.w,m=r.addCrossNumVec2(s,o,this.m_rA),c=r.addCrossNumVec2(a,n,this.m_rB),p=this.m_length-this.m_maxLength,_=r.dot(this.m_u,r.sub(c,m));p<0&&(_+=e.inv_dt*p);var v=-this.m_mass*_,u=this.m_impulse;this.m_impulse=b.min(0,this.m_impulse+v),v=this.m_impulse-u;var h=r.mulNumVec2(v,this.m_u);s.subMul(this.m_invMassA,h),o-=this.m_invIA*r.crossVec2Vec2(this.m_rA,h),a.addMul(this.m_invMassB,h),n+=this.m_invIB*r.crossVec2Vec2(this.m_rB,h),this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=n},t.prototype.solvePositionConstraints=function(e){var s=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,a=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,m=V.neo(o),c=V.neo(n),p=V.mulSub(m,this.m_localAnchorA,this.m_localCenterA),_=V.mulSub(c,this.m_localAnchorB,this.m_localCenterB),v=r.zero();v.addCombine(1,a,1,_),v.subCombine(1,s,1,p);var u=v.normalize(),h=u-this.m_maxLength;h=b.clamp(h,0,P.maxLinearCorrection);var l=-this.m_mass*h,y=r.mulNumVec2(l,v);return s.subMul(this.m_invMassA,y),o-=this.m_invIA*r.crossVec2Vec2(p,y),a.addMul(this.m_invMassB,y),n+=this.m_invIB*r.crossVec2Vec2(_,y),this.m_bodyA.c_position.c.setVec2(s),this.m_bodyA.c_position.a=o,this.m_bodyB.c_position.c.setVec2(a),this.m_bodyB.c_position.a=n,u-this.m_maxLength<P.linearSlop},t.TYPE="rope-joint",t}(pt),Ki={frequencyHz:0,dampingRatio:0},Ee=function(i){S(t,i);function t(e,s,o,a){var n=this;return n instanceof t?(e=k(e,Ki),n=i.call(this,e,s,o)||this,s=n.m_bodyA,o=n.m_bodyB,n.m_type=t.TYPE,n.m_localAnchorA=r.clone(a?s.getLocalPoint(a):e.localAnchorA||r.zero()),n.m_localAnchorB=r.clone(a?o.getLocalPoint(a):e.localAnchorB||r.zero()),n.m_referenceAngle=b.isFinite(e.referenceAngle)?e.referenceAngle:o.getAngle()-s.getAngle(),n.m_frequencyHz=e.frequencyHz,n.m_dampingRatio=e.dampingRatio,n.m_impulse=new j,n.m_bias=0,n.m_gamma=0,n.m_rA,n.m_rB,n.m_localCenterA,n.m_localCenterB,n.m_invMassA,n.m_invMassB,n.m_invIA,n.m_invIB,n.m_mass=new Dt,n):new t(e,s,o,a)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},t._deserialize=function(e,s,o){e=q({},e),e.bodyA=o(tt,e.bodyA,s),e.bodyB=o(tt,e.bodyB,s);var a=new t(e);return a},t.prototype._setAnchors=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getReferenceAngle=function(){return this.m_referenceAngle},t.prototype.setFrequency=function(e){this.m_frequencyHz=e},t.prototype.getFrequency=function(){return this.m_frequencyHz},t.prototype.setDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return r.neo(this.m_impulse.x,this.m_impulse.y).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_impulse.z},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,a=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,c=this.m_bodyB.c_velocity.w,p=V.neo(s),_=V.neo(n);this.m_rA=V.mulVec2(p,r.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=V.mulVec2(_,r.sub(this.m_localAnchorB,this.m_localCenterB));var v=this.m_invMassA,u=this.m_invMassB,h=this.m_invIA,l=this.m_invIB,y=new Dt;if(y.ex.x=v+u+this.m_rA.y*this.m_rA.y*h+this.m_rB.y*this.m_rB.y*l,y.ey.x=-this.m_rA.y*this.m_rA.x*h-this.m_rB.y*this.m_rB.x*l,y.ez.x=-this.m_rA.y*h-this.m_rB.y*l,y.ex.y=y.ey.x,y.ey.y=v+u+this.m_rA.x*this.m_rA.x*h+this.m_rB.x*this.m_rB.x*l,y.ez.y=this.m_rA.x*h+this.m_rB.x*l,y.ex.z=y.ez.x,y.ey.z=y.ez.y,y.ez.z=h+l,this.m_frequencyHz>0){y.getInverse22(this.m_mass);var f=h+l,d=f>0?1/f:0,A=n-s-this.m_referenceAngle,x=2*b.PI*this.m_frequencyHz,C=2*d*this.m_dampingRatio*x,M=d*x*x,I=e.dt;this.m_gamma=I*(C+I*M),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=A*I*M*this.m_gamma,f+=this.m_gamma,this.m_mass.ez.z=f!=0?1/f:0}else y.ez.z==0?(y.getInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(y.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(e.warmStarting){this.m_impulse.mul(e.dtRatio);var z=r.neo(this.m_impulse.x,this.m_impulse.y);o.subMul(v,z),a-=h*(r.crossVec2Vec2(this.m_rA,z)+this.m_impulse.z),m.addMul(u,z),c+=l*(r.crossVec2Vec2(this.m_rB,z)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=o,this.m_bodyA.c_velocity.w=a,this.m_bodyB.c_velocity.v=m,this.m_bodyB.c_velocity.w=c},t.prototype.solveVelocityConstraints=function(e){var s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_velocity.v,n=this.m_bodyB.c_velocity.w,m=this.m_invMassA,c=this.m_invMassB,p=this.m_invIA,_=this.m_invIB;if(this.m_frequencyHz>0){var v=n-o,u=-this.m_mass.ez.z*(v+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=u,o-=p*u,n+=_*u;var h=r.zero();h.addCombine(1,a,1,r.crossNumVec2(n,this.m_rB)),h.subCombine(1,s,1,r.crossNumVec2(o,this.m_rA));var l=r.neg(Dt.mulVec2(this.m_mass,h));this.m_impulse.x+=l.x,this.m_impulse.y+=l.y;var y=r.clone(l);s.subMul(m,y),o-=p*r.crossVec2Vec2(this.m_rA,y),a.addMul(c,y),n+=_*r.crossVec2Vec2(this.m_rB,y)}else{var h=r.zero();h.addCombine(1,a,1,r.crossNumVec2(n,this.m_rB)),h.subCombine(1,s,1,r.crossNumVec2(o,this.m_rA));var v=n-o,f=new j(h.x,h.y,v),d=j.neg(Dt.mulVec3(this.m_mass,f));this.m_impulse.add(d);var y=r.neo(d.x,d.y);s.subMul(m,y),o-=p*(r.crossVec2Vec2(this.m_rA,y)+d.z),a.addMul(c,y),n+=_*(r.crossVec2Vec2(this.m_rB,y)+d.z)}this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=n},t.prototype.solvePositionConstraints=function(e){var s=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,a=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,m=V.neo(o),c=V.neo(n),p=this.m_invMassA,_=this.m_invMassB,v=this.m_invIA,u=this.m_invIB,h=V.mulVec2(m,r.sub(this.m_localAnchorA,this.m_localCenterA)),l=V.mulVec2(c,r.sub(this.m_localAnchorB,this.m_localCenterB)),y,f,d=new Dt;if(d.ex.x=p+_+h.y*h.y*v+l.y*l.y*u,d.ey.x=-h.y*h.x*v-l.y*l.x*u,d.ez.x=-h.y*v-l.y*u,d.ex.y=d.ey.x,d.ey.y=p+_+h.x*h.x*v+l.x*l.x*u,d.ez.y=h.x*v+l.x*u,d.ex.z=d.ez.x,d.ey.z=d.ez.y,d.ez.z=v+u,this.m_frequencyHz>0){var A=r.zero();A.addCombine(1,a,1,l),A.subCombine(1,s,1,h),y=A.length(),f=0;var x=r.neg(d.solve22(A));s.subMul(p,x),o-=v*r.crossVec2Vec2(h,x),a.addMul(_,x),n+=u*r.crossVec2Vec2(l,x)}else{var A=r.zero();A.addCombine(1,a,1,l),A.subCombine(1,s,1,h);var C=n-o-this.m_referenceAngle;y=A.length(),f=b.abs(C);var M=new j(A.x,A.y,C),I=new j;if(d.ez.z>0)I=j.neg(d.solve33(M));else{var z=r.neg(d.solve22(A));I.set(z.x,z.y,0)}var x=r.neo(I.x,I.y);s.subMul(p,x),o-=v*(r.crossVec2Vec2(h,x)+I.z),a.addMul(_,x),n+=u*(r.crossVec2Vec2(l,x)+I.z)}return this.m_bodyA.c_position.c=s,this.m_bodyA.c_position.a=o,this.m_bodyB.c_position.c=a,this.m_bodyB.c_position.a=n,y<=P.linearSlop&&f<=P.angularSlop},t.TYPE="weld-joint",t}(pt),Gi={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7},Je=function(i){S(t,i);function t(e,s,o,a,n){var m=this;return m instanceof t?(e=k(e,Gi),m=i.call(this,e,s,o)||this,m.m_ax=r.zero(),m.m_ay=r.zero(),s=m.m_bodyA,o=m.m_bodyB,m.m_type=t.TYPE,m.m_localAnchorA=r.clone(a?s.getLocalPoint(a):e.localAnchorA||r.zero()),m.m_localAnchorB=r.clone(a?o.getLocalPoint(a):e.localAnchorB||r.zero()),m.m_localXAxisA=r.clone(n?s.getLocalVector(n):e.localAxisA||e.localAxis||r.neo(1,0)),m.m_localYAxisA=r.crossNumVec2(1,m.m_localXAxisA),m.m_mass=0,m.m_impulse=0,m.m_motorMass=0,m.m_motorImpulse=0,m.m_springMass=0,m.m_springImpulse=0,m.m_maxMotorTorque=e.maxMotorTorque,m.m_motorSpeed=e.motorSpeed,m.m_enableMotor=e.enableMotor,m.m_frequencyHz=e.frequencyHz,m.m_dampingRatio=e.dampingRatio,m.m_bias=0,m.m_gamma=0,m):new t(e,s,o,a,n)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,enableMotor:this.m_enableMotor,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA}},t._deserialize=function(e,s,o){e=q({},e),e.bodyA=o(tt,e.bodyA,s),e.bodyB=o(tt,e.bodyB,s);var a=new t(e);return a},t.prototype._setAnchors=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),e.localAxisA&&(this.m_localXAxisA.setVec2(e.localAxisA),this.m_localYAxisA.setVec2(r.crossNumVec2(1,e.localAxisA)))},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getLocalAxisA=function(){return this.m_localXAxisA},t.prototype.getJointTranslation=function(){var e=this.m_bodyA,s=this.m_bodyB,o=e.getWorldPoint(this.m_localAnchorA),a=s.getWorldPoint(this.m_localAnchorB),n=r.sub(a,o),m=e.getWorldVector(this.m_localXAxisA),c=r.dot(n,m);return c},t.prototype.getJointSpeed=function(){var e=this.m_bodyA.m_angularVelocity,s=this.m_bodyB.m_angularVelocity;return s-e},t.prototype.isMotorEnabled=function(){return this.m_enableMotor},t.prototype.enableMotor=function(e){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=e},t.prototype.setMotorSpeed=function(e){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=e},t.prototype.getMotorSpeed=function(){return this.m_motorSpeed},t.prototype.setMaxMotorTorque=function(e){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=e},t.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},t.prototype.getMotorTorque=function(e){return e*this.m_motorImpulse},t.prototype.setSpringFrequencyHz=function(e){this.m_frequencyHz=e},t.prototype.getSpringFrequencyHz=function(){return this.m_frequencyHz},t.prototype.setSpringDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getSpringDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return r.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_motorImpulse},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var s=this.m_invMassA,o=this.m_invMassB,a=this.m_invIA,n=this.m_invIB,m=this.m_bodyA.c_position.c,c=this.m_bodyA.c_position.a,p=this.m_bodyA.c_velocity.v,_=this.m_bodyA.c_velocity.w,v=this.m_bodyB.c_position.c,u=this.m_bodyB.c_position.a,h=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,y=V.neo(c),f=V.neo(u),d=V.mulVec2(y,r.sub(this.m_localAnchorA,this.m_localCenterA)),A=V.mulVec2(f,r.sub(this.m_localAnchorB,this.m_localCenterB)),x=r.zero();if(x.addCombine(1,v,1,A),x.subCombine(1,m,1,d),this.m_ay=V.mulVec2(y,this.m_localYAxisA),this.m_sAy=r.crossVec2Vec2(r.add(x,d),this.m_ay),this.m_sBy=r.crossVec2Vec2(A,this.m_ay),this.m_mass=s+o+a*this.m_sAy*this.m_sAy+n*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax=V.mulVec2(y,this.m_localXAxisA),this.m_sAx=r.crossVec2Vec2(r.add(x,d),this.m_ax),this.m_sBx=r.crossVec2Vec2(A,this.m_ax);var C=s+o+a*this.m_sAx*this.m_sAx+n*this.m_sBx*this.m_sBx;if(C>0){this.m_springMass=1/C;var M=r.dot(x,this.m_ax),I=2*b.PI*this.m_frequencyHz,z=2*this.m_springMass*this.m_dampingRatio*I,F=this.m_springMass*I*I,D=e.dt;this.m_gamma=D*(z+D*F),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=M*D*F*this.m_gamma,this.m_springMass=C+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=a+n,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),e.warmStarting){this.m_impulse*=e.dtRatio,this.m_springImpulse*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var E=r.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),N=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,T=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;p.subMul(this.m_invMassA,E),_-=this.m_invIA*N,h.addMul(this.m_invMassB,E),l+=this.m_invIB*T}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(p),this.m_bodyA.c_velocity.w=_,this.m_bodyB.c_velocity.v.setVec2(h),this.m_bodyB.c_velocity.w=l},t.prototype.solveVelocityConstraints=function(e){var s=this.m_invMassA,o=this.m_invMassB,a=this.m_invIA,n=this.m_invIB,m=this.m_bodyA.c_velocity.v,c=this.m_bodyA.c_velocity.w,p=this.m_bodyB.c_velocity.v,_=this.m_bodyB.c_velocity.w;{var v=r.dot(this.m_ax,p)-r.dot(this.m_ax,m)+this.m_sBx*_-this.m_sAx*c,u=-this.m_springMass*(v+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=u;var h=r.mulNumVec2(u,this.m_ax),l=u*this.m_sAx,y=u*this.m_sBx;m.subMul(s,h),c-=a*l,p.addMul(o,h),_+=n*y}{var v=_-c-this.m_motorSpeed,u=-this.m_motorMass*v,f=this.m_motorImpulse,d=e.dt*this.m_maxMotorTorque;this.m_motorImpulse=b.clamp(this.m_motorImpulse+u,-d,d),u=this.m_motorImpulse-f,c-=a*u,_+=n*u}{var v=r.dot(this.m_ay,p)-r.dot(this.m_ay,m)+this.m_sBy*_-this.m_sAy*c,u=-this.m_mass*v;this.m_impulse+=u;var h=r.mulNumVec2(u,this.m_ay),l=u*this.m_sAy,y=u*this.m_sBy;m.subMul(s,h),c-=a*l,p.addMul(o,h),_+=n*y}this.m_bodyA.c_velocity.v.setVec2(m),this.m_bodyA.c_velocity.w=c,this.m_bodyB.c_velocity.v.setVec2(p),this.m_bodyB.c_velocity.w=_},t.prototype.solvePositionConstraints=function(e){var s=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,a=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,m=V.neo(o),c=V.neo(n),p=V.mulVec2(m,r.sub(this.m_localAnchorA,this.m_localCenterA)),_=V.mulVec2(c,r.sub(this.m_localAnchorB,this.m_localCenterB)),v=r.zero();v.addCombine(1,a,1,_),v.subCombine(1,s,1,p);var u=V.mulVec2(m,this.m_localYAxisA),h=r.crossVec2Vec2(r.add(v,p),u),l=r.crossVec2Vec2(_,u),y=r.dot(v,u),f=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,d;f!=0?d=-y/f:d=0;var A=r.mulNumVec2(d,u),x=d*h,C=d*l;return s.subMul(this.m_invMassA,A),o-=this.m_invIA*x,a.addMul(this.m_invMassB,A),n+=this.m_invIB*C,this.m_bodyA.c_position.c.setVec2(s),this.m_bodyA.c_position.a=o,this.m_bodyB.c_position.c.setVec2(a),this.m_bodyB.c_position.a=n,b.abs(y)<=P.linearSlop},t.TYPE="wheel-joint",t}(pt),Qi=0;function fe(i){var t;i=i||{};var e=i.rootClass||Ie,s=i.preSerialize||function(_){return _},o=i.postSerialize||function(_,v){return _},a=i.preDeserialize||function(_){return _},n=i.postDeserialize||function(_,v){return _},m={World:Ie,Body:tt,Joint:pt,Fixture:St,Shape:G},c=q({Vec2:r,Vec3:j},m),p=(t={},t[tt.STATIC]=tt,t[tt.DYNAMIC]=tt,t[tt.KINEMATIC]=tt,t[ae.TYPE]=ae,t[Se.TYPE]=Se,t[Nt.TYPE]=Nt,t[kt.TYPE]=kt,t[Wt.TYPE]=Wt,t[Pe.TYPE]=Pe,t[ze.TYPE]=ze,t[qe.TYPE]=qe,t[Ne.TYPE]=Ne,t[ke.TYPE]=ke,t[Fe.TYPE]=Fe,t[De.TYPE]=De,t[Rt.TYPE]=Rt,t[Re.TYPE]=Re,t[Ee.TYPE]=Ee,t[Je.TYPE]=Je,t);this.toJson=function(_){var v=[],u=[_],h={};function l(x,C){if(x.__sid=x.__sid||++Qi,!h[x.__sid]){u.push(x);var M=v.length+u.length,I={refIndex:M,refType:C};h[x.__sid]=I}return h[x.__sid]}function y(x){x=s(x);var C=x._serialize();return C=o(C,x),C}function f(x,C){if(typeof x!="object"||x===null)return x;if(typeof x._serialize=="function"){if(x!==C){for(var M in m)if(x instanceof m[M])return l(x,M)}x=y(x)}if(Array.isArray(x)){for(var I=[],z=0;z<x.length;z++)I[z]=f(x[z]);x=I}else{var I={};for(var z in x)x.hasOwnProperty(z)&&(I[z]=f(x[z]));x=I}return x}for(;u.length;){var d=u.shift(),A=f(d,d);v.push(A)}return v},this.fromJson=function(_){var v={};function u(f,d){return(!d||!d._deserialize)&&(d=p[f.type]),d&&d._deserialize}function h(f,d,A){var x=u(d,f);if(!!x){d=a(d);var C=x(d,A,l);return C=n(C,d),C}}function l(f,d,A){if(!d.refIndex)return f&&f._deserialize&&h(f,d,A);f=c[d.refType]||f;var x=d.refIndex;if(!v[x]){var C=_[x],M=h(f,C,A);v[x]=M}return v[x]}var y=e._deserialize(_[0],null,l);return y}}var ui=new fe;fe.toJson=ui.toJson,fe.fromJson=ui.fromJson,Pt.addType(Wt.TYPE,Wt.TYPE,ts);function ts(i,t,e,s,o,a,n){pi(i,e.getShape(),t,a.getShape(),o)}function pi(i,t,e,s,o){i.pointCount=0;var a=R.mulVec2(e,t.m_p),n=R.mulVec2(o,s.m_p),m=r.distanceSquared(n,a),c=t.m_radius,p=s.m_radius,_=c+p;m>_*_||(i.type=mt.e_circles,i.localPoint.setVec2(t.m_p),i.localNormal.setZero(),i.pointCount=1,i.points[0].localPoint.setVec2(s.m_p),i.points[0].id.cf.indexA=0,i.points[0].id.cf.typeA=et.e_vertex,i.points[0].id.cf.indexB=0,i.points[0].id.cf.typeB=et.e_vertex)}Pt.addType(Nt.TYPE,Wt.TYPE,es),Pt.addType(ae.TYPE,Wt.TYPE,is);function es(i,t,e,s,o,a,n){var m=e.getShape(),c=a.getShape();Oe(i,m,t,c,o)}function is(i,t,e,s,o,a,n){var m=e.getShape(),c=new Nt;m.getChildEdge(c,s);var p=c,_=a.getShape();Oe(i,p,t,_,o)}function Oe(i,t,e,s,o){i.pointCount=0;var a=R.mulTVec2(e,R.mulVec2(o,s.m_p)),n=t.m_vertex1,m=t.m_vertex2,c=r.sub(m,n),p=r.dot(c,r.sub(m,a)),_=r.dot(c,r.sub(a,n)),v=t.m_radius+s.m_radius;if(_<=0){var u=r.clone(n),h=r.sub(a,u),l=r.dot(h,h);if(l>v*v)return;if(t.m_hasVertex0){var y=t.m_vertex0,f=n,d=r.sub(f,y),A=r.dot(d,r.sub(f,a));if(A>0)return}i.type=mt.e_circles,i.localNormal.setZero(),i.localPoint.setVec2(u),i.pointCount=1,i.points[0].localPoint.setVec2(s.m_p),i.points[0].id.cf.indexA=0,i.points[0].id.cf.typeA=et.e_vertex,i.points[0].id.cf.indexB=0,i.points[0].id.cf.typeB=et.e_vertex;return}if(p<=0){var x=r.clone(m),C=r.sub(a,x),M=r.dot(C,C);if(M>v*v)return;if(t.m_hasVertex3){var I=t.m_vertex3,z=m,F=r.sub(I,z),D=r.dot(F,r.sub(a,z));if(D>0)return}i.type=mt.e_circles,i.localNormal.setZero(),i.localPoint.setVec2(x),i.pointCount=1,i.points[0].localPoint.setVec2(s.m_p),i.points[0].id.cf.indexA=1,i.points[0].id.cf.typeA=et.e_vertex,i.points[0].id.cf.indexB=0,i.points[0].id.cf.typeB=et.e_vertex;return}var E=r.dot(c,c),N=r.combine(p/E,n,_/E,m),T=r.sub(a,N),Z=r.dot(T,T);if(!(Z>v*v)){var H=r.neo(-c.y,c.x);r.dot(H,r.sub(a,n))<0&&H.setNum(-H.x,-H.y),H.normalize(),i.type=mt.e_faceA,i.localNormal=H,i.localPoint.setVec2(n),i.pointCount=1,i.points[0].localPoint.setVec2(s.m_p),i.points[0].id.cf.indexA=0,i.points[0].id.cf.typeA=et.e_face,i.points[0].id.cf.indexB=0,i.points[0].id.cf.typeB=et.e_vertex}}Pt.addType(kt.TYPE,kt.TYPE,ss);function ss(i,t,e,s,o,a,n){Ye(i,e.getShape(),t,a.getShape(),o)}function vi(i,t,e,s,o){for(var a=i.m_count,n=e.m_count,m=i.m_normals,c=i.m_vertices,p=e.m_vertices,_=R.mulTXf(s,t),v=0,u=-1/0,h=0;h<a;++h){for(var l=V.mulVec2(_.q,m[h]),y=R.mulVec2(_,c[h]),f=1/0,d=0;d<n;++d){var A=r.dot(l,p[d])-r.dot(l,y);A<f&&(f=A)}f>u&&(u=f,v=h)}o.maxSeparation=u,o.bestIndex=v}function rs(i,t,e,s,o,a){for(var n=t.m_normals,m=o.m_count,c=o.m_vertices,p=o.m_normals,_=V.mulTVec2(a.q,V.mulVec2(e.q,n[s])),v=0,u=1/0,h=0;h<m;++h){var l=r.dot(_,p[h]);l<u&&(u=l,v=h)}var y=v,f=y+1<m?y+1:0;i[0].v=R.mulVec2(a,c[y]),i[0].id.cf.indexA=s,i[0].id.cf.indexB=y,i[0].id.cf.typeA=et.e_face,i[0].id.cf.typeB=et.e_vertex,i[1].v=R.mulVec2(a,c[f]),i[1].id.cf.indexA=s,i[1].id.cf.indexB=f,i[1].id.cf.typeA=et.e_face,i[1].id.cf.typeB=et.e_vertex}var Gt={maxSeparation:0,bestIndex:0};function Ye(i,t,e,s,o){i.pointCount=0;var a=t.m_radius+s.m_radius;vi(t,e,s,o,Gt);var n=Gt.bestIndex,m=Gt.maxSeparation;if(!(m>a)){vi(s,o,t,e,Gt);var c=Gt.bestIndex,p=Gt.maxSeparation;if(!(p>a)){var _,v,u,h,l,y,f=.1*P.linearSlop;p>m+f?(_=s,v=t,u=o,h=e,l=c,i.type=mt.e_faceB,y=1):(_=t,v=s,u=e,h=o,l=n,i.type=mt.e_faceA,y=0);var d=[new At,new At];rs(d,_,u,l,v,h);var A=_.m_count,x=_.m_vertices,C=l,M=l+1<A?l+1:0,I=x[C],z=x[M],F=r.sub(z,I);F.normalize();var D=r.crossVec2Num(F,1),E=r.combine(.5,I,.5,z),N=V.mulVec2(u.q,F),T=r.crossVec2Num(N,1);I=R.mulVec2(u,I),z=R.mulVec2(u,z);var Z=r.dot(T,I),H=-r.dot(N,I)+a,$=r.dot(N,z)+a,ot=[new At,new At],nt=[new At,new At],it;if(it=oe(ot,d,r.neg(N),H,C),!(it<2)&&(it=oe(nt,ot,N,$,M),!(it<2))){i.localNormal=D,i.localPoint=E;for(var Y=0,U=0;U<nt.length;++U){var X=r.dot(T,nt[U].v)-Z;if(X<=a){var O=i.points[Y];if(O.localPoint.setVec2(R.mulTVec2(h,nt[U].v)),O.id=nt[U].id,y){var ct=O.id.cf,xt=ct.indexA,wt=ct.indexB,_t=ct.typeA,Ht=ct.typeB;ct.indexA=wt,ct.indexB=xt,ct.typeA=Ht,ct.typeB=_t}++Y}}i.pointCount=Y}}}}Pt.addType(kt.TYPE,Wt.TYPE,os);function os(i,t,e,s,o,a,n){yi(i,e.getShape(),t,a.getShape(),o)}function yi(i,t,e,s,o){i.pointCount=0;for(var a=R.mulVec2(o,s.m_p),n=R.mulTVec2(e,a),m=0,c=-1/0,p=t.m_radius+s.m_radius,_=t.m_count,v=t.m_vertices,u=t.m_normals,h=0;h<_;++h){var l=r.dot(u[h],r.sub(n,v[h]));if(l>p)return;l>c&&(c=l,m=h)}var y=m,f=y+1<_?y+1:0,d=v[y],A=v[f];if(c<b.EPSILON){i.pointCount=1,i.type=mt.e_faceA,i.localNormal.setVec2(u[m]),i.localPoint.setCombine(.5,d,.5,A),i.points[0].localPoint=s.m_p,i.points[0].id.cf.indexA=0,i.points[0].id.cf.typeA=et.e_vertex,i.points[0].id.cf.indexB=0,i.points[0].id.cf.typeB=et.e_vertex;return}var x=r.dot(r.sub(n,d),r.sub(A,d)),C=r.dot(r.sub(n,A),r.sub(d,A));if(x<=0){if(r.distanceSquared(n,d)>p*p)return;i.pointCount=1,i.type=mt.e_faceA,i.localNormal.setCombine(1,n,-1,d),i.localNormal.normalize(),i.localPoint=d,i.points[0].localPoint.setVec2(s.m_p),i.points[0].id.cf.indexA=0,i.points[0].id.cf.typeA=et.e_vertex,i.points[0].id.cf.indexB=0,i.points[0].id.cf.typeB=et.e_vertex}else if(C<=0){if(r.distanceSquared(n,A)>p*p)return;i.pointCount=1,i.type=mt.e_faceA,i.localNormal.setCombine(1,n,-1,A),i.localNormal.normalize(),i.localPoint.setVec2(A),i.points[0].localPoint.setVec2(s.m_p),i.points[0].id.cf.indexA=0,i.points[0].id.cf.typeA=et.e_vertex,i.points[0].id.cf.indexB=0,i.points[0].id.cf.typeB=et.e_vertex}else{var M=r.mid(d,A),I=r.dot(n,u[y])-r.dot(M,u[y]);if(I>p)return;i.pointCount=1,i.type=mt.e_faceA,i.localNormal.setVec2(u[y]),i.localPoint.setVec2(M),i.points[0].localPoint.setVec2(s.m_p),i.points[0].id.cf.indexA=0,i.points[0].id.cf.typeA=et.e_vertex,i.points[0].id.cf.indexB=0,i.points[0].id.cf.typeB=et.e_vertex}}Pt.addType(Nt.TYPE,kt.TYPE,ns),Pt.addType(ae.TYPE,kt.TYPE,as);function ns(i,t,e,s,o,a,n){We(i,e.getShape(),t,a.getShape(),o)}function as(i,t,e,s,o,a,n){var m=e.getShape(),c=new Nt;m.getChildEdge(c,s),We(i,c,t,a.getShape(),o)}var bt;(function(i){i[i.e_unknown=-1]="e_unknown",i[i.e_edgeA=1]="e_edgeA",i[i.e_edgeB=2]="e_edgeB"})(bt||(bt={}));var fi;(function(i){i[i.e_isolated=0]="e_isolated",i[i.e_concave=1]="e_concave",i[i.e_convex=2]="e_convex"})(fi||(fi={}));var di=function(){function i(){}return i}(),ms=function(){function i(){this.vertices=[],this.normals=[],this.count=0}return i}(),cs=function(){function i(){this.normal=r.zero(),this.sideNormal1=r.zero(),this.sideNormal2=r.zero()}return i}(),Lt=new di,yt=new di,ht=new ms,K=new cs;function We(i,t,e,s,o){var a=R.mulTXf(e,o),n=R.mulVec2(a,s.m_centroid),m=t.m_vertex0,c=t.m_vertex1,p=t.m_vertex2,_=t.m_vertex3,v=t.m_hasVertex0,u=t.m_hasVertex3,h=r.sub(p,c);h.normalize();var l=r.neo(h.y,-h.x),y=r.dot(l,r.sub(n,c)),f=0,d=0,A=!1,x=!1,C,M;if(v){var I=r.sub(c,m);I.normalize(),C=r.neo(I.y,-I.x),A=r.crossVec2Vec2(I,h)>=0,f=r.dot(C,n)-r.dot(C,m)}if(u){var z=r.sub(_,p);z.normalize(),M=r.neo(z.y,-z.x),x=r.crossVec2Vec2(h,z)>0,d=r.dot(M,n)-r.dot(M,p)}var F,D=r.zero(),E=r.zero(),N=r.zero();v&&u?A&&x?(F=f>=0||y>=0||d>=0,F?(D.setVec2(l),E.setVec2(C),N.setVec2(M)):(D.setMul(-1,l),E.setMul(-1,l),N.setMul(-1,l))):A?(F=f>=0||y>=0&&d>=0,F?(D.setVec2(l),E.setVec2(C),N.setVec2(l)):(D.setMul(-1,l),E.setMul(-1,M),N.setMul(-1,l))):x?(F=d>=0||f>=0&&y>=0,F?(D.setVec2(l),E.setVec2(l),N.setVec2(M)):(D.setMul(-1,l),E.setMul(-1,l),N.setMul(-1,C))):(F=f>=0&&y>=0&&d>=0,F?(D.setVec2(l),E.setVec2(l),N.setVec2(l)):(D.setMul(-1,l),E.setMul(-1,M),N.setMul(-1,C))):v?A?(F=f>=0||y>=0,F?(D.setVec2(l),E.setVec2(C),N.setMul(-1,l)):(D.setMul(-1,l),E.setVec2(l),N.setMul(-1,l))):(F=f>=0&&y>=0,F?(D.setVec2(l),E.setVec2(l),N.setMul(-1,l)):(D.setMul(-1,l),E.setVec2(l),N.setMul(-1,C))):u?x?(F=y>=0||d>=0,F?(D.setVec2(l),E.setMul(-1,l),N.setVec2(M)):(D.setMul(-1,l),E.setMul(-1,l),N.setVec2(l))):(F=y>=0&&d>=0,F?(D.setVec2(l),E.setMul(-1,l),N.setVec2(l)):(D.setMul(-1,l),E.setMul(-1,M),N.setVec2(l))):(F=y>=0,F?(D.setVec2(l),E.setMul(-1,l),N.setMul(-1,l)):(D.setMul(-1,l),E.setVec2(l),N.setVec2(l))),ht.count=s.m_count;for(var T=0;T<s.m_count;++T)ht.vertices[T]=R.mulVec2(a,s.m_vertices[T]),ht.normals[T]=V.mulVec2(a.q,s.m_normals[T]);var Z=2*P.polygonRadius;i.pointCount=0;{Lt.type=bt.e_edgeA,Lt.index=F?0:1,Lt.separation=1/0;for(var T=0;T<ht.count;++T){var H=r.dot(D,r.sub(ht.vertices[T],c));H<Lt.separation&&(Lt.separation=H)}}if(Lt.type!=bt.e_unknown&&!(Lt.separation>Z)){{yt.type=bt.e_unknown,yt.index=-1,yt.separation=-1/0;for(var $=r.neo(-D.y,D.x),T=0;T<ht.count;++T){var ot=r.neg(ht.normals[T]),nt=r.dot(ot,r.sub(ht.vertices[T],c)),it=r.dot(ot,r.sub(ht.vertices[T],p)),H=b.min(nt,it);if(H>Z){yt.type=bt.e_edgeB,yt.index=T,yt.separation=H;break}if(r.dot(ot,$)>=0){if(r.dot(r.sub(ot,N),D)<-P.angularSlop)continue}else if(r.dot(r.sub(ot,E),D)<-P.angularSlop)continue;H>yt.separation&&(yt.type=bt.e_edgeB,yt.index=T,yt.separation=H)}}if(!(yt.type!=bt.e_unknown&&yt.separation>Z)){var Y=.98,U=.001,X;yt.type==bt.e_unknown?X=Lt:yt.separation>Y*Lt.separation+U?X=yt:X=Lt;var O=[new At,new At];if(X.type==bt.e_edgeA){i.type=mt.e_faceA;for(var ct=0,xt=r.dot(D,ht.normals[0]),T=1;T<ht.count;++T){var wt=r.dot(D,ht.normals[T]);wt<xt&&(xt=wt,ct=T)}var _t=ct,Ht=_t+1<ht.count?_t+1:0;O[0].v=ht.vertices[_t],O[0].id.cf.indexA=0,O[0].id.cf.indexB=_t,O[0].id.cf.typeA=et.e_face,O[0].id.cf.typeB=et.e_vertex,O[1].v=ht.vertices[Ht],O[1].id.cf.indexA=0,O[1].id.cf.indexB=Ht,O[1].id.cf.typeA=et.e_face,O[1].id.cf.typeB=et.e_vertex,F?(K.i1=0,K.i2=1,K.v1=c,K.v2=p,K.normal.setVec2(l)):(K.i1=1,K.i2=0,K.v1=p,K.v2=c,K.normal.setMul(-1,l))}else i.type=mt.e_faceB,O[0].v=c,O[0].id.cf.indexA=0,O[0].id.cf.indexB=X.index,O[0].id.cf.typeA=et.e_vertex,O[0].id.cf.typeB=et.e_face,O[1].v=p,O[1].id.cf.indexA=0,O[1].id.cf.indexB=X.index,O[1].id.cf.typeA=et.e_vertex,O[1].id.cf.typeB=et.e_face,K.i1=X.index,K.i2=K.i1+1<ht.count?K.i1+1:0,K.v1=ht.vertices[K.i1],K.v2=ht.vertices[K.i2],K.normal.setVec2(ht.normals[K.i1]);K.sideNormal1.setNum(K.normal.y,-K.normal.x),K.sideNormal2.setMul(-1,K.sideNormal1),K.sideOffset1=r.dot(K.sideNormal1,K.v1),K.sideOffset2=r.dot(K.sideNormal2,K.v2);var Qt=[new At,new At],gt=[new At,new At],Jt;if(Jt=oe(Qt,O,K.sideNormal1,K.sideOffset1,K.i1),!(Jt<P.maxManifoldPoints)&&(Jt=oe(gt,Qt,K.sideNormal2,K.sideOffset2,K.i2),!(Jt<P.maxManifoldPoints))){X.type==bt.e_edgeA?(i.localNormal=r.clone(K.normal),i.localPoint=r.clone(K.v1)):(i.localNormal=r.clone(s.m_normals[K.i1]),i.localPoint=r.clone(s.m_vertices[K.i1]));for(var te=0,T=0;T<P.maxManifoldPoints;++T){var ee=r.dot(K.normal,r.sub(gt[T].v,K.v1));if(ee<=Z){var Ot=i.points[te];X.type==bt.e_edgeA?(Ot.localPoint=R.mulTVec2(a,gt[T].v),Ot.id=gt[T].id):(Ot.localPoint=gt[T].v,Ot.id.cf.typeA=gt[T].id.cf.typeB,Ot.id.cf.typeB=gt[T].id.cf.typeA,Ot.id.cf.indexA=gt[T].id.cf.indexB,Ot.id.cf.indexB=gt[T].id.cf.indexA),++te}}i.pointCount=te}}}}var Et={};Et.CollidePolygons=Ye,Et.Settings=P,Et.Sweep=Ut,Et.Manifold=_e,Et.Distance=qt,Et.TimeOfImpact=ne,Et.DynamicTree=re,Et.stats=at,hi.TimeStep=Me,qt.testOverlap=ii,qt.Input=be,qt.Output=Ve,qt.Proxy=Xt,qt.Cache=we,ne.Input=mi,ne.Output=ci,g.AABB=W,g.Body=tt,g.Box=Se,g.Chain=ae,g.Circle=Wt,g.CollideCircles=pi,g.CollideEdgeCircle=Oe,g.CollideEdgePolygon=We,g.CollidePolygonCircle=yi,g.CollidePolygons=Ye,g.Contact=Pt,g.Distance=qt,g.DistanceJoint=Pe,g.DynamicTree=re,g.Edge=Nt,g.Fixture=St,g.FrictionJoint=ze,g.GearJoint=qe,g.Joint=pt,g.Manifold=_e,g.Mat22=dt,g.Mat33=Dt,g.Math=b,g.MotorJoint=Ne,g.MouseJoint=ke,g.Polygon=kt,g.PrismaticJoint=Fe,g.PulleyJoint=De,g.RevoluteJoint=Rt,g.RopeJoint=Re,g.Rot=V,g.Serializer=fe,g.Settings=P,g.Shape=G,g.Sweep=Ut,g.TimeOfImpact=ne,g.Transform=R,g.Vec2=r,g.Vec3=j,g.WeldJoint=Ee,g.WheelJoint=Je,g.World=Ie,g.internal=Et,Object.defineProperty(g,"__esModule",{value:!0})})})(st,st.exports);const Cs=bs("<div><canvas></canvas></div>"),Ms=B=>{let w,g,L=0;const S=60,q=10;let k=[10,20],J=1,rt=[50,50],ft=[],b=20,r=10,W=null,P=J*1.8,Tt=J*.5;const Mt=new st.exports.World(st.exports.Vec2(0,0));Mt.createBody().createFixture(st.exports.Edge(st.exports.Vec2(0,rt[1]),st.exports.Vec2(rt[0],rt[1]))),Mt.createBody().createFixture(st.exports.Edge(st.exports.Vec2(rt[0],0),st.exports.Vec2(rt[0],rt[1]))),Mt.createBody().createFixture(st.exports.Edge(st.exports.Vec2(0,0),st.exports.Vec2(0,rt[1]))),Mt.createBody().createFixture(st.exports.Edge(st.exports.Vec2(0,0),st.exports.Vec2(rt[0],0)));function re(Q,G){const lt=Q.createDynamicBody({position:st.exports.Vec2(J+(rt[0]-J-J)*Math.random(),J+(rt[1]-J-J)*Math.random()),linearVelocity:st.exports.Vec2(20*Math.random()-10,20*Math.random()-10),userData:G}),ut=st.exports.Circle(J);return lt.createFixture(ut,{density:1,friction:0,filterGroupIndex:-1,restitution:1}),lt}function Be(Q){const G=Q.createDynamicBody({position:st.exports.Vec2(P+(rt[0]-P-P)*Math.random(),P+(rt[1]-P-P)*Math.random()),userData:-1}),lt=st.exports.Circle(P);G.createFixture(lt,{density:0,friction:0,isSensor:!0,restitution:1});const ut=st.exports.Circle(Tt);return G.createFixture(ut,{density:0,friction:0,restitution:0}),G}Mt.on("begin-contact",Q=>{Q.m_fixtureB.m_isSensor&&Q.m_fixtureA.m_body.m_type==="dynamic"||Q.m_fixtureA.m_isSensor&&Q.m_fixtureB.m_body.m_type});for(let Q=0;Q<r;Q++)ft.push(re(Mt,Q));W=Be(Mt),console.log(W);function It(Q,G){switch(Q){case"ArrowRight":{G==="on"?W.setLinearVelocity(st.exports.Vec2(b,W.getLinearVelocity().y),W.getPosition()):G==="off"&&W.setLinearVelocity(st.exports.Vec2(0,W.getLinearVelocity().y),W.getPosition());break}case"ArrowLeft":{G==="on"?W.setLinearVelocity(st.exports.Vec2(-b,W.getLinearVelocity().y),W.getPosition()):G==="off"&&W.setLinearVelocity(st.exports.Vec2(0,W.getLinearVelocity().y),W.getPosition());break}case"ArrowDown":{G==="on"?W.setLinearVelocity(st.exports.Vec2(W.getLinearVelocity().x,b),W.getPosition()):G==="off"&&W.setLinearVelocity(st.exports.Vec2(W.getLinearVelocity().x,0),W.getPosition());break}case"ArrowUp":{G==="on"?W.setLinearVelocity(st.exports.Vec2(W.getLinearVelocity().x,-b),W.getPosition()):G==="off"&&W.setLinearVelocity(st.exports.Vec2(W.getLinearVelocity().x,0),W.getPosition());break}}}document.addEventListener("keyup",Q=>{switch(Q.key){case"ArrowRight":{It(Q.key,"off");break}case"ArrowLeft":{It(Q.key,"off");break}case"ArrowDown":{It(Q.key,"off");break}case"ArrowUp":{It(Q.key,"off");break}}}),document.addEventListener("keydown",Q=>{switch(Q.key){case"ArrowRight":{It(Q.key,"on");break}case"ArrowLeft":{It(Q.key,"on");break}case"ArrowDown":{It(Q.key,"on");break}case"ArrowUp":{It(Q.key,"on");break}}});const V=1/S,R=8,Ut=3,le=Q=>{const G=w?.getContext("2d")??null;if(G&&Q>L+1e3/S){G.clearRect(0,0,rt[0]*q,rt[1]*q);var lt=W.getContactList();if(lt&&lt.contact.m_fixtureA.m_body.m_type==="dynamic"&&lt.contact.m_fixtureB.m_body.m_type==="dynamic"){if(lt.contact.m_fixtureB.m_isSensor){var ut=lt.contact.m_fixtureA.m_body.m_userData;ft[ut].setPosition(st.exports.Vec2(P+(rt[0]-P-P)*Math.random(),P+(rt[1]-P-P)*Math.random()))}else if(lt.contact.m_fixtureA.m_isSensor){var ut=lt.contact.m_fixtureB.m_body.m_userData;ft[ut].setPosition(st.exports.Vec2(P+(rt[0]-P-P)*Math.random(),P+(rt[1]-P-P)*Math.random()))}}Mt.step(V,R,Ut),ft.forEach(St=>{G.beginPath(),k=[St.getPosition().x,St.getPosition().y],G.arc(k[0]*q,k[1]*q,J*q,0,2*Math.PI,!1),G.fill()}),G.beginPath(),k=[W.getPosition().x,W.getPosition().y],G.arc(k[0]*q,k[1]*q,P*q,0,2*Math.PI,!1),G.stroke(),G.beginPath(),G.arc(k[0]*q,k[1]*q,Tt*q,0,2*Math.PI,!1),G.fill(),g=requestAnimationFrame(le)}};return vs(()=>{g=requestAnimationFrame(le),console.log("frame:",g),ys(()=>cancelAnimationFrame(g))}),(()=>{const Q=Cs.cloneNode(!0),G=Q.firstChild,lt=w;return typeof lt=="function"?lt(G):w=G,G.style.setProperty("border","1px solid #d3d3d3"),Ae(ut=>{const St=rt[0]*q,Ft=rt[1]*q;return St!==ut._v$&&Ai(G,"width",ut._v$=St),Ft!==ut._v$2&&Ai(G,"height",ut._v$2=Ft),ut},{_v$:void 0,_v$2:void 0}),Q})()};Bs(()=>xs(Ms,{}),document.getElementById("root"));
